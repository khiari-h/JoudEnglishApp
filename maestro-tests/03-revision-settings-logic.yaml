# Test E2E : Logique des r√©visions et param√®tres
# V√©rifie : Popup r√©vision ‚Üí Param√®tres ‚Üí D√©sactivation ‚Üí Mise √† jour UI

appId: com.joudenglish.app
name: "Logique des r√©visions et param√®tres"
tags:
  - "revisions"
  - "settings"
  - "popup-logic"

env:
  TIMEOUT: 12000
  RETRY_COUNT: 3

# Test 1: D√©clenchement de la popup de r√©vision
---
- runFlow:
    when:
      true: ${ENV:TEST == "popup-trigger" || !ENV:TEST}
    commands:
      - launchApp
      
      # V√©rifier l'√©tat initial
      - assertVisible: "üìä Aujourd'hui"
      - assertVisible: "‚ö° Actions rapides"
      
      # Aller au vocabulaire pour d√©clencher la popup
      - tapOn: "Niveaux"
      - tapOn: "level-1-button"
      - tapOn: "vocabulary-button"
      
      # Faire assez de mots pour d√©clencher la popup (seuil par d√©faut: 50)
      - repeat:
          times: 51
          commands:
            - tapOn: "Traduire"
            - tapOn: "Suivant"
      
      # V√©rifier que la popup de r√©vision appara√Æt
      - assertVisible: "revision-popup"
      - assertVisible: "popup-words"
      - assertVisible: "popup-questions"
      - assertVisible: "popup-now"
      - assertVisible: "popup-later50"
      - assertVisible: "popup-disable"
      - assertVisible: "popup-dismiss"
      
      # Retour au dashboard
      - tapOn: "popup-dismiss"
      - tapOn: "‚Üê"
      - tapOn: "‚Üê"
      - tapOn: "Accueil"

# Test 2: Gestion de la popup - Choix "Maintenant"
---
- runFlow:
    when:
      true: ${ENV:TEST == "popup-now" || !ENV:TEST}
    commands:
      - launchApp
      
      # Aller au vocabulaire
      - tapOn: "Niveaux"
      - tapOn: "level-1-button"
      - tapOn: "vocabulary-button"
      
      # Faire assez de mots pour d√©clencher la popup
      - repeat:
          times: 51
          commands:
            - tapOn: "Traduire"
            - tapOn: "Suivant"
      
      # Choisir "Maintenant"
      - assertVisible: "revision-popup"
      - tapOn: "popup-now"
      
      # V√©rifier qu'on est redirig√© vers la r√©vision
      - assertVisible: "R√©vision"
      - assertVisible: "51 mots disponibles"
      
      # Retour au dashboard
      - tapOn: "Accueil"
      - assertVisible: "Accueil"

# Test 3: Gestion de la popup - Choix "Plus tard"
---
- runFlow:
    when:
      true: ${ENV:TEST == "popup-later" || !ENV:TEST}
    commands:
      - launchApp
      
      # Aller au vocabulaire
      - tapOn: "Niveaux"
      - tapOn: "level-1-button"
      - tapOn: "vocabulary-button"
      
      # Faire assez de mots pour d√©clencher la popup
      - repeat:
          times: 51
          commands:
            - tapOn: "Traduire"
            - tapOn: "Suivant"
      
      # Choisir "Plus tard"
      - assertVisible: "revision-popup"
      - tapOn: "popup-later50"
      
      # V√©rifier que la popup se ferme
      - assertNotVisible: "revision-popup"
      
      # Retour au dashboard
      - tapOn: "‚Üê"
      - tapOn: "‚Üê"
      - tapOn: "Accueil"

# Test 4: Gestion de la popup - D√©sactivation
---
- runFlow:
    when:
      true: ${ENV:TEST == "popup-disable" || !ENV:TEST}
    commands:
      - launchApp
      
      # Aller au vocabulaire
      - tapOn: "Niveaux"
      - tapOn: "level-1-button"
      - tapOn: "vocabulary-button"
      
      # Faire assez de mots pour d√©clencher la popup
      - repeat:
          times: 51
          commands:
            - tapOn: "Traduire"
            - tapOn: "Suivant"
      
      # Choisir "D√©sactiver"
      - assertVisible: "revision-popup"
      - tapOn: "popup-disable"
      
      # V√©rifier que la popup se ferme
      - assertNotVisible: "revision-popup"
      
      # Retour au dashboard
      - tapOn: "‚Üê"
      - tapOn: "‚Üê"
      - tapOn: "Accueil"
      
      # V√©rifier que les r√©visions sont d√©sactiv√©es dans QuickActions
      - assertVisible: "‚ö° Actions rapides"
      - assertVisible: "Apprenez plus de mots" # R√©vision d√©sactiv√©e

# Test 5: V√©rification des param√®tres apr√®s d√©sactivation
---
- runFlow:
    when:
      true: ${ENV:TEST == "settings-after-disable" || !ENV:TEST}
    commands:
      - launchApp
      - tapOn: "R√©glages"
      
      # V√©rifier que les r√©visions sont d√©sactiv√©es
      - assertVisible: "üîÑ R√©visions automatiques"
      - assertVisible: "‚ö†Ô∏è R√©visions d√©sactiv√©es"
      - assertVisible: "R√©activez-les pour maintenir votre m√©morisation !"
      
      # Retour au dashboard
      - tapOn: "Accueil"
      - assertVisible: "Accueil"

# Test 6: R√©activation des r√©visions via param√®tres
---
- runFlow:
    when:
      true: ${ENV:TEST == "settings-reactivate" || !ENV:TEST}
    commands:
      - launchApp
      - tapOn: "R√©glages"
      
      # R√©activer les r√©visions
      - assertVisible: "üîÑ R√©visions automatiques"
      - tapOn: "R√©visions automatiques" # Toggle
      
      # V√©rifier que les r√©visions sont r√©activ√©es
      - assertVisible: "Tous les 50 mots (standard)"
      - assertVisible: "üí° Prochaine r√©vision √† 50 mots appris"
      
      # Changer la fr√©quence
      - tapOn: "Tous les 25 mots (l√©ger)"
      - assertVisible: "‚úì"
      - assertVisible: "üí° Prochaine r√©vision √† 25 mots appris"
      
      # Retour au dashboard
      - tapOn: "Accueil"
      - assertVisible: "Accueil"
      
      # V√©rifier que QuickActions a √©t√© mis √† jour
      - assertVisible: "‚ö° Actions rapides"
      - assertVisible: "üîÑ R√©vision"

# Test 7: Test de la nouvelle fr√©quence (25 mots)
---
- runFlow:
    when:
      true: ${ENV:TEST == "new-frequency-test" || !ENV:TEST}
    commands:
      - launchApp
      
      # Aller au vocabulaire
      - tapOn: "Niveaux"
      - tapOn: "level-1-button"
      - tapOn: "vocabulary-button"
      
      # Faire 25 mots pour d√©clencher la popup avec la nouvelle fr√©quence
      - repeat:
          times: 25
          commands:
            - tapOn: "Traduire"
            - tapOn: "Suivant"
      
      # V√©rifier que la popup appara√Æt √† 25 mots (nouvelle fr√©quence)
      - assertVisible: "revision-popup"
      - assertVisible: "25 mots disponibles"
      
      # Fermer la popup
      - tapOn: "popup-dismiss"
      
      # Retour au dashboard
      - tapOn: "‚Üê"
      - tapOn: "‚Üê"
      - tapOn: "Accueil"

# Test 8: V√©rification finale - Coh√©rence entre popup et param√®tres
---
- runFlow:
    when:
      true: ${ENV:TEST == "final-verification" || !ENV:TEST}
    commands:
      - launchApp
      
      # V√©rifier l'√©tat des r√©visions dans QuickActions
      - assertVisible: "‚ö° Actions rapides"
      - assertVisible: "üîÑ R√©vision"
      - assertVisible: "25 mots disponibles"
      
      # Aller aux param√®tres
      - tapOn: "R√©glages"
      - assertVisible: "üîÑ R√©visions automatiques"
      - assertVisible: "Tous les 25 mots (l√©ger)"
      - assertVisible: "üí° Prochaine r√©vision √† 25 mots appris"
      
      # Retour au dashboard
      - tapOn: "Accueil"
      - assertVisible: "Accueil"
      
      # V√©rifier que tout est coh√©rent
      - assertVisible: "üìä Aujourd'hui"
      - assertVisible: "üèÜ Progression g√©n√©rale"
