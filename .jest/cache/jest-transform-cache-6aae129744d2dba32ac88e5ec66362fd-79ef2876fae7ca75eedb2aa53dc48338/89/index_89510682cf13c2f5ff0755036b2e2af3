d70c5f088c304ddf60a13fe95de675d3
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _react = require("react");
var _expoRouter = require("expo-router");
var _asyncStorage = _interopRequireDefault(require("@react-native-async-storage/async-storage"));
var _RevisionPopup = _interopRequireDefault(require("../../Dashboard/components/popup/RevisionPopup"));
var _jsxRuntime = require("react/jsx-runtime");
var REVISION_STORAGE_KEY = 'revision_preferences';
var RevisionOrchestrator = function RevisionOrchestrator(_ref) {
  var _ref$currentLevel = _ref.currentLevel,
    currentLevel = _ref$currentLevel === void 0 ? "mixed" : _ref$currentLevel;
  var _useState = (0, _react.useState)(false),
    _useState2 = (0, _slicedToArray2.default)(_useState, 2),
    showPopup = _useState2[0],
    setShowPopup = _useState2[1];
  var _useState3 = (0, _react.useState)(0),
    _useState4 = (0, _slicedToArray2.default)(_useState3, 2),
    totalWords = _useState4[0],
    setTotalWords = _useState4[1];
  var _useState5 = (0, _react.useState)(50),
    _useState6 = (0, _slicedToArray2.default)(_useState5, 2),
    nextRevisionAt = _useState6[0],
    setNextRevisionAt = _useState6[1];
  var _useState7 = (0, _react.useState)(false),
    _useState8 = (0, _slicedToArray2.default)(_useState7, 2),
    isDisabled = _useState8[0],
    setIsDisabled = _useState8[1];
  var _useState9 = (0, _react.useState)(false),
    _useState0 = (0, _slicedToArray2.default)(_useState9, 2),
    isLoaded = _useState0[0],
    setIsLoaded = _useState0[1];
  var popupShownRef = (0, _react.useRef)(false);
  var countWords = function () {
    var _ref2 = (0, _asyncToGenerator2.default)(function* () {
      try {
        var total = 0;
        var levels = ['1', '2', '3', '4', '5', '6', 'bonus'];
        var modes = ['classic', 'fast'];
        for (var level of levels) {
          for (var mode of modes) {
            var stored = yield _asyncStorage.default.getItem(`vocabulary_${level}_${mode}`);
            if (stored) {
              var data = JSON.parse(stored);
              var completedWords = data.completedWords || {};
              total += Object.values(completedWords).reduce(function (acc, words) {
                if (Array.isArray(words)) {
                  return acc + words.length;
                }
                return acc;
              }, 0);
            }
          }
        }
        setTotalWords(total);
        return total;
      } catch (error) {
        return 0;
      }
    });
    return function countWords() {
      return _ref2.apply(this, arguments);
    };
  }();
  var loadRevisionPreferences = function () {
    var _ref3 = (0, _asyncToGenerator2.default)(function* () {
      try {
        var saved = yield _asyncStorage.default.getItem(REVISION_STORAGE_KEY);
        if (saved) {
          var prefs = JSON.parse(saved);
          setNextRevisionAt(prefs.nextRevisionAt || 50);
          setIsDisabled(prefs.isDisabled || false);
        } else {
          setNextRevisionAt(50);
          setIsDisabled(false);
        }
      } catch (error) {
        console.error('Error loading revision preferences:', error);
        setNextRevisionAt(50);
        setIsDisabled(false);
      } finally {
        setIsLoaded(true);
      }
    });
    return function loadRevisionPreferences() {
      return _ref3.apply(this, arguments);
    };
  }();
  var saveRevisionPreferences = function () {
    var _ref4 = (0, _asyncToGenerator2.default)(function* (newNextAt, newIsDisabled) {
      try {
        var prefs = {
          nextRevisionAt: newNextAt,
          isDisabled: newIsDisabled,
          lastUpdate: Date.now()
        };
        yield _asyncStorage.default.setItem(REVISION_STORAGE_KEY, JSON.stringify(prefs));
        setNextRevisionAt(newNextAt);
        setIsDisabled(newIsDisabled);
      } catch (error) {
        console.error('Error saving revision preferences:', error);
      }
    });
    return function saveRevisionPreferences(_x, _x2) {
      return _ref4.apply(this, arguments);
    };
  }();
  (0, _react.useEffect)(function () {
    var initializeRevision = function () {
      var _ref5 = (0, _asyncToGenerator2.default)(function* () {
        yield loadRevisionPreferences();
        yield countWords();
      });
      return function initializeRevision() {
        return _ref5.apply(this, arguments);
      };
    }();
    initializeRevision();
  }, []);
  (0, _react.useEffect)(function () {
    if (!isLoaded) return;
    var shouldShow = !isDisabled && totalWords >= nextRevisionAt && totalWords > 0 && !showPopup && !popupShownRef.current;
    if (shouldShow) {
      popupShownRef.current = true;
      setTimeout(function () {
        return setShowPopup(true);
      }, 1000);
    }
  }, [isLoaded, isDisabled, totalWords, nextRevisionAt, showPopup]);
  var handleChoice = (0, _react.useCallback)(function () {
    var _ref6 = (0, _asyncToGenerator2.default)(function* (choice) {
      setShowPopup(false);
      popupShownRef.current = false;
      switch (choice) {
        case 'now':
          {
            var nextTarget = totalWords + 50;
            yield saveRevisionPreferences(nextTarget, false);
            _expoRouter.router.push({
              pathname: "/tabs/vocabularyRevision",
              params: {
                level: currentLevel,
                questionsCount: 10,
                source: 'popup_trigger'
              }
            });
            break;
          }
        case 'later_50':
          {
            var next50 = totalWords + 50;
            yield saveRevisionPreferences(next50, false);
            break;
          }
        case 'later_100':
          {
            var next100 = totalWords + 100;
            yield saveRevisionPreferences(next100, false);
            break;
          }
        case 'disable':
          {
            yield saveRevisionPreferences(nextRevisionAt, true);
            break;
          }
        default:
          {
            var defaultNext = totalWords + 50;
            yield saveRevisionPreferences(defaultNext, false);
            break;
          }
      }
    });
    return function (_x3) {
      return _ref6.apply(this, arguments);
    };
  }(), [totalWords, saveRevisionPreferences, currentLevel, nextRevisionAt]);
  var handleDismiss = (0, _react.useCallback)(function () {
    return handleChoice('later_50');
  }, [handleChoice]);
  if (isDisabled) {
    return null;
  }
  return (0, _jsxRuntime.jsx)(_RevisionPopup.default, {
    visible: showPopup,
    totalWordsLearned: totalWords,
    questionsCount: 10,
    currentLevel: currentLevel,
    onChoice: handleChoice,
    onDismiss: handleDismiss
  });
};
var _default = exports.default = RevisionOrchestrator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJyZXF1aXJlIiwiX2V4cG9Sb3V0ZXIiLCJfYXN5bmNTdG9yYWdlIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9SZXZpc2lvblBvcHVwIiwiX2pzeFJ1bnRpbWUiLCJSRVZJU0lPTl9TVE9SQUdFX0tFWSIsIlJldmlzaW9uT3JjaGVzdHJhdG9yIiwiX3JlZiIsIl9yZWYkY3VycmVudExldmVsIiwiY3VycmVudExldmVsIiwiX3VzZVN0YXRlIiwidXNlU3RhdGUiLCJfdXNlU3RhdGUyIiwiX3NsaWNlZFRvQXJyYXkyIiwiZGVmYXVsdCIsInNob3dQb3B1cCIsInNldFNob3dQb3B1cCIsIl91c2VTdGF0ZTMiLCJfdXNlU3RhdGU0IiwidG90YWxXb3JkcyIsInNldFRvdGFsV29yZHMiLCJfdXNlU3RhdGU1IiwiX3VzZVN0YXRlNiIsIm5leHRSZXZpc2lvbkF0Iiwic2V0TmV4dFJldmlzaW9uQXQiLCJfdXNlU3RhdGU3IiwiX3VzZVN0YXRlOCIsImlzRGlzYWJsZWQiLCJzZXRJc0Rpc2FibGVkIiwiX3VzZVN0YXRlOSIsIl91c2VTdGF0ZTAiLCJpc0xvYWRlZCIsInNldElzTG9hZGVkIiwicG9wdXBTaG93blJlZiIsInVzZVJlZiIsImNvdW50V29yZHMiLCJfcmVmMiIsIl9hc3luY1RvR2VuZXJhdG9yMiIsInRvdGFsIiwibGV2ZWxzIiwibW9kZXMiLCJsZXZlbCIsIm1vZGUiLCJzdG9yZWQiLCJBc3luY1N0b3JhZ2UiLCJnZXRJdGVtIiwiZGF0YSIsIkpTT04iLCJwYXJzZSIsImNvbXBsZXRlZFdvcmRzIiwiT2JqZWN0IiwidmFsdWVzIiwicmVkdWNlIiwiYWNjIiwid29yZHMiLCJBcnJheSIsImlzQXJyYXkiLCJsZW5ndGgiLCJlcnJvciIsImFwcGx5IiwiYXJndW1lbnRzIiwibG9hZFJldmlzaW9uUHJlZmVyZW5jZXMiLCJfcmVmMyIsInNhdmVkIiwicHJlZnMiLCJjb25zb2xlIiwic2F2ZVJldmlzaW9uUHJlZmVyZW5jZXMiLCJfcmVmNCIsIm5ld05leHRBdCIsIm5ld0lzRGlzYWJsZWQiLCJsYXN0VXBkYXRlIiwiRGF0ZSIsIm5vdyIsInNldEl0ZW0iLCJzdHJpbmdpZnkiLCJfeCIsIl94MiIsInVzZUVmZmVjdCIsImluaXRpYWxpemVSZXZpc2lvbiIsIl9yZWY1Iiwic2hvdWxkU2hvdyIsImN1cnJlbnQiLCJzZXRUaW1lb3V0IiwiaGFuZGxlQ2hvaWNlIiwidXNlQ2FsbGJhY2siLCJfcmVmNiIsImNob2ljZSIsIm5leHRUYXJnZXQiLCJyb3V0ZXIiLCJwdXNoIiwicGF0aG5hbWUiLCJwYXJhbXMiLCJxdWVzdGlvbnNDb3VudCIsInNvdXJjZSIsIm5leHQ1MCIsIm5leHQxMDAiLCJkZWZhdWx0TmV4dCIsIl94MyIsImhhbmRsZURpc21pc3MiLCJqc3giLCJ2aXNpYmxlIiwidG90YWxXb3Jkc0xlYXJuZWQiLCJvbkNob2ljZSIsIm9uRGlzbWlzcyIsIl9kZWZhdWx0IiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9jb21wb25lbnRzL3JldmlzaW9uL1JldmlzaW9uT3JjaGVzdHJhdG9yL2luZGV4LmpzIC0gVkVSU0lPTiBDT1JSSUfDiUVcclxuaW1wb3J0IHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSwgdXNlUmVmLCB1c2VDYWxsYmFjayB9IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IHsgcm91dGVyIH0gZnJvbSAnZXhwby1yb3V0ZXInO1xyXG5pbXBvcnQgQXN5bmNTdG9yYWdlIGZyb20gJ0ByZWFjdC1uYXRpdmUtYXN5bmMtc3RvcmFnZS9hc3luYy1zdG9yYWdlJztcclxuaW1wb3J0IFJldmlzaW9uUG9wdXAgZnJvbSAnLi4vLi4vRGFzaGJvYXJkL2NvbXBvbmVudHMvcG9wdXAvUmV2aXNpb25Qb3B1cCc7XHJcblxyXG5jb25zdCBSRVZJU0lPTl9TVE9SQUdFX0tFWSA9ICdyZXZpc2lvbl9wcmVmZXJlbmNlcyc7XHJcblxyXG5jb25zdCBSZXZpc2lvbk9yY2hlc3RyYXRvciA9ICh7IGN1cnJlbnRMZXZlbCA9IFwibWl4ZWRcIiB9KSA9PiB7XHJcbiAgY29uc3QgW3Nob3dQb3B1cCwgc2V0U2hvd1BvcHVwXSA9IHVzZVN0YXRlKGZhbHNlKTtcclxuICBjb25zdCBbdG90YWxXb3Jkcywgc2V0VG90YWxXb3Jkc10gPSB1c2VTdGF0ZSgwKTtcclxuICBjb25zdCBbbmV4dFJldmlzaW9uQXQsIHNldE5leHRSZXZpc2lvbkF0XSA9IHVzZVN0YXRlKDUwKTtcclxuICBjb25zdCBbaXNEaXNhYmxlZCwgc2V0SXNEaXNhYmxlZF0gPSB1c2VTdGF0ZShmYWxzZSk7IC8vIOKchSBWUkFJIEZMQUcgQk9PTEVBTlxyXG4gIGNvbnN0IFtpc0xvYWRlZCwgc2V0SXNMb2FkZWRdID0gdXNlU3RhdGUoZmFsc2UpO1xyXG4gIFxyXG4gIC8vIOKchSBQUk9URUNUSU9OIGNvbnRyZSBkb3VibGUtcG9wdXBcclxuICBjb25zdCBwb3B1cFNob3duUmVmID0gdXNlUmVmKGZhbHNlKTtcclxuXHJcbiAgLy8gPT09PT09PT09PSBDT01QVEFHRSBTSU1QTEUgPT09PT09PT09PVxyXG4gIGNvbnN0IGNvdW50V29yZHMgPSBhc3luYyAoKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBsZXQgdG90YWwgPSAwO1xyXG4gICAgICBjb25zdCBsZXZlbHMgPSBbJzEnLCAnMicsICczJywgJzQnLCAnNScsICc2JywgJ2JvbnVzJ107XHJcbiAgICAgIGNvbnN0IG1vZGVzID0gWydjbGFzc2ljJywgJ2Zhc3QnXTtcclxuXHJcbiAgICAgIGZvciAoY29uc3QgbGV2ZWwgb2YgbGV2ZWxzKSB7XHJcbiAgICAgICAgZm9yIChjb25zdCBtb2RlIG9mIG1vZGVzKSB7XHJcbiAgICAgICAgICBjb25zdCBzdG9yZWQgPSBhd2FpdCBBc3luY1N0b3JhZ2UuZ2V0SXRlbShgdm9jYWJ1bGFyeV8ke2xldmVsfV8ke21vZGV9YCk7XHJcbiAgICAgICAgICBpZiAoc3RvcmVkKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKHN0b3JlZCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRlZFdvcmRzID0gZGF0YS5jb21wbGV0ZWRXb3JkcyB8fCB7fTtcclxuICAgICAgICAgICAgdG90YWwgKz0gT2JqZWN0LnZhbHVlcyhjb21wbGV0ZWRXb3JkcykucmVkdWNlKChhY2MsIHdvcmRzKSA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkod29yZHMpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYWNjICsgd29yZHMubGVuZ3RoO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICByZXR1cm4gYWNjO1xyXG4gICAgICAgICAgICB9LCAwKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHNldFRvdGFsV29yZHModG90YWwpO1xyXG4gICAgICByZXR1cm4gdG90YWw7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICByZXR1cm4gMDtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICAvLyA9PT09PT09PT09IFNBVVZFR0FSREUvQ0hBUkdFTUVOVCBDT1JSSUfDiSA9PT09PT09PT09XHJcbiAgY29uc3QgbG9hZFJldmlzaW9uUHJlZmVyZW5jZXMgPSBhc3luYyAoKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBzYXZlZCA9IGF3YWl0IEFzeW5jU3RvcmFnZS5nZXRJdGVtKFJFVklTSU9OX1NUT1JBR0VfS0VZKTtcclxuICAgICAgaWYgKHNhdmVkKSB7XHJcbiAgICAgICAgY29uc3QgcHJlZnMgPSBKU09OLnBhcnNlKHNhdmVkKTtcclxuICAgICAgICBzZXROZXh0UmV2aXNpb25BdChwcmVmcy5uZXh0UmV2aXNpb25BdCB8fCA1MCk7XHJcbiAgICAgICAgc2V0SXNEaXNhYmxlZChwcmVmcy5pc0Rpc2FibGVkIHx8IGZhbHNlKTsgLy8g4pyFIFZSQUkgRkxBR1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOKchSBWYWxldXJzIHBhciBkw6lmYXV0XHJcbiAgICAgICAgc2V0TmV4dFJldmlzaW9uQXQoNTApO1xyXG4gICAgICAgIHNldElzRGlzYWJsZWQoZmFsc2UpO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBsb2FkaW5nIHJldmlzaW9uIHByZWZlcmVuY2VzOicsIGVycm9yKTtcclxuICAgICAgc2V0TmV4dFJldmlzaW9uQXQoNTApO1xyXG4gICAgICBzZXRJc0Rpc2FibGVkKGZhbHNlKTtcclxuICAgIH0gZmluYWxseSB7XHJcbiAgICAgIHNldElzTG9hZGVkKHRydWUpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IHNhdmVSZXZpc2lvblByZWZlcmVuY2VzID0gYXN5bmMgKG5ld05leHRBdCwgbmV3SXNEaXNhYmxlZCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcHJlZnMgPSB7XHJcbiAgICAgICAgbmV4dFJldmlzaW9uQXQ6IG5ld05leHRBdCxcclxuICAgICAgICBpc0Rpc2FibGVkOiBuZXdJc0Rpc2FibGVkLFxyXG4gICAgICAgIGxhc3RVcGRhdGU6IERhdGUubm93KClcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIGF3YWl0IEFzeW5jU3RvcmFnZS5zZXRJdGVtKFJFVklTSU9OX1NUT1JBR0VfS0VZLCBKU09OLnN0cmluZ2lmeShwcmVmcykpO1xyXG4gICAgICBcclxuICAgICAgc2V0TmV4dFJldmlzaW9uQXQobmV3TmV4dEF0KTtcclxuICAgICAgc2V0SXNEaXNhYmxlZChuZXdJc0Rpc2FibGVkKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNhdmluZyByZXZpc2lvbiBwcmVmZXJlbmNlczonLCBlcnJvcik7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgLy8gPT09PT09PT09PSBDSEFSR0VNRU5UIElOSVRJQUwgPT09PT09PT09PVxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBjb25zdCBpbml0aWFsaXplUmV2aXNpb24gPSBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGF3YWl0IGxvYWRSZXZpc2lvblByZWZlcmVuY2VzKCk7XHJcbiAgICAgIGF3YWl0IGNvdW50V29yZHMoKTtcclxuICAgIH07XHJcblxyXG4gICAgaW5pdGlhbGl6ZVJldmlzaW9uKCk7XHJcbiAgfSwgW10pO1xyXG5cclxuICAvLyA9PT09PT09PT09IFbDiVJJRklDQVRJT04gUsOJVklTSU9OID09PT09PT09PT1cclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgLy8g4pyFIEFUVEVORFJFIHF1ZSB0b3V0IHNvaXQgY2hhcmfDqVxyXG4gICAgaWYgKCFpc0xvYWRlZCkgcmV0dXJuO1xyXG4gICAgXHJcbiAgICAvLyDinIUgVsOJUklGSUNBVElPTiBDT01QTMOIVEVcclxuICAgIGNvbnN0IHNob3VsZFNob3cgPSAhaXNEaXNhYmxlZCAmJiBcclxuICAgICAgICAgICAgICAgICAgICAgIHRvdGFsV29yZHMgPj0gbmV4dFJldmlzaW9uQXQgJiYgXHJcbiAgICAgICAgICAgICAgICAgICAgICB0b3RhbFdvcmRzID4gMCAmJiBcclxuICAgICAgICAgICAgICAgICAgICAgICFzaG93UG9wdXAgJiYgXHJcbiAgICAgICAgICAgICAgICAgICAgICAhcG9wdXBTaG93blJlZi5jdXJyZW50O1xyXG5cclxuICAgIGlmIChzaG91bGRTaG93KSB7XHJcbiAgICAgIC8vIOKchSBQUk9URUNUSU9OIGRvdWJsZS1wb3B1cFxyXG4gICAgICBwb3B1cFNob3duUmVmLmN1cnJlbnQgPSB0cnVlO1xyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHNldFNob3dQb3B1cCh0cnVlKSwgMTAwMCk7XHJcbiAgICB9XHJcbiAgfSwgW2lzTG9hZGVkLCBpc0Rpc2FibGVkLCB0b3RhbFdvcmRzLCBuZXh0UmV2aXNpb25BdCwgc2hvd1BvcHVwXSk7XHJcblxyXG4gIC8vID09PT09PT09PT0gSEFORExFUlMgQ09SUklHw4lTID09PT09PT09PT1cclxuICBjb25zdCBoYW5kbGVDaG9pY2UgPSB1c2VDYWxsYmFjayhhc3luYyAoY2hvaWNlKSA9PiB7XHJcbiAgICBzZXRTaG93UG9wdXAoZmFsc2UpO1xyXG4gICAgcG9wdXBTaG93blJlZi5jdXJyZW50ID0gZmFsc2U7IC8vIOKchSBSZXNldCBwcm90ZWN0aW9uXHJcbiAgICBcclxuICAgIHN3aXRjaCAoY2hvaWNlKSB7XHJcbiAgICAgIGNhc2UgJ25vdyc6IHtcclxuICAgICAgICAvLyDinIUgUHJvZ3JhbW1lciBwcm9jaGFpbmUgcsOpdmlzaW9uIEFWQU5UIG5hdmlnYXRpb25cclxuICAgICAgICBjb25zdCBuZXh0VGFyZ2V0ID0gdG90YWxXb3JkcyArIDUwO1xyXG4gICAgICAgIGF3YWl0IHNhdmVSZXZpc2lvblByZWZlcmVuY2VzKG5leHRUYXJnZXQsIGZhbHNlKTtcclxuICAgICAgICAvLyBOYXZpZ2F0aW9uXHJcbiAgICAgICAgcm91dGVyLnB1c2goe1xyXG4gICAgICAgICAgcGF0aG5hbWU6IFwiL3RhYnMvdm9jYWJ1bGFyeVJldmlzaW9uXCIsXHJcbiAgICAgICAgICBwYXJhbXM6IHtcclxuICAgICAgICAgICAgbGV2ZWw6IGN1cnJlbnRMZXZlbCxcclxuICAgICAgICAgICAgcXVlc3Rpb25zQ291bnQ6IDEwLFxyXG4gICAgICAgICAgICBzb3VyY2U6ICdwb3B1cF90cmlnZ2VyJ1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGNhc2UgJ2xhdGVyXzUwJzoge1xyXG4gICAgICAgIGNvbnN0IG5leHQ1MCA9IHRvdGFsV29yZHMgKyA1MDtcclxuICAgICAgICBhd2FpdCBzYXZlUmV2aXNpb25QcmVmZXJlbmNlcyhuZXh0NTAsIGZhbHNlKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBjYXNlICdsYXRlcl8xMDAnOiB7XHJcbiAgICAgICAgY29uc3QgbmV4dDEwMCA9IHRvdGFsV29yZHMgKyAxMDA7XHJcbiAgICAgICAgYXdhaXQgc2F2ZVJldmlzaW9uUHJlZmVyZW5jZXMobmV4dDEwMCwgZmFsc2UpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGNhc2UgJ2Rpc2FibGUnOiB7XHJcbiAgICAgICAgLy8g4pyFIFZSQUlFIETDiVNBQ1RJVkFUSU9OXHJcbiAgICAgICAgYXdhaXQgc2F2ZVJldmlzaW9uUHJlZmVyZW5jZXMobmV4dFJldmlzaW9uQXQsIHRydWUpOyAvLyDinIUgaXNEaXNhYmxlZCA9IHRydWVcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBkZWZhdWx0OiB7XHJcbiAgICAgICAgLy8gRmVybWV0dXJlID0gbGF0ZXJfNTAgcGFyIGTDqWZhdXRcclxuICAgICAgICBjb25zdCBkZWZhdWx0TmV4dCA9IHRvdGFsV29yZHMgKyA1MDtcclxuICAgICAgICBhd2FpdCBzYXZlUmV2aXNpb25QcmVmZXJlbmNlcyhkZWZhdWx0TmV4dCwgZmFsc2UpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSwgW3RvdGFsV29yZHMsIHNhdmVSZXZpc2lvblByZWZlcmVuY2VzLCBjdXJyZW50TGV2ZWwsIG5leHRSZXZpc2lvbkF0XSk7XHJcblxyXG4gIGNvbnN0IGhhbmRsZURpc21pc3MgPSB1c2VDYWxsYmFjaygoKSA9PiBoYW5kbGVDaG9pY2UoJ2xhdGVyXzUwJyksIFtoYW5kbGVDaG9pY2VdKTtcclxuXHJcbiAgLy8g4pyFIE5FIFBBUyBSRU5EUkUgU0kgRElTQUJMRURcclxuICBpZiAoaXNEaXNhYmxlZCkge1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gKFxyXG4gICAgPFJldmlzaW9uUG9wdXBcclxuICAgICAgdmlzaWJsZT17c2hvd1BvcHVwfVxyXG4gICAgICB0b3RhbFdvcmRzTGVhcm5lZD17dG90YWxXb3Jkc31cclxuICAgICAgcXVlc3Rpb25zQ291bnQ9ezEwfVxyXG4gICAgICBjdXJyZW50TGV2ZWw9e2N1cnJlbnRMZXZlbH1cclxuICAgICAgb25DaG9pY2U9e2hhbmRsZUNob2ljZX1cclxuICAgICAgb25EaXNtaXNzPXtoYW5kbGVEaXNtaXNzfVxyXG4gICAgLz5cclxuICApO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgUmV2aXNpb25PcmNoZXN0cmF0b3I7Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQ0EsSUFBQUEsTUFBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsV0FBQSxHQUFBRCxPQUFBO0FBQ0EsSUFBQUUsYUFBQSxHQUFBQyxzQkFBQSxDQUFBSCxPQUFBO0FBQ0EsSUFBQUksY0FBQSxHQUFBRCxzQkFBQSxDQUFBSCxPQUFBO0FBQTJFLElBQUFLLFdBQUEsR0FBQUwsT0FBQTtBQUUzRSxJQUFNTSxvQkFBb0IsR0FBRyxzQkFBc0I7QUFFbkQsSUFBTUMsb0JBQW9CLEdBQUcsU0FBdkJBLG9CQUFvQkEsQ0FBQUMsSUFBQSxFQUFtQztFQUFBLElBQUFDLGlCQUFBLEdBQUFELElBQUEsQ0FBN0JFLFlBQVk7SUFBWkEsWUFBWSxHQUFBRCxpQkFBQSxjQUFHLE9BQU8sR0FBQUEsaUJBQUE7RUFDcEQsSUFBQUUsU0FBQSxHQUFrQyxJQUFBQyxlQUFRLEVBQUMsS0FBSyxDQUFDO0lBQUFDLFVBQUEsT0FBQUMsZUFBQSxDQUFBQyxPQUFBLEVBQUFKLFNBQUE7SUFBMUNLLFNBQVMsR0FBQUgsVUFBQTtJQUFFSSxZQUFZLEdBQUFKLFVBQUE7RUFDOUIsSUFBQUssVUFBQSxHQUFvQyxJQUFBTixlQUFRLEVBQUMsQ0FBQyxDQUFDO0lBQUFPLFVBQUEsT0FBQUwsZUFBQSxDQUFBQyxPQUFBLEVBQUFHLFVBQUE7SUFBeENFLFVBQVUsR0FBQUQsVUFBQTtJQUFFRSxhQUFhLEdBQUFGLFVBQUE7RUFDaEMsSUFBQUcsVUFBQSxHQUE0QyxJQUFBVixlQUFRLEVBQUMsRUFBRSxDQUFDO0lBQUFXLFVBQUEsT0FBQVQsZUFB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QUksQ0FBQztjQUNWQyxRQUFRLEVBQUUsMEJBQTBCO2NBQ3BDQyxNQUFNLEVBQUU7Z0JBQ05sRCxLQUFLLEVBQUVoQyxZQUFZO2dCQUNuQm1GLGNBQWMsRUFBRSxFQUFFO2dCQUNsQkMsTUFBTSxFQUFFO2NBQ1Y7WUFDRixDQUFDLENBQUM7WUFDRjtVQUNGO1FBQ0EsS0FBSyxVQUFVO1VBQUU7WUFDZixJQUFNQyxNQUFNLEdBQUczRSxVQUFVLEdBQUcsRUFBRTtZQUM5QixNQUFNK0MsdUJBQXVCLENBQUM0QixNQUFNLEVBQUUsS0FBSyxDQUFDO1lBQzVDO1VBQ0Y7UUFDQSxLQUFLLFdBQVc7VUFBRTtZQUNoQixJQUFNQyxPQUFPLEdBQUc1RSxVQUFVLEdBQUcsR0FBRztZQUNoQyxNQUFNK0MsdUJBQXVCLENBQUM2QixPQUFPLEVBQUUsS0FBSyxDQUFDO1lBQzdDO1VBQ0Y7UUFDQSxLQUFLLFNBQVM7VUFBRTtZQUVkLE1BQU03Qix1QkFBdUIsQ0FBQzNDLGNBQWMsRUFBRSxJQUFJLENBQUM7WUFDbkQ7VUFDRjtRQUNBO1VBQVM7WUFFUCxJQUFNeUUsV0FBVyxHQUFHN0UsVUFBVSxHQUFHLEVBQUU7WUFDbkMsTUFBTStDLHVCQUF1QixDQUFDOEIsV0FBVyxFQUFFLEtBQUssQ0FBQztZQUNqRDtVQUNGO01BQ0Y7SUFDRixDQUFDO0lBQUEsaUJBQUFDLEdBQUE7TUFBQSxPQUFBWixLQUFBLENBQUExQixLQUFBLE9BQUFDLFNBQUE7SUFBQTtFQUFBLEtBQUUsQ0FBQ3pDLFVBQVUsRUFBRStDLHVCQUF1QixFQUFFekQsWUFBWSxFQUFFYyxjQUFjLENBQUMsQ0FBQztFQUV2RSxJQUFNMkUsYUFBYSxHQUFHLElBQUFkLGtCQUFXLEVBQUM7SUFBQSxPQUFNRCxZQUFZLENBQUMsVUFBVSxDQUFDO0VBQUEsR0FBRSxDQUFDQSxZQUFZLENBQUMsQ0FBQztFQUdqRixJQUFJeEQsVUFBVSxFQUFFO0lBQ2QsT0FBTyxJQUFJO0VBQ2I7RUFFQSxPQUNFLElBQUF2QixXQUFBLENBQUErRixHQUFBLEVBQUNoRyxjQUFBLENBQUFXLE9BQWE7SUFDWnNGLE9BQU8sRUFBRXJGLFNBQVU7SUFDbkJzRixpQkFBaUIsRUFBRWxGLFVBQVc7SUFDOUJ5RSxjQUFjLEVBQUUsRUFBRztJQUNuQm5GLFlBQVksRUFBRUEsWUFBYTtJQUMzQjZGLFFBQVEsRUFBRW5CLFlBQWE7SUFDdkJvQixTQUFTLEVBQUVMO0VBQWMsQ0FDMUIsQ0FBQztBQUVOLENBQUM7QUFBQyxJQUFBTSxRQUFBLEdBQUFDLE9BQUEsQ0FBQTNGLE9BQUEsR0FFYVIsb0JBQW9CIiwiaWdub3JlTGlzdCI6W119