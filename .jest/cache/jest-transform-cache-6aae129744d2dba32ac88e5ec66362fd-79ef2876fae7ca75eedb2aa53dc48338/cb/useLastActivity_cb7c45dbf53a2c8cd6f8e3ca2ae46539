be51dd4fb39beeeba1ce5562b3fc7326
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _react = require("react");
var _asyncStorage = _interopRequireDefault(require("@react-native-async-storage/async-storage"));
var _constants = require("../utils/constants");
var useLastActivity = function useLastActivity() {
  var _useState = (0, _react.useState)(null),
    _useState2 = (0, _slicedToArray2.default)(_useState, 2),
    lastActivity = _useState2[0],
    setLastActivity = _useState2[1];
  var _useState3 = (0, _react.useState)(true),
    _useState4 = (0, _slicedToArray2.default)(_useState3, 2),
    isLoading = _useState4[0],
    setIsLoading = _useState4[1];
  var loadLastActivity = (0, _react.useCallback)((0, _asyncToGenerator2.default)(function* () {
    try {
      setIsLoading(true);
      var stored = yield _asyncStorage.default.getItem(_constants.STORAGE_KEYS.LAST_ACTIVITY);
      if (stored) {
        var activity = JSON.parse(stored);
        var now = Date.now();
        var diffInMinutes = Math.floor((now - activity.timestamp) / (1000 * 60));
        var timeElapsed = "À l'instant";
        if (diffInMinutes < 60) {
          timeElapsed = diffInMinutes === 0 ? "À l'instant" : `Il y a ${diffInMinutes} min`;
        } else if (diffInMinutes < 1440) {
          var hours = Math.floor(diffInMinutes / 60);
          timeElapsed = `Il y a ${hours}h`;
        } else {
          var days = Math.floor(diffInMinutes / 1440);
          timeElapsed = `Il y a ${days}j`;
        }
        setLastActivity(Object.assign({}, activity, {
          timeElapsed: timeElapsed
        }));
      } else {
        setLastActivity(null);
      }
    } catch (error) {
      console.error('Erreur chargement dernière activité:', error);
      setLastActivity(null);
    } finally {
      setIsLoading(false);
    }
  }), []);
  var saveActivity = (0, _react.useCallback)(function () {
    var _ref2 = (0, _asyncToGenerator2.default)(function* (activityData) {
      try {
        var activity = Object.assign({}, activityData, {
          timestamp: Date.now()
        });
        yield _asyncStorage.default.setItem(_constants.STORAGE_KEYS.LAST_ACTIVITY, JSON.stringify(activity));
        try {
          require('../utils/eventBus').emit('progress-updated', activity);
        } catch (e) {}
        setLastActivity(Object.assign({}, activity, {
          timeElapsed: "À l'instant"
        }));
      } catch (error) {
        console.error('Erreur sauvegarde activité:', error);
      }
    });
    return function (_x) {
      return _ref2.apply(this, arguments);
    };
  }(), []);
  var clearActivity = (0, _react.useCallback)((0, _asyncToGenerator2.default)(function* () {
    try {
      yield _asyncStorage.default.removeItem(_constants.STORAGE_KEYS.LAST_ACTIVITY);
      setLastActivity(null);
    } catch (error) {
      console.error('Erreur suppression activité:', error);
    }
  }), []);
  (0, _react.useEffect)(function () {
    loadLastActivity();
  }, [loadLastActivity]);
  return {
    lastActivity: lastActivity,
    isLoading: isLoading,
    saveActivity: saveActivity,
    clearActivity: clearActivity,
    reload: loadLastActivity
  };
};
var _default = exports.default = useLastActivity;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJyZXF1aXJlIiwiX2FzeW5jU3RvcmFnZSIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJfY29uc3RhbnRzIiwidXNlTGFzdEFjdGl2aXR5IiwiX3VzZVN0YXRlIiwidXNlU3RhdGUiLCJfdXNlU3RhdGUyIiwiX3NsaWNlZFRvQXJyYXkyIiwiZGVmYXVsdCIsImxhc3RBY3Rpdml0eSIsInNldExhc3RBY3Rpdml0eSIsIl91c2VTdGF0ZTMiLCJfdXNlU3RhdGU0IiwiaXNMb2FkaW5nIiwic2V0SXNMb2FkaW5nIiwibG9hZExhc3RBY3Rpdml0eSIsInVzZUNhbGxiYWNrIiwiX2FzeW5jVG9HZW5lcmF0b3IyIiwic3RvcmVkIiwiQXN5bmNTdG9yYWdlIiwiZ2V0SXRlbSIsIlNUT1JBR0VfS0VZUyIsIkxBU1RfQUNUSVZJVFkiLCJhY3Rpdml0eSIsIkpTT04iLCJwYXJzZSIsIm5vdyIsIkRhdGUiLCJkaWZmSW5NaW51dGVzIiwiTWF0aCIsImZsb29yIiwidGltZXN0YW1wIiwidGltZUVsYXBzZWQiLCJob3VycyIsImRheXMiLCJPYmplY3QiLCJhc3NpZ24iLCJlcnJvciIsImNvbnNvbGUiLCJzYXZlQWN0aXZpdHkiLCJfcmVmMiIsImFjdGl2aXR5RGF0YSIsInNldEl0ZW0iLCJzdHJpbmdpZnkiLCJlbWl0IiwiZSIsIl94IiwiYXBwbHkiLCJhcmd1bWVudHMiLCJjbGVhckFjdGl2aXR5IiwicmVtb3ZlSXRlbSIsInVzZUVmZmVjdCIsInJlbG9hZCIsIl9kZWZhdWx0IiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInVzZUxhc3RBY3Rpdml0eS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvaG9va3MvdXNlTGFzdEFjdGl2aXR5LmpzIC0gVkVSU0lPTiBDT1JSSUfDiUUgQVZFQyB1c2VDYWxsYmFja1xuaW1wb3J0IHsgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgQXN5bmNTdG9yYWdlIGZyb20gJ0ByZWFjdC1uYXRpdmUtYXN5bmMtc3RvcmFnZS9hc3luYy1zdG9yYWdlJztcbmltcG9ydCB7IFNUT1JBR0VfS0VZUyB9IGZyb20gJy4uL3V0aWxzL2NvbnN0YW50cyc7XG5cbmNvbnN0IHVzZUxhc3RBY3Rpdml0eSA9ICgpID0+IHtcbiAgY29uc3QgW2xhc3RBY3Rpdml0eSwgc2V0TGFzdEFjdGl2aXR5XSA9IHVzZVN0YXRlKG51bGwpO1xuICBjb25zdCBbaXNMb2FkaW5nLCBzZXRJc0xvYWRpbmddID0gdXNlU3RhdGUodHJ1ZSk7XG5cbiAgLy8gPT09PT09PT09PSBDSEFSR0VNRU5UID09PT09PT09PT1cbiAgY29uc3QgbG9hZExhc3RBY3Rpdml0eSA9IHVzZUNhbGxiYWNrKGFzeW5jICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgc2V0SXNMb2FkaW5nKHRydWUpO1xuICAgICAgY29uc3Qgc3RvcmVkID0gYXdhaXQgQXN5bmNTdG9yYWdlLmdldEl0ZW0oU1RPUkFHRV9LRVlTLkxBU1RfQUNUSVZJVFkpO1xuICAgICAgXG4gICAgICBpZiAoc3RvcmVkKSB7XG4gICAgICAgIGNvbnN0IGFjdGl2aXR5ID0gSlNPTi5wYXJzZShzdG9yZWQpO1xuICAgICAgICBcbiAgICAgICAgLy8gQ2FsY3VsZXIgdGVtcHMgw6ljb3Vsw6kgc2ltcGxlXG4gICAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgICAgIGNvbnN0IGRpZmZJbk1pbnV0ZXMgPSBNYXRoLmZsb29yKChub3cgLSBhY3Rpdml0eS50aW1lc3RhbXApIC8gKDEwMDAgKiA2MCkpO1xuICAgICAgICBcbiAgICAgICAgbGV0IHRpbWVFbGFwc2VkID0gXCLDgCBsJ2luc3RhbnRcIjtcbiAgICAgICAgaWYgKGRpZmZJbk1pbnV0ZXMgPCA2MCkge1xuICAgICAgICAgIHRpbWVFbGFwc2VkID0gZGlmZkluTWludXRlcyA9PT0gMCA/IFwiw4AgbCdpbnN0YW50XCIgOiBgSWwgeSBhICR7ZGlmZkluTWludXRlc30gbWluYDtcbiAgICAgICAgfSBlbHNlIGlmIChkaWZmSW5NaW51dGVzIDwgMTQ0MCkge1xuICAgICAgICAgIGNvbnN0IGhvdXJzID0gTWF0aC5mbG9vcihkaWZmSW5NaW51dGVzIC8gNjApO1xuICAgICAgICAgIHRpbWVFbGFwc2VkID0gYElsIHkgYSAke2hvdXJzfWhgO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IGRheXMgPSBNYXRoLmZsb29yKGRpZmZJbk1pbnV0ZXMgLyAxNDQwKTtcbiAgICAgICAgICB0aW1lRWxhcHNlZCA9IGBJbCB5IGEgJHtkYXlzfWpgO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBzZXRMYXN0QWN0aXZpdHkoe1xuICAgICAgICAgIC4uLmFjdGl2aXR5LFxuICAgICAgICAgIHRpbWVFbGFwc2VkXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2V0TGFzdEFjdGl2aXR5KG51bGwpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJldXIgY2hhcmdlbWVudCBkZXJuacOocmUgYWN0aXZpdMOpOicsIGVycm9yKTtcbiAgICAgIHNldExhc3RBY3Rpdml0eShudWxsKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgc2V0SXNMb2FkaW5nKGZhbHNlKTtcbiAgICB9XG4gIH0sIFtdKTsgLy8g4pyFIEF1Y3VuZSBkw6lwZW5kYW5jZSAtIHN0YWJsZVxuXG4gIC8vID09PT09PT09PT0gU0FVVkVHQVJERSBNw4lNT1JJU8OJRSA9PT09PT09PT09XG4gIGNvbnN0IHNhdmVBY3Rpdml0eSA9IHVzZUNhbGxiYWNrKGFzeW5jIChhY3Rpdml0eURhdGEpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYWN0aXZpdHkgPSB7XG4gICAgICAgIC4uLmFjdGl2aXR5RGF0YSxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpXG4gICAgICB9O1xuICAgICAgXG4gICAgICBhd2FpdCBBc3luY1N0b3JhZ2Uuc2V0SXRlbShTVE9SQUdFX0tFWVMuTEFTVF9BQ1RJVklUWSwgSlNPTi5zdHJpbmdpZnkoYWN0aXZpdHkpKTtcbiAgICAgIFxuICAgICAgLy8gRXZlbnQgYnVzIDogbm90aWZpZXIgbGEgcHJvZ3Jlc3Npb25cbiAgICAgIHRyeSB7IHJlcXVpcmUoJy4uL3V0aWxzL2V2ZW50QnVzJykuZW1pdCgncHJvZ3Jlc3MtdXBkYXRlZCcsIGFjdGl2aXR5KTsgfSBjYXRjaChlKSB7IC8qIGVtcHR5ICovIH1cbiAgICAgIC8vIE1ldHRyZSDDoCBqb3VyIGwnw6l0YXQgbG9jYWwgYXZlYyB0ZW1wcyDDqWNvdWzDqVxuICAgICAgc2V0TGFzdEFjdGl2aXR5KHtcbiAgICAgICAgLi4uYWN0aXZpdHksXG4gICAgICAgIHRpbWVFbGFwc2VkOiBcIsOAIGwnaW5zdGFudFwiXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyZXVyIHNhdXZlZ2FyZGUgYWN0aXZpdMOpOicsIGVycm9yKTtcbiAgICB9XG4gIH0sIFtdKTsgLy8g4pyFIENSVUNJQUwgOiBBdWN1bmUgZMOpcGVuZGFuY2UgLSBmb25jdGlvbiBzdGFibGVcblxuICAvLyA9PT09PT09PT09IFNVUFBSRVNTSU9OIE3DiU1PUklTw4lFID09PT09PT09PT1cbiAgY29uc3QgY2xlYXJBY3Rpdml0eSA9IHVzZUNhbGxiYWNrKGFzeW5jICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgQXN5bmNTdG9yYWdlLnJlbW92ZUl0ZW0oU1RPUkFHRV9LRVlTLkxBU1RfQUNUSVZJVFkpO1xuICAgICAgc2V0TGFzdEFjdGl2aXR5KG51bGwpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJldXIgc3VwcHJlc3Npb24gYWN0aXZpdMOpOicsIGVycm9yKTtcbiAgICB9XG4gIH0sIFtdKTsgLy8g4pyFIEZvbmN0aW9uIHN0YWJsZVxuXG4gIC8vID09PT09PT09PT0gQ0hBUkdFTUVOVCBJTklUSUFMID09PT09PT09PT1cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBsb2FkTGFzdEFjdGl2aXR5KCk7XG4gIH0sIFtsb2FkTGFzdEFjdGl2aXR5XSk7XG5cbiAgcmV0dXJuIHtcbiAgICBsYXN0QWN0aXZpdHksXG4gICAgaXNMb2FkaW5nLFxuICAgIHNhdmVBY3Rpdml0eSwgLy8g4pyFIE1haW50ZW5hbnQgc3RhYmxlIGVudHJlIGxlcyByZW5kZXJzXG4gICAgY2xlYXJBY3Rpdml0eSwgLy8g4pyFIE1haW50ZW5hbnQgc3RhYmxlXG4gICAgcmVsb2FkOiBsb2FkTGFzdEFjdGl2aXR5IC8vIOKchSBNYWludGVuYW50IHN0YWJsZVxuICB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgdXNlTGFzdEFjdGl2aXR5OyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUNBLElBQUFBLE1BQUEsR0FBQUMsT0FBQTtBQUNBLElBQUFDLGFBQUEsR0FBQUMsc0JBQUEsQ0FBQUYsT0FBQTtBQUNBLElBQUFHLFVBQUEsR0FBQUgsT0FBQTtBQUVBLElBQU1JLGVBQWUsR0FBRyxTQUFsQkEsZUFBZUEsQ0FBQSxFQUFTO0VBQzVCLElBQUFDLFNBQUEsR0FBd0MsSUFBQUMsZUFBUSxFQUFDLElBQUksQ0FBQztJQUFBQyxVQUFBLE9BQUFDLGVBQUEsQ0FBQUMsT0FBQSxFQUFBSixTQUFBO0lBQS9DSyxZQUFZLEdBQUFILFVBQUE7SUFBRUksZUFBZSxHQUFBSixVQUFBO0VBQ3BDLElBQUFLLFVBQUEsR0FBa0MsSUFBQU4sZUFBUSxFQUFDLElBQUksQ0FBQztJQUFBTyxVQUFBLE9BQUFMLGVBQUEsQ0FBQUMsT0FBQSxFQUFBRyxVQUFBO0lBQXpDRSxTQUFTLEdBQUFELFVBQUE7SUFBRUUsWUFBWSxHQUFBRixVQUFBO0VBRzlCLElBQU1HLGdCQUFnQixHQUFHLElBQUFDLGtCQUFXLE1BQUFDLGtCQUFBLENBQUFULE9BQUEsRUFBQyxhQUFZO0lBQy9DLElBQUk7TUFDRk0sWUFBWSxDQUFDLElBQUksQ0FBQztNQUNsQixJQUFNSSxN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