c12980dd4b0b684440e12c42c2f33c30
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useRevisionSettings = void 0;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _react = require("react");
var _asyncStorage = _interopRequireDefault(require("@react-native-async-storage/async-storage"));
var REVISION_STORAGE_KEY = 'revision_preferences';
var useRevisionSettings = exports.useRevisionSettings = function useRevisionSettings() {
  var _useState = (0, _react.useState)({
      isDisabled: false,
      nextRevisionAt: 50,
      frequency: 50,
      questionsCount: 10
    }),
    _useState2 = (0, _slicedToArray2.default)(_useState, 2),
    preferences = _useState2[0],
    setPreferences = _useState2[1];
  var _useState3 = (0, _react.useState)(true),
    _useState4 = (0, _slicedToArray2.default)(_useState3, 2),
    isLoading = _useState4[0],
    setIsLoading = _useState4[1];
  var loadPreferences = function () {
    var _ref = (0, _asyncToGenerator2.default)(function* () {
      try {
        var saved = yield _asyncStorage.default.getItem(REVISION_STORAGE_KEY);
        if (saved) {
          var prefs = JSON.parse(saved);
          setPreferences({
            isDisabled: prefs.isDisabled || false,
            nextRevisionAt: prefs.nextRevisionAt || 50,
            frequency: prefs.frequency || 50,
            questionsCount: prefs.questionsCount || 10
          });
        }
      } catch (error) {} finally {
        setIsLoading(false);
      }
    });
    return function loadPreferences() {
      return _ref.apply(this, arguments);
    };
  }();
  (0, _react.useEffect)(function () {
    loadPreferences();
  }, []);
  var updatePreferences = function () {
    var _ref2 = (0, _asyncToGenerator2.default)(function* (newPrefs) {
      try {
        var updatedPrefs = Object.assign({}, preferences, newPrefs, {
          lastUpdate: Date.now()
        });
        yield _asyncStorage.default.setItem(REVISION_STORAGE_KEY, JSON.stringify(updatedPrefs));
        setPreferences(updatedPrefs);
        try {
          require('../utils/eventBus').emit('settings-updated', updatedPrefs);
        } catch (e) {}
        return true;
      } catch (error) {
        return null;
      }
    });
    return function updatePreferences(_x) {
      return _ref2.apply(this, arguments);
    };
  }();
  var enableRevisions = function enableRevisions() {
    var frequency = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 50;
    var questionsCount = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 10;
    return updatePreferences({
      isDisabled: false,
      frequency: frequency,
      questionsCount: questionsCount,
      nextRevisionAt: frequency
    });
  };
  var disableRevisions = function disableRevisions() {
    return updatePreferences({
      isDisabled: true
    });
  };
  var updateFrequency = function updateFrequency(newFrequency) {
    return updatePreferences({
      frequency: newFrequency,
      nextRevisionAt: newFrequency
    });
  };
  var resetToNextTarget = function resetToNextTarget(wordsLearned) {
    var newTarget = wordsLearned + preferences.frequency;
    return updatePreferences({
      nextRevisionAt: newTarget
    });
  };
  return {
    preferences: preferences,
    isLoading: isLoading,
    enableRevisions: enableRevisions,
    disableRevisions: disableRevisions,
    updateFrequency: updateFrequency,
    updatePreferences: updatePreferences,
    resetToNextTarget: resetToNextTarget
  };
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJyZXF1aXJlIiwiX2FzeW5jU3RvcmFnZSIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJSRVZJU0lPTl9TVE9SQUdFX0tFWSIsInVzZVJldmlzaW9uU2V0dGluZ3MiLCJleHBvcnRzIiwiX3VzZVN0YXRlIiwidXNlU3RhdGUiLCJpc0Rpc2FibGVkIiwibmV4dFJldmlzaW9uQXQiLCJmcmVxdWVuY3kiLCJxdWVzdGlvbnNDb3VudCIsIl91c2VTdGF0ZTIiLCJfc2xpY2VkVG9BcnJheTIiLCJkZWZhdWx0IiwicHJlZmVyZW5jZXMiLCJzZXRQcmVmZXJlbmNlcyIsIl91c2VTdGF0ZTMiLCJfdXNlU3RhdGU0IiwiaXNMb2FkaW5nIiwic2V0SXNMb2FkaW5nIiwibG9hZFByZWZlcmVuY2VzIiwiX3JlZiIsIl9hc3luY1RvR2VuZXJhdG9yMiIsInNhdmVkIiwiQXN5bmNTdG9yYWdlIiwiZ2V0SXRlbSIsInByZWZzIiwiSlNPTiIsInBhcnNlIiwiZXJyb3IiLCJhcHBseSIsImFyZ3VtZW50cyIsInVzZUVmZmVjdCIsInVwZGF0ZVByZWZlcmVuY2VzIiwiX3JlZjIiLCJuZXdQcmVmcyIsInVwZGF0ZWRQcmVmcyIsIk9iamVjdCIsImFzc2lnbiIsImxhc3RVcGRhdGUiLCJEYXRlIiwibm93Iiwic2V0SXRlbSIsInN0cmluZ2lmeSIsImVtaXQiLCJlIiwiX3giLCJlbmFibGVSZXZpc2lvbnMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJkaXNhYmxlUmV2aXNpb25zIiwidXBkYXRlRnJlcXVlbmN5IiwibmV3RnJlcXVlbmN5IiwicmVzZXRUb05leHRUYXJnZXQiLCJ3b3Jkc0xlYXJuZWQiLCJuZXdUYXJnZXQiXSwic291cmNlcyI6WyJ1c2VSZXZpc2lvblNldHRpbmdzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9ob29rcy91c2VSZXZpc2lvblNldHRpbmdzLmpzIC0gSE9PSyBQT1VSIE1FTlUgU0VUVElOR1NcbmltcG9ydCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgQXN5bmNTdG9yYWdlIGZyb20gJ0ByZWFjdC1uYXRpdmUtYXN5bmMtc3RvcmFnZS9hc3luYy1zdG9yYWdlJztcblxuY29uc3QgUkVWSVNJT05fU1RPUkFHRV9LRVkgPSAncmV2aXNpb25fcHJlZmVyZW5jZXMnO1xuXG5leHBvcnQgY29uc3QgdXNlUmV2aXNpb25TZXR0aW5ncyA9ICgpID0+IHtcbiAgY29uc3QgW3ByZWZlcmVuY2VzLCBzZXRQcmVmZXJlbmNlc10gPSB1c2VTdGF0ZSh7XG4gICAgaXNEaXNhYmxlZDogZmFsc2UsXG4gICAgbmV4dFJldmlzaW9uQXQ6IDUwLFxuICAgIGZyZXF1ZW5jeTogNTAsIC8vIFRvdXMgbGVzIFggbW90c1xuICAgIHF1ZXN0aW9uc0NvdW50OiAxMFxuICB9KTtcbiAgY29uc3QgW2lzTG9hZGluZywgc2V0SXNMb2FkaW5nXSA9IHVzZVN0YXRlKHRydWUpO1xuXG4gIGNvbnN0IGxvYWRQcmVmZXJlbmNlcyA9IGFzeW5jICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc2F2ZWQgPSBhd2FpdCBBc3luY1N0b3JhZ2UuZ2V0SXRlbShSRVZJU0lPTl9TVE9SQUdFX0tFWSk7XG4gICAgICBpZiAoc2F2ZWQpIHtcbiAgICAgICAgY29uc3QgcHJlZnMgPSBKU09OLnBhcnNlKHNhdmVkKTtcbiAgICAgICAgc2V0UHJlZmVyZW5jZXMoe1xuICAgICAgICAgIGlzRGlzYWJsZWQ6IHByZWZzLmlzRGlzYWJsZWQgfHwgZmFsc2UsXG4gICAgICAgICAgbmV4dFJldmlzaW9uQXQ6IHByZWZzLm5leHRSZXZpc2lvbkF0IHx8IDUwLFxuICAgICAgICAgIGZyZXF1ZW5jeTogcHJlZnMuZnJlcXVlbmN5IHx8IDUwLFxuICAgICAgICAgIHF1ZXN0aW9uc0NvdW50OiBwcmVmcy5xdWVzdGlvbnNDb3VudCB8fCAxMFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gSWdub3JlZCBvbiBwdXJwb3NlOiBlbXB0eSBibG9jayB0byBzdXBwcmVzcyBlcnJvclxuICAgIH0gZmluYWxseSB7XG4gICAgICBzZXRJc0xvYWRpbmcoZmFsc2UpO1xuICAgIH1cbiAgfTtcblxuICAvLyA9PT09PT09PT09IENIQVJHRU1FTlQgPT09PT09PT09PVxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGxvYWRQcmVmZXJlbmNlcygpO1xuICB9LCBbXSk7XG5cbiAgLy8gPT09PT09PT09PSBTQVVWRUdBUkRFID09PT09PT09PT1cbiAgY29uc3QgdXBkYXRlUHJlZmVyZW5jZXMgPSBhc3luYyAobmV3UHJlZnMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXBkYXRlZFByZWZzID0geyAuLi5wcmVmZXJlbmNlcywgLi4ubmV3UHJlZnMsIGxhc3RVcGRhdGU6IERhdGUubm93KCkgfTtcbiAgICAgIGF3YWl0IEFzeW5jU3RvcmFnZS5zZXRJdGVtKFJFVklTSU9OX1NUT1JBR0VfS0VZLCBKU09OLnN0cmluZ2lmeSh1cGRhdGVkUHJlZnMpKTtcbiAgICAgIHNldFByZWZlcmVuY2VzKHVwZGF0ZWRQcmVmcyk7XG4gICAgICAvLyDDiXbDqW5lbWVudCBkZSBtaXNlIMOgIGpvdXIgZGVzIHNldHRpbmdzXG4gICAgICB0cnkgeyByZXF1aXJlKCcuLi91dGlscy9ldmVudEJ1cycpLmVtaXQoJ3NldHRpbmdzLXVwZGF0ZWQnLCB1cGRhdGVkUHJlZnMpOyB9IGNhdGNoKGUpIHsgLyogZW1wdHk6IGV2ZW50QnVzIG5vdCBjcml0aWNhbCAqLyB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gSWdub3JlZCBvbiBwdXJwb3NlOiBlbXB0eSBibG9jayB0byBzdXBwcmVzcyBlcnJvclxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9O1xuXG4gIC8vID09PT09PT09PT0gQUNUSU9OUyBTUMOJQ0lGSVFVRVMgPT09PT09PT09PVxuICBjb25zdCBlbmFibGVSZXZpc2lvbnMgPSAoZnJlcXVlbmN5ID0gNTAsIHF1ZXN0aW9uc0NvdW50ID0gMTApID0+IHtcbiAgICByZXR1cm4gdXBkYXRlUHJlZmVyZW5jZXMoe1xuICAgICAgaXNEaXNhYmxlZDogZmFsc2UsXG4gICAgICBmcmVxdWVuY3ksXG4gICAgICBxdWVzdGlvbnNDb3VudCxcbiAgICAgIG5leHRSZXZpc2lvbkF0OiBmcmVxdWVuY3kgLy8gUmVzZXQgdGFyZ2V0XG4gICAgfSk7XG4gIH07XG5cbiAgY29uc3QgZGlzYWJsZVJldmlzaW9ucyA9ICgpID0+IHtcbiAgICByZXR1cm4gdXBkYXRlUHJlZmVyZW5jZXMoeyBpc0Rpc2FibGVkOiB0cnVlIH0pO1xuICB9O1xuXG4gIGNvbnN0IHVwZGF0ZUZyZXF1ZW5jeSA9IChuZXdGcmVxdWVuY3kpID0+IHtcbiAgICByZXR1cm4gdXBkYXRlUHJlZmVyZW5jZXMoeyBcbiAgICAgIGZyZXF1ZW5jeTogbmV3RnJlcXVlbmN5LFxuICAgICAgbmV4dFJldmlzaW9uQXQ6IG5ld0ZyZXF1ZW5jeSAvLyBSZXNldCB0YXJnZXRcbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCByZXNldFRvTmV4dFRhcmdldCA9ICh3b3Jkc0xlYXJuZWQpID0+IHtcbiAgICBjb25zdCBuZXdUYXJnZXQgPSB3b3Jkc0xlYXJuZWQgKyBwcmVmZXJlbmNlcy5mcmVxdWVuY3k7XG4gICAgcmV0dXJuIHVwZGF0ZVByZWZlcmVuY2VzKHsgbmV4dFJldmlzaW9uQXQ6IG5ld1RhcmdldCB9KTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIHByZWZlcmVuY2VzLFxuICAgIGlzTG9hZGluZyxcbiAgICBlbmFibGVSZXZpc2lvbnMsXG4gICAgZGlzYWJsZVJldmlzaW9ucyxcbiAgICB1cGRhdGVGcmVxdWVuY3ksXG4gICAgdXBkYXRlUHJlZmVyZW5jZXMsXG4gICAgcmVzZXRUb05leHRUYXJnZXRcbiAgfTtcbn07XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFDQSxJQUFBQSxNQUFBLEdBQUFDLE9BQUE7QUFDQSxJ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