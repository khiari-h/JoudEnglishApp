{"version":3,"names":["Object","defineProperty","exports","value","startWebLayoutAnimation","tryActivateLayoutTransition","_config","require","_commonTypes","_createAnimation","_componentUtils","_domUtils","_animationBuilder","_componentStyle","_Easing","_logger","chooseConfig","animationType","props","config","LayoutAnimationType","ENTERING","entering","EXITING","exiting","LAYOUT","layout","checkUndefinedAnimationFail","initialAnimationName","needsCustomization","Animations","logger","warn","maybeReportOverwrittenProperties","keyframe","styles","propertyRegex","animationProperties","Set","match","matchAll","add","commonProperties","Array","from","filter","style","has","length","join","chooseAction","animationConfig","element","transitionData","setElementAnimation","reversed","handleLayoutTransition","handleExitingAnimation","tryGetAnimationConfig","isLayoutTransition","isCustomKeyframe","Keyframe","hasInitialValues","initialValues","undefined","animationName","createCustomKeyFrameAnimation","definitions","presetName","constructor","createAnimationWithInitialValues","shouldFail","keyframeTimestamps","keys","includes","getProcessedConfig","maybeModifyStyleForKeyframe","makeElementVisible","snapshot","_enteringV","_exitingV","_easingXV$EasingNameS","_easingXV","_easingYV$EasingNameS","_easingYV","rect","getBoundingClientRect","areDOMRectsEqual","enteringAnimation","enteringV","exitingAnimation","exitingV","translateX","x","translateY","y","scaleX","width","scaleY","height","easingX","easingXV","EasingNameSymbol","easingY","easingYV"],"sources":["animationsManager.ts"],"sourcesContent":["'use strict';\n\nimport type {\n  AnimationConfig,\n  AnimationNames,\n  CustomConfig,\n  InitialValuesStyleProps,\n  KeyframeDefinitions,\n} from './config';\nimport { Animations } from './config';\nimport type {\n  AnimatedComponentProps,\n  LayoutAnimationStaticContext,\n} from '../../createAnimatedComponent/commonTypes';\nimport { LayoutAnimationType } from '../animationBuilder/commonTypes';\nimport {\n  createAnimationWithInitialValues,\n  createCustomKeyFrameAnimation,\n} from './createAnimation';\nimport {\n  getProcessedConfig,\n  handleExitingAnimation,\n  handleLayoutTransition,\n  maybeModifyStyleForKeyframe,\n  setElementAnimation,\n} from './componentUtils';\nimport { areDOMRectsEqual } from './domUtils';\nimport type { TransitionData } from './animationParser';\nimport { Keyframe } from '../animationBuilder';\nimport { makeElementVisible } from './componentStyle';\nimport { EasingNameSymbol } from '../../Easing';\nimport type { ReanimatedHTMLElement } from '../../js-reanimated';\nimport { logger } from '../../logger';\n\nfunction chooseConfig<ComponentProps extends Record<string, unknown>>(\n  animationType: LayoutAnimationType,\n  props: Readonly<AnimatedComponentProps<ComponentProps>>\n) {\n  const config =\n    animationType === LayoutAnimationType.ENTERING\n      ? props.entering\n      : animationType === LayoutAnimationType.EXITING\n        ? props.exiting\n        : animationType === LayoutAnimationType.LAYOUT\n          ? props.layout\n          : null;\n\n  return config;\n}\n\nfunction checkUndefinedAnimationFail(\n  initialAnimationName: string,\n  needsCustomization: boolean\n) {\n  // This prevents crashes if we try to set animations that are not defined.\n  // We don't care about layout transitions or custom keyframes since they're created dynamically\n  if (initialAnimationName in Animations || needsCustomization) {\n    return false;\n  }\n\n  logger.warn(\n    \"Couldn't load entering/exiting animation. Current version supports only predefined animations with modifiers: duration, delay, easing, randomizeDelay, withCallback, reducedMotion.\"\n  );\n\n  return true;\n}\n\nfunction maybeReportOverwrittenProperties(\n  keyframe: string,\n  styles: CSSStyleDeclaration\n) {\n  const propertyRegex = /([a-zA-Z-]+)(?=:)/g;\n  const animationProperties = new Set();\n\n  for (const match of keyframe.matchAll(propertyRegex)) {\n    animationProperties.add(match[1]);\n  }\n\n  const commonProperties = Array.from(styles).filter((style) =>\n    animationProperties.has(style)\n  );\n\n  if (commonProperties.length === 0) {\n    return;\n  }\n\n  logger.warn(\n    `${\n      commonProperties.length === 1 ? 'Property' : 'Properties'\n    } [${commonProperties.join(\n      ', '\n    )}] may be overwritten by a layout animation. Please wrap your component with an animated view and apply the layout animation on the wrapper.`\n  );\n}\n\nfunction chooseAction(\n  animationType: LayoutAnimationType,\n  animationConfig: AnimationConfig,\n  element: ReanimatedHTMLElement,\n  transitionData: TransitionData\n) {\n  switch (animationType) {\n    case LayoutAnimationType.ENTERING:\n      setElementAnimation(element, animationConfig, true);\n      break;\n    case LayoutAnimationType.LAYOUT:\n      transitionData.reversed = animationConfig.reversed;\n      handleLayoutTransition(element, animationConfig, transitionData);\n      break;\n    case LayoutAnimationType.EXITING:\n      handleExitingAnimation(element, animationConfig);\n      break;\n  }\n}\n\nfunction tryGetAnimationConfig<ComponentProps extends Record<string, unknown>>(\n  props: Readonly<AnimatedComponentProps<ComponentProps>>,\n  animationType: LayoutAnimationType\n) {\n  const config = chooseConfig(animationType, props);\n  if (!config) {\n    return null;\n  }\n\n  type ConstructorWithStaticContext = LayoutAnimationStaticContext &\n    typeof config.constructor;\n\n  const isLayoutTransition = animationType === LayoutAnimationType.LAYOUT;\n  const isCustomKeyframe = config instanceof Keyframe;\n  const hasInitialValues = (config as CustomConfig).initialValues !== undefined;\n\n  let animationName;\n\n  if (isCustomKeyframe) {\n    animationName = createCustomKeyFrameAnimation(\n      (config as CustomConfig).definitions as KeyframeDefinitions\n    );\n  } else if (typeof config === 'function') {\n    animationName = config.presetName;\n  } else {\n    animationName = (config.constructor as ConstructorWithStaticContext)\n      .presetName;\n  }\n\n  if (hasInitialValues) {\n    animationName = createAnimationWithInitialValues(\n      animationName,\n      (config as CustomConfig).initialValues as InitialValuesStyleProps\n    );\n  }\n\n  const shouldFail = checkUndefinedAnimationFail(\n    animationName,\n    isLayoutTransition || isCustomKeyframe || hasInitialValues\n  );\n\n  if (shouldFail) {\n    return null;\n  }\n\n  if (isCustomKeyframe) {\n    const keyframeTimestamps = Object.keys(\n      (config as CustomConfig).definitions as KeyframeDefinitions\n    );\n\n    if (\n      !(keyframeTimestamps.includes('100') || keyframeTimestamps.includes('to'))\n    ) {\n      logger.warn(\n        `Neither '100' nor 'to' was specified in Keyframe definition. This may result in wrong final position of your component. One possible solution is to duplicate last timestamp in definition as '100' (or 'to')`\n      );\n    }\n  }\n\n  const animationConfig = getProcessedConfig(\n    animationName,\n    animationType,\n    config as CustomConfig\n  );\n\n  return animationConfig;\n}\n\nexport function startWebLayoutAnimation<\n  ComponentProps extends Record<string, unknown>,\n>(\n  props: Readonly<AnimatedComponentProps<ComponentProps>>,\n  element: ReanimatedHTMLElement,\n  animationType: LayoutAnimationType,\n  transitionData?: TransitionData\n) {\n  const animationConfig = tryGetAnimationConfig(props, animationType);\n\n  maybeModifyStyleForKeyframe(element, props.entering as CustomConfig);\n\n  if ((animationConfig?.animationName as AnimationNames) in Animations) {\n    maybeReportOverwrittenProperties(\n      Animations[animationConfig?.animationName as AnimationNames].style,\n      element.style\n    );\n  }\n\n  if (animationConfig) {\n    chooseAction(\n      animationType,\n      animationConfig,\n      element,\n      transitionData as TransitionData\n    );\n  } else {\n    makeElementVisible(element, 0);\n  }\n}\n\nexport function tryActivateLayoutTransition<\n  ComponentProps extends Record<string, unknown>,\n>(\n  props: Readonly<AnimatedComponentProps<ComponentProps>>,\n  element: ReanimatedHTMLElement,\n  snapshot: DOMRect\n) {\n  if (!props.layout) {\n    return;\n  }\n\n  const rect = element.getBoundingClientRect();\n\n  if (areDOMRectsEqual(rect, snapshot)) {\n    return;\n  }\n\n  const enteringAnimation = (props.layout as CustomConfig).enteringV\n    ?.presetName;\n  const exitingAnimation = (props.layout as CustomConfig).exitingV?.presetName;\n\n  const transitionData: TransitionData = {\n    translateX: snapshot.x - rect.x,\n    translateY: snapshot.y - rect.y,\n    scaleX: snapshot.width / rect.width,\n    scaleY: snapshot.height / rect.height,\n    reversed: false, // This field is used only in `SequencedTransition`, so by default it will be false\n    easingX:\n      (props.layout as CustomConfig).easingXV?.[EasingNameSymbol] ?? 'ease',\n    easingY:\n      (props.layout as CustomConfig).easingYV?.[EasingNameSymbol] ?? 'ease',\n    entering: enteringAnimation,\n    exiting: exitingAnimation,\n  };\n\n  startWebLayoutAnimation(\n    props,\n    element,\n    LayoutAnimationType.LAYOUT,\n    transitionData\n  );\n}\n"],"mappings":"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","ignoreList":[]}