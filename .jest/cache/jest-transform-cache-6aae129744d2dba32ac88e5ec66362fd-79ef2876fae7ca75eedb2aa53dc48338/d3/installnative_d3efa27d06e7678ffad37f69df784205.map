{"version":3,"names":["require","_expoConstants","_interopRequireDefault","_PolyfillFunctions","_Location","_getDevServer","_manifest$extra3","manifest","Constants","expoConfig","getOrigin","_manifest$extra$route","_manifest$extra","_manifest$extra2","process","env","NODE_ENV","getDevServer","url","extra","router","origin","generatedOrigin","getBaseUrl","productionBaseUrl","replace","polyfillSymbol","Symbol","for","wrapFetchWithWindowLocation","fetch","_fetch","_len","arguments","length","props","Array","_key","startsWith","_window$location","URL","window","location","toString","_window$location2","apply","BUILTIN_SYMBOL","addBuiltinSymbol","obj","Object","defineProperty","value","enumerable","configurable","installBuiltin","name","getValue","installGlobal","ReadableStream","_unused","setLocationHref","install","global"],"sources":["install.native.ts"],"sourcesContent":["// This MUST be first to ensure that `fetch` is defined in the React Native environment.\nimport 'react-native/Libraries/Core/InitializeCore';\n\n// Ensure fetch is installed before adding our fetch polyfill to ensure Headers and Request are available globally.\nimport 'whatwg-fetch';\n// This MUST be imported to ensure URL is installed.\nimport 'expo';\n// This file configures the runtime environment to increase compatibility with WinterCG.\n// https://wintercg.org/\nimport Constants from 'expo-constants';\nimport { polyfillGlobal as installGlobal } from 'react-native/Libraries/Utilities/PolyfillFunctions';\n\nimport { install, setLocationHref } from './Location';\nimport getDevServer from '../getDevServer';\n\nconst manifest = Constants.expoConfig as Record<string, any> | null;\n\nfunction getOrigin() {\n  if (process.env.NODE_ENV !== 'production') {\n    // e.g. http://localhost:8081\n    return getDevServer().url;\n  }\n  return (\n    manifest?.extra?.router?.origin ??\n    // Written automatically during release builds.\n    manifest?.extra?.router?.generatedOrigin\n  );\n}\n\n// TODO: This would be better if native and tied as close to the JS engine as possible, i.e. it should\n// reflect the exact location of the JS file that was executed.\nfunction getBaseUrl() {\n  // TODO: Make it official by moving out of `extra`\n  const productionBaseUrl = getOrigin();\n\n  if (!productionBaseUrl) {\n    return null;\n  }\n\n  // Ensure no trailing slash\n  return productionBaseUrl?.replace(/\\/$/, '');\n}\n\nconst polyfillSymbol = Symbol.for('expo.polyfillFetchWithWindowLocation');\n\nexport function wrapFetchWithWindowLocation(fetch: Function & { [polyfillSymbol]?: boolean }) {\n  if (fetch[polyfillSymbol]) {\n    return fetch;\n  }\n\n  const _fetch = (...props: any[]) => {\n    if (props[0] && typeof props[0] === 'string' && props[0].startsWith('/')) {\n      props[0] = new URL(props[0], window.location?.origin).toString();\n    } else if (props[0] && typeof props[0] === 'object') {\n      if (props[0].url && typeof props[0].url === 'string' && props[0].url.startsWith('/')) {\n        props[0].url = new URL(props[0].url, window.location?.origin).toString();\n      }\n    }\n    return fetch(...props);\n  };\n\n  _fetch[polyfillSymbol] = true;\n\n  return _fetch;\n}\n\n// Add a well-known shared symbol that doesn't show up in iteration or inspection\n// this can be used to detect if the global object abides by the Expo team's documented\n// built-in requirements.\nconst BUILTIN_SYMBOL = Symbol.for('expo.builtin');\n\nfunction addBuiltinSymbol(obj: object) {\n  Object.defineProperty(obj, BUILTIN_SYMBOL, {\n    value: true,\n    enumerable: false,\n    configurable: false,\n  });\n  return obj;\n}\n\nfunction installBuiltin(name: string, getValue: () => any) {\n  installGlobal(name, () => addBuiltinSymbol(getValue()));\n}\n\ntry {\n  require('web-streams-polyfill');\n  // NOTE: Fetch is polyfilled in expo/metro-runtime\n  installBuiltin(\n    'ReadableStream',\n    () => require('web-streams-polyfill/ponyfill/es6').ReadableStream\n  );\n} catch {}\n\nif (manifest?.extra?.router?.origin !== false) {\n  // Polyfill window.location in native runtimes.\n  if (typeof window !== 'undefined' && !window.location) {\n    const url = getBaseUrl();\n    if (url) {\n      setLocationHref(url);\n      install();\n    }\n  }\n\n  // Polyfill native fetch to support relative URLs\n  Object.defineProperty(global, 'fetch', {\n    // value: fetch,\n    value: wrapFetchWithWindowLocation(fetch),\n  });\n} else {\n  // Polyfill native fetch to support relative URLs\n  Object.defineProperty(global, 'fetch', {\n    value: fetch,\n  });\n}\n"],"mappings":"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","ignoreList":[]}