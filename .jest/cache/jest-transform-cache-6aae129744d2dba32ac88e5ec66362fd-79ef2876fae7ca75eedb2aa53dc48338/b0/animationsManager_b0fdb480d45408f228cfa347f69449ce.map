{"version":3,"names":["_styleAnimation","require","_mutables","_animationBuilder","_threads","TAG_OFFSET","_worklet_10675557011176_init_data","code","location","sourceMap","version","startObservingProgress","_e","global","Error","tag","sharedValue","animationType","isSharedTransition","LayoutAnimationType","SHARED_ELEMENT_TRANSITION","addListener","_notifyAboutProgress","value","__closure","__workletHash","__initData","__stackDetails","_worklet_16958055875360_init_data","stopObservingProgress","removeView","arguments","length","undefined","removeListener","_notifyAboutEnd","_worklet_5423312481392_init_data","createLayoutAnimationManager","currentAnimationForTag","Map","mutableValuesForTag","start","type","yogaValues","config","SHARED_ELEMENT_TRANSITION_PROGRESS","ProgressTransitionRegister","onTransitionStart","style","currentAnimation","animations","previousAnimation","get","Object","assign","set","makeMutableUI","initialValues","_value","animation","withStyleAnimation","callback","finished","delete","shouldRemoveView","EXITING","stop","_worklet_6336697456501_init_data","runOnUIImmediately","animationsManagerTs4","LayoutAnimationsManager"],"sources":["animationsManager.ts"],"sourcesContent":["'use strict';\nimport { withStyleAnimation } from '../animation/styleAnimation';\nimport type { SharedValue } from '../commonTypes';\nimport { makeMutableUI } from '../mutables';\nimport { LayoutAnimationType } from './animationBuilder';\nimport { runOnUIImmediately } from '../threads';\nimport type {\n  SharedTransitionAnimationsValues,\n  LayoutAnimation,\n  LayoutAnimationStartFunction,\n} from './animationBuilder/commonTypes';\n\nconst TAG_OFFSET = 1e9;\n\nfunction startObservingProgress(\n  tag: number,\n  sharedValue: SharedValue<Record<string, unknown>>,\n  animationType: LayoutAnimationType\n): void {\n  'worklet';\n  const isSharedTransition =\n    animationType === LayoutAnimationType.SHARED_ELEMENT_TRANSITION;\n  sharedValue.addListener(tag + TAG_OFFSET, () => {\n    global._notifyAboutProgress(tag, sharedValue.value, isSharedTransition);\n  });\n}\n\nfunction stopObservingProgress(\n  tag: number,\n  sharedValue: SharedValue<number>,\n  removeView = false\n): void {\n  'worklet';\n  sharedValue.removeListener(tag + TAG_OFFSET);\n  global._notifyAboutEnd(tag, removeView);\n}\n\nfunction createLayoutAnimationManager(): {\n  start: LayoutAnimationStartFunction;\n  stop: (tag: number) => void;\n} {\n  'worklet';\n  const currentAnimationForTag = new Map();\n  const mutableValuesForTag = new Map();\n\n  return {\n    start(\n      tag: number,\n      type: LayoutAnimationType,\n      /**\n       * CreateLayoutAnimationManager creates an animation manager for both\n       * Layout animations and Shared Transition Elements animations.\n       */\n      yogaValues: Partial<SharedTransitionAnimationsValues>,\n      config: (\n        arg: Partial<SharedTransitionAnimationsValues>\n      ) => LayoutAnimation\n    ) {\n      if (type === LayoutAnimationType.SHARED_ELEMENT_TRANSITION_PROGRESS) {\n        global.ProgressTransitionRegister.onTransitionStart(tag, yogaValues);\n        return;\n      }\n\n      const style = config(yogaValues);\n      let currentAnimation = style.animations;\n\n      // When layout animation is requested, but a previous one is still running, we merge\n      // new layout animation targets into the ongoing animation\n      const previousAnimation = currentAnimationForTag.get(tag);\n      if (previousAnimation) {\n        currentAnimation = { ...previousAnimation, ...style.animations };\n      }\n      currentAnimationForTag.set(tag, currentAnimation);\n\n      let value = mutableValuesForTag.get(tag);\n      if (value === undefined) {\n        value = makeMutableUI(style.initialValues);\n        mutableValuesForTag.set(tag, value);\n      } else {\n        stopObservingProgress(tag, value);\n        value._value = style.initialValues;\n      }\n\n      // @ts-ignore The line below started failing because I added types to the method â€“ don't have time to fix it right now\n      const animation = withStyleAnimation(currentAnimation);\n\n      animation.callback = (finished?: boolean) => {\n        if (finished) {\n          currentAnimationForTag.delete(tag);\n          mutableValuesForTag.delete(tag);\n          const shouldRemoveView = type === LayoutAnimationType.EXITING;\n          stopObservingProgress(tag, value, shouldRemoveView);\n        }\n        style.callback &&\n          style.callback(finished === undefined ? false : finished);\n      };\n\n      startObservingProgress(tag, value, type);\n      value.value = animation;\n    },\n    stop(tag: number) {\n      const value = mutableValuesForTag.get(tag);\n      if (!value) {\n        return;\n      }\n      stopObservingProgress(tag, value);\n    },\n  };\n}\n\nrunOnUIImmediately(() => {\n  'worklet';\n  global.LayoutAnimationsManager = createLayoutAnimationManager();\n})();\n\nexport type LayoutAnimationsManager = ReturnType<\n  typeof createLayoutAnimationManager\n>;\n"],"mappings":"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","ignoreList":[]}