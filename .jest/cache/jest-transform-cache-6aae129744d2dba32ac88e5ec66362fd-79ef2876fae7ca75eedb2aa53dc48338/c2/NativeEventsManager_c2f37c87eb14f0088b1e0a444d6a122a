316a4f9aaa635cc97615d6948537c4c8
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.NativeEventsManager = void 0;
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _classPrivateFieldLooseBase2 = _interopRequireDefault(require("@babel/runtime/helpers/classPrivateFieldLooseBase"));
var _classPrivateFieldLooseKey2 = _interopRequireDefault(require("@babel/runtime/helpers/classPrivateFieldLooseKey"));
var _utils = require("./utils");
var _WorkletEventHandler = require("../WorkletEventHandler");
var _findNodeHandle4 = require("../platformFunctions/findNodeHandle");
var _managedComponent = (0, _classPrivateFieldLooseKey2.default)("managedComponent");
var _componentOptions = (0, _classPrivateFieldLooseKey2.default)("componentOptions");
var _eventViewTag = (0, _classPrivateFieldLooseKey2.default)("eventViewTag");
var NativeEventsManager = exports.NativeEventsManager = function () {
  function NativeEventsManager(component, options) {
    (0, _classCallCheck2.default)(this, NativeEventsManager);
    Object.defineProperty(this, _managedComponent, {
      writable: true,
      value: void 0
    });
    Object.defineProperty(this, _componentOptions, {
      writable: true,
      value: void 0
    });
    Object.defineProperty(this, _eventViewTag, {
      writable: true,
      value: -1
    });
    (0, _classPrivateFieldLooseBase2.default)(this, _managedComponent)[_managedComponent] = component;
    (0, _classPrivateFieldLooseBase2.default)(this, _componentOptions)[_componentOptions] = options;
    (0, _classPrivateFieldLooseBase2.default)(this, _eventViewTag)[_eventViewTag] = this.getEventViewTag();
  }
  return (0, _createClass2.default)(NativeEventsManager, [{
    key: "attachEvents",
    value: function attachEvents() {
      var _this = this;
      executeForEachEventHandler((0, _classPrivateFieldLooseBase2.default)(this, _managedComponent)[_managedComponent].props, function (key, handler) {
        handler.registerForEvents((0, _classPrivateFieldLooseBase2.default)(_this, _eventViewTag)[_eventViewTag], key);
      });
    }
  }, {
    key: "detachEvents",
    value: function detachEvents() {
      var _this2 = this;
      executeForEachEventHandler((0, _classPrivateFieldLooseBase2.default)(this, _managedComponent)[_managedComponent].props, function (_key, handler) {
        handler.unregisterFromEvents((0, _classPrivateFieldLooseBase2.default)(_this2, _eventViewTag)[_eventViewTag]);
      });
    }
  }, {
    key: "updateEvents",
    value: function updateEvents(prevProps) {
      var _this3 = this;
      var computedEventTag = this.getEventViewTag(true);
      if ((0, _classPrivateFieldLooseBase2.default)(this, _eventViewTag)[_eventViewTag] !== computedEventTag) {
        executeForEachEventHandler(prevProps, function (_key, handler) {
          handler.unregisterFromEvents((0, _classPrivateFieldLooseBase2.default)(_this3, _eventViewTag)[_eventViewTag]);
        });
        (0, _classPrivateFieldLooseBase2.default)(this, _eventViewTag)[_eventViewTag] = computedEventTag;
        this.attachEvents();
        return;
      }
      executeForEachEventHandler(prevProps, function (key, prevHandler) {
        var newProp = (0, _classPrivateFieldLooseBase2.default)(_this3, _managedComponent)[_managedComponent].props[key];
        if (!newProp) {
          prevHandler.unregisterFromEvents((0, _classPrivateFieldLooseBase2.default)(_this3, _eventViewTag)[_eventViewTag]);
        } else if (isWorkletEventHandler(newProp) && newProp.workletEventHandler !== prevHandler) {
          prevHandler.unregisterFromEvents((0, _classPrivateFieldLooseBase2.default)(_this3, _eventViewTag)[_eventViewTag]);
          newProp.workletEventHandler.registerForEvents((0, _classPrivateFieldLooseBase2.default)(_this3, _eventViewTag)[_eventViewTag]);
        }
      });
      executeForEachEventHandler((0, _classPrivateFieldLooseBase2.default)(this, _managedComponent)[_managedComponent].props, function (key, handler) {
        if (!prevProps[key]) {
          handler.registerForEvents((0, _classPrivateFieldLooseBase2.default)(_this3, _eventViewTag)[_eventViewTag]);
        }
      });
    }
  }, {
    key: "getEventViewTag",
    value: function getEventViewTag() {
      var _classPrivateFieldLoo, _findNodeHandle3;
      var componentUpdate = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
      var componentAnimatedRef = (0, _classPrivateFieldLooseBase2.default)(this, _managedComponent)[_managedComponent]._componentRef;
      if (componentAnimatedRef.getScrollableNode) {
        var _findNodeHandle;
        var scrollableNode = componentAnimatedRef.getScrollableNode();
        if (typeof scrollableNode === 'number') {
          return scrollableNode;
        }
        return (_findNodeHandle = (0, _findNodeHandle4.findNodeHandle)(scrollableNode)) != null ? _findNodeHandle : -1;
      }
      if ((_classPrivateFieldLoo = (0, _classPrivateFieldLooseBase2.default)(this, _componentOptions)[_componentOptions]) != null && _classPrivateFieldLoo.setNativeProps) {
        var _findNodeHandle2;
        return (_findNodeHandle2 = (0, _findNodeHandle4.findNodeHandle)((0, _classPrivateFieldLooseBase2.default)(this, _managedComponent)[_managedComponent])) != null ? _findNodeHandle2 : -1;
      }
      if (!componentUpdate) {
        return (0, _classPrivateFieldLooseBase2.default)(this, _managedComponent)[_managedComponent].getComponentViewTag();
      }
      if (componentAnimatedRef.__nativeTag || componentAnimatedRef._nativeTag) {
        var _ref, _componentAnimatedRef;
        return (_ref = (_componentAnimatedRef = componentAnimatedRef.__nativeTag) != null ? _componentAnimatedRef : componentAnimatedRef._nativeTag) != null ? _ref : -1;
      }
      return (_findNodeHandle3 = (0, _findNodeHandle4.findNodeHandle)(componentAnimatedRef)) != null ? _findNodeHandle3 : -1;
    }
  }]);
}();
function isWorkletEventHandler(prop) {
  return (0, _utils.has)('workletEventHandler', prop) && prop.workletEventHandler instanceof _WorkletEventHandler.WorkletEventHandler;
}
function executeForEachEventHandler(props, callback) {
  for (var key in props) {
    var prop = props[key];
    if (isWorkletEventHandler(prop)) {
      callback(key, prop.workletEventHandler);
    }
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiTmF0aXZlRXZlbnRzTWFuYWdlciIsIl9jbGFzc0NhbGxDaGVjazIiLCJfY3JlYXRlQ2xhc3MyIiwiX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlMiIsIl9jbGFzc1ByaXZhdGVGaWVsZExvb3NlS2V5MiIsIl91dGlscyIsIl9Xb3JrbGV0RXZlbnRIYW5kbGVyIiwiX2ZpbmROb2RlSGFuZGxlNCIsIl9tYW5hZ2VkQ29tcG9uZW50IiwiZGVmYXVsdCIsIl9jb21wb25lbnRPcHRpb25zIiwiX2V2ZW50Vmlld1RhZyIsImNvbXBvbmVudCIsIm9wdGlvbnMiLCJ3cml0YWJsZSIsImdldEV2ZW50Vmlld1RhZyIsImtleSIsImF0dGFjaEV2ZW50cyIsIl90aGlzIiwiZXhlY3V0ZUZvckVhY2hFdmVudEhhbmRsZXIiLCJwcm9wcyIsImhhbmRsZXIiLCJyZWdpc3RlckZvckV2ZW50cyIsImRldGFjaEV2ZW50cyIsIl90aGlzMiIsIl9rZXkiLCJ1bnJlZ2lzdGVyRnJvbUV2ZW50cyIsInVwZGF0ZUV2ZW50cyIsInByZXZQcm9wcyIsIl90aGlzMyIsImNvbXB1dGVkRXZlbnRUYWciLCJwcmV2SGFuZGxlciIsIm5ld1Byb3AiLCJpc1dvcmtsZXRFdmVudEhhbmRsZXIiLCJ3b3JrbGV0RXZlbnRIYW5kbGVyIiwiX2NsYXNzUHJpdmF0ZUZpZWxkTG9vIiwiX2ZpbmROb2RlSGFuZGxlMyIsImNvbXBvbmVudFVwZGF0ZSIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsImNvbXBvbmVudEFuaW1hdGVkUmVmIiwiX2NvbXBvbmVudFJlZiIsImdldFNjcm9sbGFibGVOb2RlIiwiX2ZpbmROb2RlSGFuZGxlIiwic2Nyb2xsYWJsZU5vZGUiLCJmaW5kTm9kZUhhbmRsZSIsInNldE5hdGl2ZVByb3BzIiwiX2ZpbmROb2RlSGFuZGxlMiIsImdldENvbXBvbmVudFZpZXdUYWciLCJfX25hdGl2ZVRhZyIsIl9uYXRpdmVUYWciLCJfcmVmIiwiX2NvbXBvbmVudEFuaW1hdGVkUmVmIiwicHJvcCIsImhhcyIsIldvcmtsZXRFdmVudEhhbmRsZXIiLCJjYWxsYmFjayJdLCJzb3VyY2VzIjpbIk5hdGl2ZUV2ZW50c01hbmFnZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuaW1wb3J0IHR5cGUge1xuICBJTmF0aXZlRXZlbnRzTWFuYWdlcixcbiAgSUFuaW1hdGVkQ29tcG9uZW50SW50ZXJuYWwsXG4gIEFuaW1hdGVkQ29tcG9uZW50UHJvcHMsXG4gIEluaXRpYWxDb21wb25lbnRQcm9wcyxcbiAgQW5pbWF0ZWRDb21wb25lbnRSZWYsXG59IGZyb20gJy4vY29tbW9uVHlwZXMnO1xuaW1wb3J0IHsgaGFzIH0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgeyBXb3JrbGV0RXZlbnRIYW5kbGVyIH0gZnJvbSAnLi4vV29ya2xldEV2ZW50SGFuZGxlcic7XG5pbXBvcnQgeyBmaW5kTm9kZUhhbmRsZSB9IGZyb20gJy4uL3BsYXRmb3JtRnVuY3Rpb25zL2ZpbmROb2RlSGFuZGxlJztcblxuZXhwb3J0IGNsYXNzIE5hdGl2ZUV2ZW50c01hbmFnZXIgaW1wbGVtZW50cyBJTmF0aXZlRXZlbnRzTWFuYWdlciB7XG4gIHJlYWRvbmx5ICNtYW5hZ2VkQ29tcG9uZW50OiBNYW5hZ2VkQW5pbWF0ZWRDb21wb25lbnQ7XG4gIHJlYWRvbmx5ICNjb21wb25lbnRPcHRpb25zPzogQ29tcG9uZW50T3B0aW9ucztcbiAgI2V2ZW50Vmlld1RhZyA9IC0xO1xuXG4gIGNvbnN0cnVjdG9yKGNvbXBvbmVudDogTWFuYWdlZEFuaW1hdGVkQ29tcG9uZW50LCBvcHRpb25zPzogQ29tcG9uZW50T3B0aW9ucykge1xuICAgIHRoaXMuI21hbmFnZWRDb21wb25lbnQgPSBjb21wb25lbnQ7XG4gICAgdGhpcy4jY29tcG9uZW50T3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgdGhpcy4jZXZlbnRWaWV3VGFnID0gdGhpcy5nZXRFdmVudFZpZXdUYWcoKTtcbiAgfVxuXG4gIHB1YmxpYyBhdHRhY2hFdmVudHMoKSB7XG4gICAgZXhlY3V0ZUZvckVhY2hFdmVudEhhbmRsZXIodGhpcy4jbWFuYWdlZENvbXBvbmVudC5wcm9wcywgKGtleSwgaGFuZGxlcikgPT4ge1xuICAgICAgaGFuZGxlci5yZWdpc3RlckZvckV2ZW50cyh0aGlzLiNldmVudFZpZXdUYWcsIGtleSk7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgZGV0YWNoRXZlbnRzKCkge1xuICAgIGV4ZWN1dGVGb3JFYWNoRXZlbnRIYW5kbGVyKFxuICAgICAgdGhpcy4jbWFuYWdlZENvbXBvbmVudC5wcm9wcyxcbiAgICAgIChfa2V5LCBoYW5kbGVyKSA9PiB7XG4gICAgICAgIGhhbmRsZXIudW5yZWdpc3RlckZyb21FdmVudHModGhpcy4jZXZlbnRWaWV3VGFnKTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgcHVibGljIHVwZGF0ZUV2ZW50cyhcbiAgICBwcmV2UHJvcHM6IEFuaW1hdGVkQ29tcG9uZW50UHJvcHM8SW5pdGlhbENvbXBvbmVudFByb3BzPlxuICApIHtcbiAgICBjb25zdCBjb21wdXRlZEV2ZW50VGFnID0gdGhpcy5nZXRFdmVudFZpZXdUYWcodHJ1ZSk7XG4gICAgLy8gSWYgdGhlIGV2ZW50IHZpZXcgdGFnIGNoYW5nZXMsIHdlIG5lZWQgdG8gY29tcGxldGVseSByZS1tb3VudCBhbGwgZXZlbnRzXG4gICAgaWYgKHRoaXMuI2V2ZW50Vmlld1RhZyAhPT0gY29tcHV0ZWRFdmVudFRhZykge1xuICAgICAgLy8gUmVtb3ZlIGFsbCBiaW5kaW5ncyBmcm9tIHByZXZpb3VzIHByb3BzIHRoYXQgcmFuIG9uIHRoZSBvbGQgdmlld1RhZ1xuICAgICAgZXhlY3V0ZUZvckVhY2hFdmVudEhhbmRsZXIocHJldlByb3BzLCAoX2tleSwgaGFuZGxlcikgPT4ge1xuICAgICAgICBoYW5kbGVyLnVucmVnaXN0ZXJGcm9tRXZlbnRzKHRoaXMuI2V2ZW50Vmlld1RhZyk7XG4gICAgICB9KTtcbiAgICAgIC8vIFdlIGRvbid0IG5lZWQgdG8gdW5yZWdpc3RlciBmcm9tIGN1cnJlbnQgKG5ldykgcHJvcHMsIGJlY2F1c2UgdGhlaXIgZXZlbnRzIHdlcmVuJ3QgcmVnaXN0ZXJlZCB5ZXRcbiAgICAgIC8vIFJlcGxhY2UgdGhlIHZpZXcgdGFnXG4gICAgICB0aGlzLiNldmVudFZpZXdUYWcgPSBjb21wdXRlZEV2ZW50VGFnO1xuICAgICAgLy8gQXR0YWNoIHRoZSBldmVudHMgd2l0aCBhIG5ldyB2aWV3VGFnXG4gICAgICB0aGlzLmF0dGFjaEV2ZW50cygpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGV4ZWN1dGVGb3JFYWNoRXZlbnRIYW5kbGVyKHByZXZQcm9wcywgKGtleSwgcHJldkhhbmRsZXIpID0+IHtcbiAgICAgIGNvbnN0IG5ld1Byb3AgPSB0aGlzLiNtYW5hZ2VkQ29tcG9uZW50LnByb3BzW2tleV07XG4gICAgICBpZiAoIW5ld1Byb3ApIHtcbiAgICAgICAgLy8gUHJvcCBnb3QgZGVsZXRlZFxuICAgICAgICBwcmV2SGFuZGxlci51bnJlZ2lzdGVyRnJvbUV2ZW50cyh0aGlzLiNldmVudFZpZXdUYWcpO1xuICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgaXNXb3JrbGV0RXZlbnRIYW5kbGVyKG5ld1Byb3ApICYmXG4gICAgICAgIG5ld1Byb3Aud29ya2xldEV2ZW50SGFuZGxlciAhPT0gcHJldkhhbmRsZXJcbiAgICAgICkge1xuICAgICAgICAvLyBQcm9wIGdvdCBjaGFuZ2VkXG4gICAgICAgIHByZXZIYW5kbGVyLnVucmVnaXN0ZXJGcm9tRXZlbnRzKHRoaXMuI2V2ZW50Vmlld1RhZyk7XG4gICAgICAgIG5ld1Byb3Aud29ya2xldEV2ZW50SGFuZGxlci5yZWdpc3RlckZvckV2ZW50cyh0aGlzLiNldmVudFZpZXdUYWcpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgZXhlY3V0ZUZvckVhY2hFdmVudEhhbmRsZXIodGhpcy4jbWFuYWdlZENvbXBvbmVudC5wcm9wcywgKGtleSwgaGFuZGxlcikgPT4ge1xuICAgICAgaWYgKCFwcmV2UHJvcHNba2V5XSkge1xuICAgICAgICAvLyBQcm9wIGdvdCBhZGRlZFxuICAgICAgICBoYW5kbGVyLnJlZ2lzdGVyRm9yRXZlbnRzKHRoaXMuI2V2ZW50Vmlld1RhZyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGdldEV2ZW50Vmlld1RhZyhjb21wb25lbnRVcGRhdGU6IGJvb2xlYW4gPSBmYWxzZSkge1xuICAgIC8vIEdldCB0aGUgdGFnIGZvciByZWdpc3RlcmluZyBldmVudHMgLSBzaW5jZSB0aGUgZXZlbnQgZW1pdHRpbmcgdmlldyBjYW4gYmUgbmVzdGVkIGluc2lkZSB0aGUgbWFpbiBjb21wb25lbnRcbiAgICBjb25zdCBjb21wb25lbnRBbmltYXRlZFJlZiA9IHRoaXMuI21hbmFnZWRDb21wb25lbnRcbiAgICAgIC5fY29tcG9uZW50UmVmIGFzIEFuaW1hdGVkQ29tcG9uZW50UmVmICYge1xuICAgICAgLy8gRmFicmljXG4gICAgICBfX25hdGl2ZVRhZz86IG51bWJlcjtcbiAgICAgIC8vIFBhcGVyXG4gICAgICBfbmF0aXZlVGFnPzogbnVtYmVyO1xuICAgIH07XG4gICAgaWYgKGNvbXBvbmVudEFuaW1hdGVkUmVmLmdldFNjcm9sbGFibGVOb2RlKSB7XG4gICAgICAvKlxuICAgICAgICBJbiBtb3N0IGNhc2VzLCBnZXRTY3JvbGxhYmxlTm9kZSgpIHJldHVybnMgYSB2aWV3IHRhZywgYW5kIGZpbmROb2RlSGFuZGxlIGlzIG5vdCByZXF1aXJlZC4gXG4gICAgICAgIEhvd2V2ZXIsIHRvIGNvdmVyIG1vcmUgZXhvdGljIGxpc3QgY2FzZXMsIHdlIHdpbGwgY29udGludWUgdG8gdXNlIGZpbmROb2RlSGFuZGxlIFxuICAgICAgICBmb3IgY29uc2lzdGVuY3kuIEZvciBudW1lcmljYWwgdmFsdWVzLCBmaW5kTm9kZUhhbmRsZSBzaG91bGQgcmV0dXJuIHRoZSB2YWx1ZSBpbW1lZGlhdGVseSwgXG4gICAgICAgIGFzIGRvY3VtZW50ZWQgaGVyZTogaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL3JlYWN0L2Jsb2IvOTEwNjEwNzNkNTc3ODNjMDYxODg5YWM2NzIwZWYxYWI3ZjBjMjE0OS9wYWNrYWdlcy9yZWFjdC1uYXRpdmUtcmVuZGVyZXIvc3JjL1JlYWN0TmF0aXZlUHVibGljQ29tcGF0LmpzI0wxMTNcbiAgICAgICovXG4gICAgICBjb25zdCBzY3JvbGxhYmxlTm9kZSA9IGNvbXBvbmVudEFuaW1hdGVkUmVmLmdldFNjcm9sbGFibGVOb2RlKCk7XG4gICAgICBpZiAodHlwZW9mIHNjcm9sbGFibGVOb2RlID09PSAnbnVtYmVyJykge1xuICAgICAgICByZXR1cm4gc2Nyb2xsYWJsZU5vZGU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmluZE5vZGVIYW5kbGUoc2Nyb2xsYWJsZU5vZGUpID8/IC0xO1xuICAgIH1cbiAgICBpZiAodGhpcy4jY29tcG9uZW50T3B0aW9ucz8uc2V0TmF0aXZlUHJvcHMpIHtcbiAgICAgIC8vIFRoaXMgY2FzZSBlbnN1cmVzIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgd2l0aCBjb21wb25lbnRzIHRoYXRcbiAgICAgIC8vIGhhdmUgdGhlaXIgb3duIHNldE5hdGl2ZVByb3BzIG1ldGhvZCBwYXNzZWQgYXMgYW4gb3B0aW9uLlxuICAgICAgcmV0dXJuIGZpbmROb2RlSGFuZGxlKHRoaXMuI21hbmFnZWRDb21wb25lbnQpID8/IC0xO1xuICAgIH1cbiAgICBpZiAoIWNvbXBvbmVudFVwZGF0ZSkge1xuICAgICAgLy8gT24gdGhlIGZpcnN0IHJlbmRlciBvZiBhIGNvbXBvbmVudCwgd2UgbWF5IGFscmVhZHkgcmVjZWl2ZSBhIHJlc29sdmVkIHZpZXcgdGFnLlxuICAgICAgcmV0dXJuIHRoaXMuI21hbmFnZWRDb21wb25lbnQuZ2V0Q29tcG9uZW50Vmlld1RhZygpO1xuICAgIH1cbiAgICBpZiAoY29tcG9uZW50QW5pbWF0ZWRSZWYuX19uYXRpdmVUYWcgfHwgY29tcG9uZW50QW5pbWF0ZWRSZWYuX25hdGl2ZVRhZykge1xuICAgICAgLypcbiAgICAgICAgRmFzdCBwYXRoIGZvciBuYXRpdmUgcmVmcyxcbiAgICAgICAgX25hdGl2ZVRhZyBpcyB1c2VkIGJ5IFBhcGVyIGNvbXBvbmVudHMsXG4gICAgICAgIF9fbmF0aXZlVGFnIGlzIHVzZWQgYnkgRmFicmljIGNvbXBvbmVudHMuXG4gICAgICAqL1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgY29tcG9uZW50QW5pbWF0ZWRSZWYuX19uYXRpdmVUYWcgPz9cbiAgICAgICAgY29tcG9uZW50QW5pbWF0ZWRSZWYuX25hdGl2ZVRhZyA/P1xuICAgICAgICAtMVxuICAgICAgKTtcbiAgICB9XG4gICAgLypcbiAgICAgIFdoZW4gYSBjb21wb25lbnQgaXMgdXBkYXRlZCwgYSBjaGlsZCBjb3VsZCBwb3RlbnRpYWxseSBjaGFuZ2UgYW5kIGhhdmUgYSBkaWZmZXJlbnQgXG4gICAgICB2aWV3IHRhZy4gVGhpcyBjYW4gb2NjdXIgd2l0aCBhIEdlc3R1cmVEZXRlY3RvciBjb21wb25lbnQuXG4gICAgKi9cbiAgICByZXR1cm4gZmluZE5vZGVIYW5kbGUoY29tcG9uZW50QW5pbWF0ZWRSZWYpID8/IC0xO1xuICB9XG59XG5cbmZ1bmN0aW9uIGlzV29ya2xldEV2ZW50SGFuZGxlcihcbiAgcHJvcDogdW5rbm93blxuKTogcHJvcCBpcyBXb3JrbGV0RXZlbnRIYW5kbGVySG9sZGVyIHtcbiAgcmV0dXJuIChcbiAgICBoYXMoJ3dvcmtsZXRFdmVudEhhbmRsZXInLCBwcm9wKSAmJlxuICAgIHByb3Aud29ya2xldEV2ZW50SGFuZGxlciBpbnN0YW5jZW9mIFdvcmtsZXRFdmVudEhhbmRsZXJcbiAgKTtcbn1cblxuZnVuY3Rpb24gZXhlY3V0ZUZvckVhY2hFdmVudEhhbmRsZXIoXG4gIHByb3BzOiBBbmltYXRlZENvbXBvbmVudFByb3BzPEluaXRpYWxDb21wb25lbnRQcm9wcz4sXG4gIGNhbGxiYWNrOiAoXG4gICAga2V5OiBzdHJpbmcsXG4gICAgaGFuZGxlcjogSW5zdGFuY2VUeXBlPHR5cGVvZiBXb3JrbGV0RXZlbnRIYW5kbGVyPlxuICApID0+IHZvaWRcbikge1xuICBmb3IgKGNvbnN0IGtleSBpbiBwcm9wcykge1xuICAgIGNvbnN0IHByb3AgPSBwcm9wc1trZXldO1xuICAgIGlmIChpc1dvcmtsZXRFdmVudEhhbmRsZXIocHJvcCkpIHtcbiAgICAgIGNhbGxiYWNrKGtleSwgcHJvcC53b3JrbGV0RXZlbnRIYW5kbGVyKTtcbiAgICB9XG4gIH1cbn1cblxudHlwZSBNYW5hZ2VkQW5pbWF0ZWRDb21wb25lbnQgPSBSZWFjdC5Db21wb25lbnQ8XG4gIEFuaW1hdGVkQ29tcG9uZW50UHJvcHM8SW5pdGlhbENvbXBvbmVudFByb3BzPlxuPiAmXG4gIElBbmltYXRlZENvbXBvbmVudEludGVybmFsO1xuXG50eXBlIENvbXBvbmVudE9wdGlvbnMgPSB7XG4gIHNldE5hdGl2ZVByb3BzOiAoXG4gICAgcmVmOiBBbmltYXRlZENvbXBvbmVudFJlZixcbiAgICBwcm9wczogSW5pdGlhbENvbXBvbmVudFByb3BzXG4gICkgPT4gdm9pZDtcbn07XG5cbnR5cGUgV29ya2xldEV2ZW50SGFuZGxlckhvbGRlciA9IHtcbiAgd29ya2xldEV2ZW50SGFuZGxlcjogSW5zdGFuY2VUeXBlPHR5cGVvZiBXb3JrbGV0RXZlbnRIYW5kbGVyPjtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7O0FBQUMsSUFBQUEsc0JBQUEsR0FBQUMsT0FBQTtBQUFBQyxNQUFBLENBQUFDLGNBQUEsQ0FBQUMsT0FBQTtFQUFBQyxLQUFBO0FBQUE7QUFBQUQsT0FBQSxDQUFBRSxtQkFBQTtBQUFBLElBQUFDLGdCQUFBLEdBQUFQLHNCQUFBLENBQUFDLE9BQUE7QUFBQSxJQUFBTyxhQUFBLEdBQUFSLHNCQUFBLENBQUFDLE9BQUE7QUFBQSxJQUFBUSw0QkFBQSxHQUFBVCxzQkFBQSxD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