739e4c302a1f9d15af60bb28b70bcee6
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.resolveUri = resolveUri;
exports.selectAssetSource = selectAssetSource;
var _expoModulesCore = require("expo-modules-core");
var _reactNative = require("react-native");
var _AssetSourceResolver = _interopRequireDefault(require("./AssetSourceResolver"));
var _PlatformUtils = require("./PlatformUtils");
function selectAssetSource(meta) {
  var _meta$fileHashes$inde, _meta$fileUris$index, _manifest2$extra;
  var scale = _AssetSourceResolver.default.pickScale(meta.scales, _reactNative.PixelRatio.get());
  var index = meta.scales.findIndex(function (s) {
    return s === scale;
  });
  var hash = meta.fileHashes ? (_meta$fileHashes$inde = meta.fileHashes[index]) != null ? _meta$fileHashes$inde : meta.fileHashes[0] : meta.hash;
  var uri = meta.fileUris ? (_meta$fileUris$index = meta.fileUris[index]) != null ? _meta$fileUris$index : meta.fileUris[0] : meta.uri;
  if (uri) {
    return {
      uri: resolveUri(uri),
      hash: hash
    };
  }
  var fileScale = scale === 1 ? '' : `@${scale}x`;
  var fileExtension = meta.type ? `.${encodeURIComponent(meta.type)}` : '';
  var suffix = `/${encodeURIComponent(meta.name)}${fileScale}${fileExtension}`;
  var params = new URLSearchParams({
    platform: _expoModulesCore.Platform.OS,
    hash: meta.hash
  });
  if (/^https?:\/\//.test(meta.httpServerLocation)) {
    var _uri = meta.httpServerLocation + suffix + '?' + params;
    return {
      uri: _uri,
      hash: hash
    };
  }
  var manifest2 = (0, _PlatformUtils.getManifest2)();
  var devServerUrl = manifest2 != null && (_manifest2$extra = manifest2.extra) != null && (_manifest2$extra = _manifest2$extra.expoGo) != null && _manifest2$extra.developer ? 'http://' + manifest2.extra.expoGo.debuggerHost : null;
  if (devServerUrl) {
    var baseUrl = new URL(meta.httpServerLocation + suffix, devServerUrl);
    baseUrl.searchParams.set('platform', _expoModulesCore.Platform.OS);
    baseUrl.searchParams.set('hash', meta.hash);
    return {
      uri: baseUrl.href,
      hash: hash
    };
  }
  if (_reactNative.NativeModules.ExponentKernel) {
    return {
      uri: `https://classic-assets.eascdn.net/~assets/${encodeURIComponent(hash)}`,
      hash: hash
    };
  }
  return {
    uri: '',
    hash: hash
  };
}
function resolveUri(uri) {
  return _PlatformUtils.manifestBaseUrl ? new URL(uri, _PlatformUtils.manifestBaseUrl).href : uri;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXhwb01vZHVsZXNDb3JlIiwicmVxdWlyZSIsIl9yZWFjdE5hdGl2ZSIsIl9Bc3NldFNvdXJjZVJlc29sdmVyIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9QbGF0Zm9ybVV0aWxzIiwic2VsZWN0QXNzZXRTb3VyY2UiLCJtZXRhIiwiX21ldGEkZmlsZUhhc2hlcyRpbmRlIiwiX21ldGEkZmlsZVVyaXMkaW5kZXgiLCJfbWFuaWZlc3QyJGV4dHJhIiwic2NhbGUiLCJBc3NldFNvdXJjZVJlc29sdmVyIiwicGlja1NjYWxlIiwic2NhbGVzIiwiUGl4ZWxSYXRpbyIsImdldCIsImluZGV4IiwiZmluZEluZGV4IiwicyIsImhhc2giLCJmaWxlSGFzaGVzIiwidXJpIiwiZmlsZVVyaXMiLCJyZXNvbHZlVXJpIiwiZmlsZVNjYWxlIiwiZmlsZUV4dGVuc2lvbiIsInR5cGUiLCJlbmNvZGVVUklDb21wb25lbnQiLCJzdWZmaXgiLCJuYW1lIiwicGFyYW1zIiwiVVJMU2VhcmNoUGFyYW1zIiwicGxhdGZvcm0iLCJQbGF0Zm9ybSIsIk9TIiwidGVzdCIsImh0dHBTZXJ2ZXJMb2NhdGlvbiIsIm1hbmlmZXN0MiIsImdldE1hbmlmZXN0MiIsImRldlNlcnZlclVybCIsImV4dHJhIiwiZXhwb0dvIiwiZGV2ZWxvcGVyIiwiZGVidWdnZXJIb3N0IiwiYmFzZVVybCIsIlVSTCIsInNlYXJjaFBhcmFtcyIsInNldCIsImhyZWYiLCJOYXRpdmVNb2R1bGVzIiwiRXhwb25lbnRLZXJuZWwiLCJtYW5pZmVzdEJhc2VVcmwiXSwic291cmNlcyI6WyIuLi9zcmMvQXNzZXRTb3VyY2VzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgUGFja2FnZXJBc3NldCB9IGZyb20gJ0ByZWFjdC1uYXRpdmUvYXNzZXRzLXJlZ2lzdHJ5L3JlZ2lzdHJ5JztcbmltcG9ydCB7IFBsYXRmb3JtIH0gZnJvbSAnZXhwby1tb2R1bGVzLWNvcmUnO1xuaW1wb3J0IHsgUGl4ZWxSYXRpbywgTmF0aXZlTW9kdWxlcyB9IGZyb20gJ3JlYWN0LW5hdGl2ZSc7XG5cbmltcG9ydCBBc3NldFNvdXJjZVJlc29sdmVyIGZyb20gJy4vQXNzZXRTb3VyY2VSZXNvbHZlcic7XG5pbXBvcnQgeyBnZXRNYW5pZmVzdDIsIG1hbmlmZXN0QmFzZVVybCB9IGZyb20gJy4vUGxhdGZvcm1VdGlscyc7XG5cbi8vIEBkb2NzTWlzc2luZ1xuZXhwb3J0IHR5cGUgQXNzZXRNZXRhZGF0YSA9IFBpY2s8XG4gIFBhY2thZ2VyQXNzZXQsXG4gICdodHRwU2VydmVyTG9jYXRpb24nIHwgJ25hbWUnIHwgJ2hhc2gnIHwgJ3R5cGUnIHwgJ3NjYWxlcycgfCAnd2lkdGgnIHwgJ2hlaWdodCdcbj4gJiB7XG4gIHVyaT86IHN0cmluZztcbiAgZmlsZUhhc2hlcz86IHN0cmluZ1tdO1xuICBmaWxlVXJpcz86IHN0cmluZ1tdO1xufTtcblxuZXhwb3J0IHR5cGUgQXNzZXRTb3VyY2UgPSB7XG4gIHVyaTogc3RyaW5nO1xuICBoYXNoOiBzdHJpbmc7XG59O1xuXG4vKipcbiAqIFNlbGVjdHMgdGhlIGJlc3QgZmlsZSBmb3IgdGhlIGdpdmVuIGFzc2V0IChleDogY2hvb3NpbmcgdGhlIGJlc3Qgc2NhbGUgZm9yIGltYWdlcykgYW5kIHJldHVybnNcbiAqIGEgeyB1cmksIGhhc2ggfSBwYWlyIGZvciB0aGUgc3BlY2lmaWMgYXNzZXQgZmlsZS5cbiAqXG4gKiBJZiB0aGUgYXNzZXQgaXNuJ3QgYW4gaW1hZ2Ugd2l0aCBtdWx0aXBsZSBzY2FsZXMsIHRoZSBmaXJzdCBmaWxlIGlzIHNlbGVjdGVkLlxuICovXG5leHBvcnQgZnVuY3Rpb24gc2VsZWN0QXNzZXRTb3VyY2UobWV0YTogQXNzZXRNZXRhZGF0YSk6IEFzc2V0U291cmNlIHtcbiAgLy8gVGhpcyBsb2dpYyBpcyBiYXNlZCBvbiB0aGF0IG9mIEFzc2V0U291cmNlUmVzb2x2ZXIsIHdpdGggYWRkaXRpb25hbCBzdXBwb3J0IGZvciBmaWxlIGhhc2hlcyBhbmRcbiAgLy8gZXhwbGljaXRseSBwcm92aWRlZCBVUklzXG4gIGNvbnN0IHNjYWxlID0gQXNzZXRTb3VyY2VSZXNvbHZlci5waWNrU2NhbGUobWV0YS5zY2FsZXMsIFBpeGVsUmF0aW8uZ2V0KCkpO1xuICBjb25zdCBpbmRleCA9IG1ldGEuc2NhbGVzLmZpbmRJbmRleCgocykgPT4gcyA9PT0gc2NhbGUpO1xuICBjb25zdCBoYXNoID0gbWV0YS5maWxlSGFzaGVzID8gKG1ldGEuZmlsZUhhc2hlc1tpbmRleF0gPz8gbWV0YS5maWxlSGFzaGVzWzBdKSA6IG1ldGEuaGFzaDtcblxuICAvLyBBbGxvdyBhc3NldCBwcm9jZXNzb3JzIHRvIGRpcmVjdGx5IHByb3ZpZGUgdGhlIFVSTCB0byBsb2FkXG4gIGNvbnN0IHVyaSA9IG1ldGEuZmlsZVVyaXMgPyAobWV0YS5maWxlVXJpc1tpbmRleF0gPz8gbWV0YS5maWxlVXJpc1swXSkgOiBtZXRhLnVyaTtcbiAgaWYgKHVyaSkge1xuICAgIHJldHVybiB7IHVyaTogcmVzb2x2ZVVyaSh1cmkpLCBoYXNoIH07XG4gIH1cblxuICBjb25zdCBmaWxlU2NhbGUgPSBzY2FsZSA9PT0gMSA/ICcnIDogYEAke3NjYWxlfXhgO1xuICBjb25zdCBmaWxlRXh0ZW5zaW9uID0gbWV0YS50eXBlID8gYC4ke2VuY29kZVVSSUNvbXBvbmVudChtZXRhLnR5cGUpfWAgOiAnJztcbiAgY29uc3Qgc3VmZml4ID0gYC8ke2VuY29kZVVSSUNvbXBvbmVudChtZXRhLm5hbWUpfSR7ZmlsZVNjYWxlfSR7ZmlsZUV4dGVuc2lvbn1gO1xuICBjb25zdCBwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHtcbiAgICBwbGF0Zm9ybTogUGxhdGZvcm0uT1MsXG4gICAgaGFzaDogbWV0YS5oYXNoLFxuICB9KTtcblxuICAvLyBGb3IgYXNzZXRzIHdpdGggYSBzcGVjaWZpZWQgYWJzb2x1dGUgVVJMLCB3ZSB1c2UgdGhlIGV4aXN0aW5nIG9yaWdpbiBpbnN0ZWFkIG9mIHByZXBlbmRpbmcgdGhlXG4gIC8vIGRldmVsb3BtZW50IHNlcnZlciBvciBwcm9kdWN0aW9uIENETiBVUkwgb3JpZ2luXG4gIGlmICgvXmh0dHBzPzpcXC9cXC8vLnRlc3QobWV0YS5odHRwU2VydmVyTG9jYXRpb24pKSB7XG4gICAgY29uc3QgdXJpID0gbWV0YS5odHRwU2VydmVyTG9jYXRpb24gKyBzdWZmaXggKyAnPycgKyBwYXJhbXM7XG4gICAgcmV0dXJuIHsgdXJpLCBoYXNoIH07XG4gIH1cblxuICAvLyBGb3IgYXNzZXRzIGR1cmluZyBkZXZlbG9wbWVudCB1c2luZyBtYW5pZmVzdDIsIHdlIHVzZSB0aGUgZGV2ZWxvcG1lbnQgc2VydmVyJ3MgVVJMIG9yaWdpblxuICBjb25zdCBtYW5pZmVzdDIgPSBnZXRNYW5pZmVzdDIoKTtcblxuICBjb25zdCBkZXZTZXJ2ZXJVcmwgPSBtYW5pZmVzdDI/LmV4dHJhPy5leHBvR28/LmRldmVsb3BlclxuICAgID8gJ2h0dHA6Ly8nICsgbWFuaWZlc3QyLmV4dHJhLmV4cG9Hby5kZWJ1Z2dlckhvc3RcbiAgICA6IG51bGw7XG4gIGlmIChkZXZTZXJ2ZXJVcmwpIHtcbiAgICBjb25zdCBiYXNlVXJsID0gbmV3IFVSTChtZXRhLmh0dHBTZXJ2ZXJMb2NhdGlvbiArIHN1ZmZpeCwgZGV2U2VydmVyVXJsKTtcblxuICAgIGJhc2VVcmwuc2VhcmNoUGFyYW1zLnNldCgncGxhdGZvcm0nLCBQbGF0Zm9ybS5PUyk7XG4gICAgYmFzZVVybC5zZWFyY2hQYXJhbXMuc2V0KCdoYXNoJywgbWV0YS5oYXNoKTtcbiAgICByZXR1cm4ge1xuICAgICAgdXJpOiBiYXNlVXJsLmhyZWYsXG4gICAgICBoYXNoLFxuICAgIH07XG4gIH1cblxuICAvLyBUZW1wb3JhcnkgZmFsbGJhY2sgZm9yIGxvYWRpbmcgYXNzZXRzIGluIEV4cG8gR28gaG9tZVxuICBpZiAoTmF0aXZlTW9kdWxlcy5FeHBvbmVudEtlcm5lbCkge1xuICAgIHJldHVybiB7IHVyaTogYGh0dHBzOi8vY2xhc3NpYy1hc3NldHMuZWFzY2RuLm5ldC9+YXNzZXRzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KGhhc2gpfWAsIGhhc2ggfTtcbiAgfVxuXG4gIC8vIEluIGNvcnJlY3RseSBjb25maWd1cmVkIGFwcHMsIHdlIGFycml2ZSBoZXJlIGlmIHRoZSBhc3NldCBpcyBsb2NhbGx5IGF2YWlsYWJsZSBvbiBkaXNrIGR1ZSB0b1xuICAvLyBiZWluZyBtYW5hZ2VkIGJ5IGV4cG8tdXBkYXRlcywgYW5kIGBnZXRMb2NhbEFzc2V0VXJpKGhhc2gpYCBtdXN0IHJldHVybiBhIGxvY2FsIFVSSSBmb3IgdGhpc1xuICAvLyBoYXNoLiBTaW5jZSB0aGUgYXNzZXQgaXMgbG9jYWwsIHdlIGRvbid0IGhhdmUgYSByZW1vdGUgVVJMIGFuZCBzcGVjaWZ5IGFuIGludmFsaWQgVVJMIChhbiBlbXB0eVxuICAvLyBzdHJpbmcpIGFzIGEgcGxhY2Vob2xkZXIuXG4gIHJldHVybiB7IHVyaTogJycsIGhhc2ggfTtcbn1cblxuLyoqXG4gKiBSZXNvbHZlcyB0aGUgZ2l2ZW4gVVJJIHRvIGFuIGFic29sdXRlIFVSSS4gSWYgdGhlIGdpdmVuIFVSSSBpcyBhbHJlYWR5IGFuIGFic29sdXRlIFVSSSwgaXQgaXNcbiAqIHNpbXBseSByZXR1cm5lZC4gT3RoZXJ3aXNlLCBpZiBpdCBpcyBhIHJlbGF0aXZlIFVSSSwgaXQgaXMgcmVzb2x2ZWQgcmVsYXRpdmUgdG8gdGhlIG1hbmlmZXN0J3NcbiAqIGJhc2UgVVJJLlxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVzb2x2ZVVyaSh1cmk6IHN0cmluZyk6IHN0cmluZyB7XG4gIC8vIGBtYW5pZmVzdEJhc2VVcmxgIGlzIGFsd2F5cyBhbiBhYnNvbHV0ZSBVUkwgb3IgYG51bGxgLlxuICByZXR1cm4gbWFuaWZlc3RCYXNlVXJsID8gbmV3IFVSTCh1cmksIG1hbmlmZXN0QmFzZVVybCkuaHJlZiA6IHVyaTtcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsSUFBQUEsZ0JBQUEsR0FBQUMsT0FBQTtBQUNBLElBQUFDLFlBQUEsR0FBQUQsT0FBQTtB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