{"version":3,"names":["_react","require","_asyncStorage","_interopRequireDefault","useActivityMetrics","_useState","useState","_useState2","_slicedToArray2","default","currentStreak","setCurrentStreak","_useState3","_useState4","todayMinutes","setTodayMinutes","_useState5","_useState6","sessionStart","setSessionStart","getTodayString","Date","toDateString","useEffect","loadMetrics","_ref","_asyncToGenerator2","today","_yield$Promise$all","Promise","all","AsyncStorage","getItem","_yield$Promise$all2","streakData","timeData","lastDateData","parseInt","lastDate","setItem","error","apply","arguments","startSession","useCallback","exerciseType","now","endSession","sessionEnd","sessionMinutes","Math","round","newTodayTotal","toString","updateStreak","yesterday","setDate","getDate","isYesterday","newStreak","getStreakTrend","getFormattedTime","hours","floor","mins","streakTrend","formattedTime","_default","exports"],"sources":["useActivityMetrics.js"],"sourcesContent":["// src/hooks/useActivityMetrics.js - TEMPS QUOTIDIEN\n\nimport { useState, useEffect, useCallback } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\n\nconst useActivityMetrics = () => {\n  const [currentStreak, setCurrentStreak] = useState(0);\n  const [todayMinutes, setTodayMinutes] = useState(0); // ✅ CHANGÉ : quotidien\n  const [sessionStart, setSessionStart] = useState(null);\n\n  // =================== DATES HELPER ===================\n  const getTodayString = () => new Date().toDateString();\n\n  // =================== CHARGEMENT INITIAL ===================\n  useEffect(() => {\n    loadMetrics();\n  }, []);\n\n  const loadMetrics = async () => {\n    try {\n      const today = getTodayString();\n      \n      const [streakData, timeData, lastDateData] = await Promise.all([\n        AsyncStorage.getItem('current_streak'),\n        AsyncStorage.getItem('today_minutes'),\n        AsyncStorage.getItem('last_time_date')\n      ]);\n\n      setCurrentStreak(parseInt(streakData || '0'));\n      \n      // ✅ CORRECTION : Vérifier si c'est aujourd'hui\n      const lastDate = lastDateData;\n      if (lastDate === today) {\n        setTodayMinutes(parseInt(timeData || '0'));\n      } else {\n        // Nouveau jour = reset\n        setTodayMinutes(0);\n        await AsyncStorage.setItem('today_minutes', '0');\n        await AsyncStorage.setItem('last_time_date', today);\n      }\n    } catch (error) {\n      // Silently fail\n    }\n  };\n\n  // =================== SESSION TIMER ===================\n  const startSession = useCallback((exerciseType) => {\n    setSessionStart(Date.now());\n  }, []);\n\n  const endSession = useCallback(async () => {\n    if (!sessionStart) return;\n\n    try {\n      const sessionEnd = Date.now();\n      const sessionMinutes = Math.round((sessionEnd - sessionStart) / 60000);\n\n      if (sessionMinutes > 0) {\n        const newTodayTotal = todayMinutes + sessionMinutes;\n        setTodayMinutes(newTodayTotal);\n        \n        const today = getTodayString();\n        await Promise.all([\n          AsyncStorage.setItem('today_minutes', newTodayTotal.toString()),\n          AsyncStorage.setItem('last_time_date', today)\n        ]);\n      }\n\n      setSessionStart(null);\n    } catch (error) {\n      // Silently fail\n    }\n  }, [sessionStart, todayMinutes]);\n\n  // =================== STREAK LOGIC ===================\n  const updateStreak = useCallback(async () => {\n    try {\n      const today = getTodayString();\n      const lastDate = await AsyncStorage.getItem('last_activity_date');\n      \n      if (lastDate !== today) {\n        const yesterday = new Date();\n        yesterday.setDate(yesterday.getDate() - 1);\n        const isYesterday = lastDate === yesterday.toDateString();\n        \n        let newStreak;\n        if (isYesterday) {\n          newStreak = currentStreak + 1;\n        } else {\n          newStreak = 1;\n        }\n        \n        setCurrentStreak(newStreak);\n        await Promise.all([\n          AsyncStorage.setItem('current_streak', newStreak.toString()),\n          AsyncStorage.setItem('last_activity_date', today)\n        ]);\n      }\n    } catch (error) {\n      // Silently fail\n    }\n  }, [currentStreak]);\n\n  // =================== GETTERS ===================\n  const getStreakTrend = useCallback(() => {\n    if (currentStreak >= 7) return '🏆 Incroyable!';\n    if (currentStreak >= 3) return '💪 En forme!';\n    if (currentStreak >= 1) return '🔥 Continue!';\n    return null;\n  }, [currentStreak]);\n\n  const getFormattedTime = useCallback(() => {\n    if (todayMinutes < 60) {\n      return `${todayMinutes}min`;\n    } else {\n      const hours = Math.floor(todayMinutes / 60);\n      const mins = todayMinutes % 60;\n      return `${hours}h${mins > 0 ? `${mins}min` : ''}`;\n    }\n  }, [todayMinutes]);\n\n  return {\n    startSession,\n    endSession,\n    updateStreak,\n    \n    currentStreak: currentStreak || 0,\n    todayMinutes: todayMinutes || 0, // ✅ CHANGÉ : quotidien\n    \n    streakTrend: getStreakTrend(),\n    formattedTime: getFormattedTime() || '0min',\n  };\n};\n\nexport default useActivityMetrics;"],"mappings":"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","ignoreList":[]}