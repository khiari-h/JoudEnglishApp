07f8d06aa615496380a2d3712b7087a7
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.disableLock = disableLock;
exports.emergencyReset = emergencyReset;
exports.enableLock = enableLock;
exports.generateRecoveryCode = generateRecoveryCode;
exports.getAutoLockTimeout = getAutoLockTimeout;
exports.isBiometricsEnabled = isBiometricsEnabled;
exports.isEnabled = isEnabled;
exports.lockStorageKeys = void 0;
exports.setAutoLockTimeout = setAutoLockTimeout;
exports.setBiometricsEnabled = setBiometricsEnabled;
exports.setPin = setPin;
exports.setRecoveryCode = setRecoveryCode;
exports.verifyPin = verifyPin;
exports.verifyRecovery = verifyRecovery;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _asyncStorage = _interopRequireDefault(require("@react-native-async-storage/async-storage"));
var STORAGE_KEYS = {
  ENABLED: 'app_lock.enabled',
  PIN_HASH: 'app_lock.pin_hash',
  PIN_SALT: 'app_lock.pin_salt',
  BIO_ENABLED: 'app_lock.bio_enabled',
  RECOVERY_HASH: 'app_lock.recovery_hash',
  TIMEOUT_SECONDS: 'app_lock.timeout_seconds',
  LOCKOUT_UNTIL: 'app_lock.lockout_until',
  FAILED_ATTEMPTS: 'app_lock.failed_attempts'
};
function simpleHash(input) {
  var hash = 0;
  var str = String(input);
  for (var i = 0; i < str.length; i += 1) {
    hash = (hash << 5) - hash + str.charCodeAt(i);
    hash |= 0;
  }
  return Math.abs(hash).toString(16);
}
function randomSalt() {
  var length = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 16;
  var chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  var out = '';
  for (var i = 0; i < length; i += 1) out += chars[Math.floor(Math.random() * chars.length)];
  return out;
}
function isEnabled() {
  return _isEnabled.apply(this, arguments);
}
function _isEnabled() {
  _isEnabled = (0, _asyncToGenerator2.default)(function* () {
    var enabled = yield _asyncStorage.default.getItem(STORAGE_KEYS.ENABLED);
    return enabled === '1';
  });
  return _isEnabled.apply(this, arguments);
}
function enableLock() {
  return _enableLock.apply(this, arguments);
}
function _enableLock() {
  _enableLock = (0, _asyncToGenerator2.default)(function* () {
    yield _asyncStorage.default.setItem(STORAGE_KEYS.ENABLED, '1');
    return true;
  });
  return _enableLock.apply(this, arguments);
}
function disableLock() {
  return _disableLock.apply(this, arguments);
}
function _disableLock() {
  _disableLock = (0, _asyncToGenerator2.default)(function* () {
    yield _asyncStorage.default.multiRemove([STORAGE_KEYS.ENABLED, STORAGE_KEYS.PIN_HASH, STORAGE_KEYS.PIN_SALT, STORAGE_KEYS.BIO_ENABLED, STORAGE_KEYS.RECOVERY_HASH, STORAGE_KEYS.TIMEOUT_SECONDS, STORAGE_KEYS.LOCKOUT_UNTIL, STORAGE_KEYS.FAILED_ATTEMPTS]);
    return true;
  });
  return _disableLock.apply(this, arguments);
}
function setPin(_x) {
  return _setPin.apply(this, arguments);
}
function _setPin() {
  _setPin = (0, _asyncToGenerator2.default)(function* (pin) {
    var salt = randomSalt();
    var pinHash = simpleHash(`${salt}:${pin}`);
    yield _asyncStorage.default.setItem(STORAGE_KEYS.PIN_SALT, salt);
    yield _asyncStorage.default.setItem(STORAGE_KEYS.PIN_HASH, pinHash);
    return true;
  });
  return _setPin.apply(this, arguments);
}
function verifyPin(_x2) {
  return _verifyPin.apply(this, arguments);
}
function _verifyPin() {
  _verifyPin = (0, _asyncToGenerator2.default)(function* (pin) {
    var lockoutUntil = Number((yield _asyncStorage.default.getItem(STORAGE_KEYS.LOCKOUT_UNTIL)) || '0');
    var now = Date.now();
    if (lockoutUntil && now < lockoutUntil) {
      return {
        ok: false,
        reason: 'lockout'
      };
    }
    var salt = yield _asyncStorage.default.getItem(STORAGE_KEYS.PIN_SALT);
    var expected = yield _asyncStorage.default.getItem(STORAGE_KEYS.PIN_HASH);
    if (!salt || !expected) return {
      ok: false
    };
    var given = simpleHash(`${salt}:${pin}`);
    var ok = given === expected;
    var attempts = Number((yield _asyncStorage.default.getItem(STORAGE_KEYS.FAILED_ATTEMPTS)) || '0');
    if (ok) {
      yield _asyncStorage.default.setItem(STORAGE_KEYS.FAILED_ATTEMPTS, '0');
      return {
        ok: true
      };
    }
    attempts += 1;
    yield _asyncStorage.default.setItem(STORAGE_KEYS.FAILED_ATTEMPTS, String(attempts));
    if (attempts >= 5) {
      var lockMs = 30000 * Math.min(4, attempts - 4);
      yield _asyncStorage.default.setItem(STORAGE_KEYS.LOCKOUT_UNTIL, String(now + lockMs));
      return {
        ok: false,
        reason: 'lockout'
      };
    }
    return {
      ok: false
    };
  });
  return _verifyPin.apply(this, arguments);
}
function setBiometricsEnabled(_x3) {
  return _setBiometricsEnabled.apply(this, arguments);
}
function _setBiometricsEnabled() {
  _setBiometricsEnabled = (0, _asyncToGenerator2.default)(function* (enabled) {
    yield _asyncStorage.default.setItem(STORAGE_KEYS.BIO_ENABLED, enabled ? '1' : '0');
    return true;
  });
  return _setBiometricsEnabled.apply(this, arguments);
}
function isBiometricsEnabled() {
  return _isBiometricsEnabled.apply(this, arguments);
}
function _isBiometricsEnabled() {
  _isBiometricsEnabled = (0, _asyncToGenerator2.default)(function* () {
    var v = yield _asyncStorage.default.getItem(STORAGE_KEYS.BIO_ENABLED);
    return v === '1';
  });
  return _isBiometricsEnabled.apply(this, arguments);
}
function generateRecoveryCode() {
  var chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  var code = '';
  for (var i = 0; i < 16; i += 1) code += chars[Math.floor(Math.random() * chars.length)];
  return code;
}
function setRecoveryCode(_x4) {
  return _setRecoveryCode.apply(this, arguments);
}
function _setRecoveryCode() {
  _setRecoveryCode = (0, _asyncToGenerator2.default)(function* (code) {
    var hash = simpleHash(code);
    yield _asyncStorage.default.setItem(STORAGE_KEYS.RECOVERY_HASH, hash);
    return true;
  });
  return _setRecoveryCode.apply(this, arguments);
}
function verifyRecovery(_x5) {
  return _verifyRecovery.apply(this, arguments);
}
function _verifyRecovery() {
  _verifyRecovery = (0, _asyncToGenerator2.default)(function* (code) {
    var expected = yield _asyncStorage.default.getItem(STORAGE_KEYS.RECOVERY_HASH);
    if (!expected) return false;
    return simpleHash(code) === expected;
  });
  return _verifyRecovery.apply(this, arguments);
}
function setAutoLockTimeout(_x6) {
  return _setAutoLockTimeout.apply(this, arguments);
}
function _setAutoLockTimeout() {
  _setAutoLockTimeout = (0, _asyncToGenerator2.default)(function* (seconds) {
    yield _asyncStorage.default.setItem(STORAGE_KEYS.TIMEOUT_SECONDS, String(seconds));
    return true;
  });
  return _setAutoLockTimeout.apply(this, arguments);
}
function getAutoLockTimeout() {
  return _getAutoLockTimeout.apply(this, arguments);
}
function _getAutoLockTimeout() {
  _getAutoLockTimeout = (0, _asyncToGenerator2.default)(function* () {
    return Number((yield _asyncStorage.default.getItem(STORAGE_KEYS.TIMEOUT_SECONDS)) || '0');
  });
  return _getAutoLockTimeout.apply(this, arguments);
}
function emergencyReset() {
  return _emergencyReset.apply(this, arguments);
}
function _emergencyReset() {
  _emergencyReset = (0, _asyncToGenerator2.default)(function* () {
    yield disableLock();
    return true;
  });
  return _emergencyReset.apply(this, arguments);
}
var lockStorageKeys = exports.lockStorageKeys = STORAGE_KEYS;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfYXN5bmNTdG9yYWdlIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJTVE9SQUdFX0tFWVMiLCJFTkFCTEVEIiwiUElOX0hBU0giLCJQSU5fU0FMVCIsIkJJT19FTkFCTEVEIiwiUkVDT1ZFUllfSEFTSCIsIlRJTUVPVVRfU0VDT05EUyIsIkxPQ0tPVVRfVU5USUwiLCJGQUlMRURfQVRURU1QVFMiLCJzaW1wbGVIYXNoIiwiaW5wdXQiLCJoYXNoIiwic3RyIiwiU3RyaW5nIiwiaSIsImxlbmd0aCIsImNoYXJDb2RlQXQiLCJNYXRoIiwiYWJzIiwidG9TdHJpbmciLCJyYW5kb21TYWx0IiwiYXJndW1lbnRzIiwidW5kZWZpbmVkIiwiY2hhcnMiLCJvdXQiLCJmbG9vciIsInJhbmRvbSIsImlzRW5hYmxlZCIsIl9pc0VuYWJsZWQiLCJhcHBseSIsIl9hc3luY1RvR2VuZXJhdG9yMiIsImRlZmF1bHQiLCJlbmFibGVkIiwiQXN5bmNTdG9yYWdlIiwiZ2V0SXRlbSIsImVuYWJsZUxvY2siLCJfZW5hYmxlTG9jayIsInNldEl0ZW0iLCJkaXNhYmxlTG9jayIsIl9kaXNhYmxlTG9jayIsIm11bHRpUmVtb3ZlIiwic2V0UGluIiwiX3giLCJfc2V0UGluIiwicGluIiwic2FsdCIsInBpbkhhc2giLCJ2ZXJpZnlQaW4iLCJfeDIiLCJfdmVyaWZ5UGluIiwibG9ja291dFVudGlsIiwiTnVtYmVyIiwibm93IiwiRGF0ZSIsIm9rIiwicmVhc29uIiwiZXhwZWN0ZWQiLCJnaXZlbiIsImF0dGVtcHRzIiwibG9ja01zIiwibWluIiwic2V0QmlvbWV0cmljc0VuYWJsZWQiLCJfeDMiLCJfc2V0QmlvbWV0cmljc0VuYWJsZWQiLCJpc0Jpb21ldHJpY3NFbmFibGVkIiwiX2lzQmlvbWV0cmljc0VuYWJsZWQiLCJ2IiwiZ2VuZXJhdGVSZWNvdmVyeUNvZGUiLCJjb2RlIiwic2V0UmVjb3ZlcnlDb2RlIiwiX3g0IiwiX3NldFJlY292ZXJ5Q29kZSIsInZlcmlmeVJlY292ZXJ5IiwiX3g1IiwiX3ZlcmlmeVJlY292ZXJ5Iiwic2V0QXV0b0xvY2tUaW1lb3V0IiwiX3g2IiwiX3NldEF1dG9Mb2NrVGltZW91dCIsInNlY29uZHMiLCJnZXRBdXRvTG9ja1RpbWVvdXQiLCJfZ2V0QXV0b0xvY2tUaW1lb3V0IiwiZW1lcmdlbmN5UmVzZXQiLCJfZW1lcmdlbmN5UmVzZXQiLCJsb2NrU3RvcmFnZUtleXMiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsibG9ja1NlcnZpY2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3NlcnZpY2VzL2xvY2tTZXJ2aWNlLmpzIC0gU2ltcGxlIG9mZmxpbmUgYXBwIGxvY2sgc2VydmljZSAoUElOICsgcmVjb3ZlcnkpXHJcbmltcG9ydCBBc3luY1N0b3JhZ2UgZnJvbSAnQHJlYWN0LW5hdGl2ZS1hc3luYy1zdG9yYWdlL2FzeW5jLXN0b3JhZ2UnO1xyXG5cclxuY29uc3QgU1RPUkFHRV9LRVlTID0ge1xyXG4gIEVOQUJMRUQ6ICdhcHBfbG9jay5lbmFibGVkJyxcclxuICBQSU5fSEFTSDogJ2FwcF9sb2NrLnBpbl9oYXNoJyxcclxuICBQSU5fU0FMVDogJ2FwcF9sb2NrLnBpbl9zYWx0JyxcclxuICBCSU9fRU5BQkxFRDogJ2FwcF9sb2NrLmJpb19lbmFibGVkJyxcclxuICBSRUNPVkVSWV9IQVNIOiAnYXBwX2xvY2sucmVjb3ZlcnlfaGFzaCcsXHJcbiAgVElNRU9VVF9TRUNPTkRTOiAnYXBwX2xvY2sudGltZW91dF9zZWNvbmRzJyxcclxuICBMT0NLT1VUX1VOVElMOiAnYXBwX2xvY2subG9ja291dF91bnRpbCcsXHJcbiAgRkFJTEVEX0FUVEVNUFRTOiAnYXBwX2xvY2suZmFpbGVkX2F0dGVtcHRzJyxcclxufTtcclxuXHJcbi8vIE5PVEU6IFRoaXMgaXMgbm90IGNyeXB0b2dyYXBoaWNhbGx5IHN0cm9uZy4gRm9yIGxvY2FsIGxvY2sgVVggb25seS5cclxuZnVuY3Rpb24gc2ltcGxlSGFzaChpbnB1dCkge1xyXG4gIGxldCBoYXNoID0gMDtcclxuICBjb25zdCBzdHIgPSBTdHJpbmcoaW5wdXQpO1xyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSArPSAxKSB7XHJcbiAgICBoYXNoID0gKGhhc2ggPDwgNSkgLSBoYXNoICsgc3RyLmNoYXJDb2RlQXQoaSk7XHJcbiAgICBoYXNoIHw9IDA7XHJcbiAgfVxyXG4gIHJldHVybiBNYXRoLmFicyhoYXNoKS50b1N0cmluZygxNik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJhbmRvbVNhbHQobGVuZ3RoID0gMTYpIHtcclxuICBjb25zdCBjaGFycyA9ICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ekFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaMDEyMzQ1Njc4OSc7XHJcbiAgbGV0IG91dCA9ICcnO1xyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpICs9IDEpIG91dCArPSBjaGFyc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBjaGFycy5sZW5ndGgpXTtcclxuICByZXR1cm4gb3V0O1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaXNFbmFibGVkKCkge1xyXG4gIGNvbnN0IGVuYWJsZWQgPSBhd2FpdCBBc3luY1N0b3JhZ2UuZ2V0SXRlbShTVE9SQUdFX0tFWVMuRU5BQkxFRCk7XHJcbiAgcmV0dXJuIGVuYWJsZWQgPT09ICcxJztcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGVuYWJsZUxvY2soKSB7XHJcbiAgYXdhaXQgQXN5bmNTdG9yYWdlLnNldEl0ZW0oU1RPUkFHRV9LRVlTLkVOQUJMRUQsICcxJyk7XHJcbiAgcmV0dXJuIHRydWU7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkaXNhYmxlTG9jaygpIHtcclxuICBhd2FpdCBBc3luY1N0b3JhZ2UubXVsdGlSZW1vdmUoW1xyXG4gICAgU1RPUkFHRV9LRVlTLkVOQUJMRUQsXHJcbiAgICBTVE9SQUdFX0tFWVMuUElOX0hBU0gsXHJcbiAgICBTVE9SQUdFX0tFWVMuUElOX1NBTFQsXHJcbiAgICBTVE9SQUdFX0tFWVMuQklPX0VOQUJMRUQsXHJcbiAgICBTVE9SQUdFX0tFWVMuUkVDT1ZFUllfSEFTSCxcclxuICAgIFNUT1JBR0VfS0VZUy5USU1FT1VUX1NFQ09ORFMsXHJcbiAgICBTVE9SQUdFX0tFWVMuTE9DS09VVF9VTlRJTCxcclxuICAgIFNUT1JBR0VfS0VZUy5GQUlMRURfQVRURU1QVFMsXHJcbiAgXSk7XHJcbiAgcmV0dXJuIHRydWU7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRQaW4ocGluKSB7XHJcbiAgY29uc3Qgc2FsdCA9IHJhbmRvbVNhbHQoKTtcclxuICBjb25zdCBwaW5IYXNoID0gc2ltcGxlSGFzaChgJHtzYWx0fToke3Bpbn1gKTtcclxuICBhd2FpdCBBc3luY1N0b3JhZ2Uuc2V0SXRlbShTVE9SQUdFX0tFWVMuUElOX1NBTFQsIHNhbHQpO1xyXG4gIGF3YWl0IEFzeW5jU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZUy5QSU5fSEFTSCwgcGluSGFzaCk7XHJcbiAgcmV0dXJuIHRydWU7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlQaW4ocGluKSB7XHJcbiAgY29uc3QgbG9ja291dFVudGlsID0gTnVtYmVyKGF3YWl0IEFzeW5jU3RvcmFnZS5nZXRJdGVtKFNUT1JBR0VfS0VZUy5MT0NLT1VUX1VOVElMKSB8fCAnMCcpO1xyXG4gIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XHJcbiAgaWYgKGxvY2tvdXRVbnRpbCAmJiBub3cgPCBsb2Nrb3V0VW50aWwpIHtcclxuICAgIHJldHVybiB7IG9rOiBmYWxzZSwgcmVhc29uOiAnbG9ja291dCcgfTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHNhbHQgPSBhd2FpdCBBc3luY1N0b3JhZ2UuZ2V0SXRlbShTVE9SQUdFX0tFWVMuUElOX1NBTFQpO1xyXG4gIGNvbnN0IGV4cGVjdGVkID0gYXdhaXQgQXN5bmNTdG9yYWdlLmdldEl0ZW0oU1RPUkFHRV9LRVlTLlBJTl9IQVNIKTtcclxuICBpZiAoIXNhbHQgfHwgIWV4cGVjdGVkKSByZXR1cm4geyBvazogZmFsc2UgfTtcclxuICBjb25zdCBnaXZlbiA9IHNpbXBsZUhhc2goYCR7c2FsdH06JHtwaW59YCk7XHJcbiAgY29uc3Qgb2sgPSBnaXZlbiA9PT0gZXhwZWN0ZWQ7XHJcblxyXG4gIGxldCBhdHRlbXB0cyA9IE51bWJlcihhd2FpdCBBc3luY1N0b3JhZ2UuZ2V0SXRlbShTVE9SQUdFX0tFWVMuRkFJTEVEX0FUVEVNUFRTKSB8fCAnMCcpO1xyXG4gIGlmIChvaykge1xyXG4gICAgYXdhaXQgQXN5bmNTdG9yYWdlLnNldEl0ZW0oU1RPUkFHRV9LRVlTLkZBSUxFRF9BVFRFTVBUUywgJzAnKTtcclxuICAgIHJldHVybiB7IG9rOiB0cnVlIH07XHJcbiAgfVxyXG4gIGF0dGVtcHRzICs9IDE7XHJcbiAgYXdhaXQgQXN5bmNTdG9yYWdlLnNldEl0ZW0oU1RPUkFHRV9LRVlTLkZBSUxFRF9BVFRFTVBUUywgU3RyaW5nKGF0dGVtcHRzKSk7XHJcbiAgaWYgKGF0dGVtcHRzID49IDUpIHtcclxuICAgIGNvbnN0IGxvY2tNcyA9IDMwXzAwMCAqIE1hdGgubWluKDQsIGF0dGVtcHRzIC0gNCk7IC8vIDMwcywgNjBzLCA5MHMsIDEyMHNcclxuICAgIGF3YWl0IEFzeW5jU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZUy5MT0NLT1VUX1VOVElMLCBTdHJpbmcobm93ICsgbG9ja01zKSk7XHJcbiAgICByZXR1cm4geyBvazogZmFsc2UsIHJlYXNvbjogJ2xvY2tvdXQnIH07XHJcbiAgfVxyXG4gIHJldHVybiB7IG9rOiBmYWxzZSB9O1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2V0QmlvbWV0cmljc0VuYWJsZWQoZW5hYmxlZCkge1xyXG4gIGF3YWl0IEFzeW5jU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZUy5CSU9fRU5BQkxFRCwgZW5hYmxlZCA/ICcxJyA6ICcwJyk7XHJcbiAgcmV0dXJuIHRydWU7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpc0Jpb21ldHJpY3NFbmFibGVkKCkge1xyXG4gIGNvbnN0IHYgPSBhd2FpdCBBc3luY1N0b3JhZ2UuZ2V0SXRlbShTVE9SQUdFX0tFWVMuQklPX0VOQUJMRUQpO1xyXG4gIHJldHVybiB2ID09PSAnMSc7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVJlY292ZXJ5Q29kZSgpIHtcclxuICBjb25zdCBjaGFycyA9ICdBQkNERUZHSEpLTE1OUFFSU1RVVldYWVoyMzQ1Njc4OSc7XHJcbiAgbGV0IGNvZGUgPSAnJztcclxuICBmb3IgKGxldCBpID0gMDsgaSA8IDE2OyBpICs9IDEpIGNvZGUgKz0gY2hhcnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY2hhcnMubGVuZ3RoKV07XHJcbiAgcmV0dXJuIGNvZGU7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRSZWNvdmVyeUNvZGUoY29kZSkge1xyXG4gIGNvbnN0IGhhc2ggPSBzaW1wbGVIYXNoKGNvZGUpO1xyXG4gIGF3YWl0IEFzeW5jU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZUy5SRUNPVkVSWV9IQVNILCBoYXNoKTtcclxuICByZXR1cm4gdHJ1ZTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZlcmlmeVJlY292ZXJ5KGNvZGUpIHtcclxuICBjb25zdCBleHBlY3RlZCA9IGF3YWl0IEFzeW5jU3RvcmFnZS5nZXRJdGVtKFNUT1JBR0VfS0VZUy5SRUNPVkVSWV9IQVNIKTtcclxuICBpZiAoIWV4cGVjdGVkKSByZXR1cm4gZmFsc2U7XHJcbiAgcmV0dXJuIHNpbXBsZUhhc2goY29kZSkgPT09IGV4cGVjdGVkO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2V0QXV0b0xvY2tUaW1lb3V0KHNlY29uZHMpIHtcclxuICBhd2FpdCBBc3luY1N0b3JhZ2Uuc2V0SXRlbShTVE9SQUdFX0tFWVMuVElNRU9VVF9TRUNPTkRTLCBTdHJpbmcoc2Vjb25kcykpO1xyXG4gIHJldHVybiB0cnVlO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QXV0b0xvY2tUaW1lb3V0KCkge1xyXG4gIHJldHVybiBOdW1iZXIoYXdhaXQgQXN5bmNTdG9yYWdlLmdldEl0ZW0oU1RPUkFHRV9LRVlTLlRJTUVPVVRfU0VDT05EUykgfHwgJzAnKTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGVtZXJnZW5jeVJlc2V0KCkge1xyXG4gIGF3YWl0IGRpc2FibGVMb2NrKCk7XHJcbiAgcmV0dXJuIHRydWU7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBsb2NrU3RvcmFnZUtleXMgPSBTVE9SQUdFX0tFWVM7XHJcblxyXG5cclxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ0EsSUFBQUEsYUFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBRUEsSUFBTUMsWUFBWSxHQUFHO0VBQ25CQyxPQUFPLEVBQUUsa0JBQWtCO0VBQzNCQyxRQUFRLEVBQUUsbUJBQW1CO0VBQzdCQyxRQUFRLEVBQUUsbUJBQW1CO0VBQzdCQyxXQUFXLEVBQUUsc0JBQXNCO0VBQ25DQyxhQUFhLEVBQUUsd0JBQXdCO0VBQ3ZDQyxlQUFlLEVBQUUsMEJBQTBCO0VBQzNDQyxhQUFhLEVBQUUsd0JBQXdCO0VBQ3ZDQyxlQUFlLEVBQUU7QUFDbkIsQ0FBQztBQUdELFNBQVNDLFVBQVVBLENBQUNDLEtBQUssRUFBRTtFQUN6QixJQUFJQyxJQUFJLEdBQUcsQ0FBQztFQUNaLElBQU1DLEdBQUcsR0FBR0MsTUFBTSxDQUFDSCxLQUFLLENBQUM7RUFDekIsS0FBSyxJQUFJSSxDQUFDLEdBQUcsQ0FBQyxFQUFFQSxDQUFDLEdBQUdGLEdBQUcsQ0FBQ0csTUFBTSxFQUFFRCxDQUFDLElBQUksQ0FBQyxFQUFFO0lBQ3RDSCxJQUFJLEdBQUcsQ0FBQ0EsSUFBSSxJQUFJLENBQUMsSUFBSUEsSUFB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