{"version":3,"names":["_react","require","_reactNative","_native","_ThemeContext","_useRevisionManager2","_interopRequireDefault","_useRevisionData2","_useQuizEngine","_EmptyState","_QuizScreen","_ResultScreen","_style","_jsxRuntime","_Dimensions$get","Dimensions","get","width","MIN_WORDS_FOR_REVISION_UNLOCK","VocabularyRevision","_ref","route","navigation","useNavigation","themeContext","useContext","ThemeContext","_useRevisionManager","useRevisionManager","markRevisionCompleted","_ref2","params","_ref2$level","level","_ref2$questionsCount","questionsCount","_ref2$source","source","colors","background","surface","text","textSecondary","primary","_useRevisionData","useRevisionData","revisionQuestions","isLoading","error","stats","hasEnoughWords","canGenerateQuestions","quizEngine","useQuizEngine","slideAnim","useRef","Animated","Value","current","shakeAnim","handleGoBack","useCallback","goBack","triggerShakeAnimation","setValue","sequence","timing","toValue","duration","useNativeDriver","start","handleContinue","goToNextQuestion","spring","speed","bounciness","handleAnswer","choice","showResult","isCorrect","handleRestart","handleFinish","_asyncToGenerator2","default","score","totalQuestions","renderContent","jsx","type","message","localStyles","styles","onAction","progress","totalLearned","goal","isFinished","onGoBack","onAnswer","onContinue","jsxs","View","style","container","backgroundColor","children","StatusBar","barStyle","_default","exports"],"sources":["index.js"],"sourcesContent":["// src/screens/VocabularyRevision/index.js - VERSION REFACTORISÉE\r\nimport { useState, useContext, useCallback, useRef } from 'react';\r\nimport { View, Animated, StatusBar, Dimensions } from 'react-native';\r\nimport { useNavigation } from '@react-navigation/native';\r\nimport { ThemeContext } from '../../contexts/ThemeContext';\r\nimport useRevisionManager from '../../hooks/useRevisionManager';\r\nimport useRevisionData from '../../hooks/useRevisionData';\r\nimport useQuizEngine from '../../hooks/useQuizEngine';\r\n\r\nimport EmptyState from './components/EmptyState';\r\nimport QuizScreen from './components/QuizScreen';\r\nimport ResultScreen from './components/ResultScreen';\r\n\r\nimport styles from './style';\r\n\r\nconst { width } = Dimensions.get('window');\r\n\r\n// Seuil pour débloquer la fonctionnalité de révision.\r\nconst MIN_WORDS_FOR_REVISION_UNLOCK = 50;\r\n\r\nconst VocabularyRevision = ({ route }) => {\r\n  const navigation = useNavigation();\r\n  const themeContext = useContext(ThemeContext);\r\n  const { markRevisionCompleted } = useRevisionManager();\r\n\r\n  const {\r\n    level = \"mixed\",\r\n    questionsCount = 10,\r\n    source = 'manual'\r\n  } = route?.params || {};\r\n\r\n  const colors = themeContext?.colors || {\r\n    background: \"#F8FAFC\",\r\n    surface: \"#FFFFFF\",\r\n    text: \"#1F2937\",\r\n    textSecondary: \"#6B7280\",\r\n    primary: \"#3B82F6\"\r\n  };\r\n\r\n  // 1. HOOK DE DONNÉES\r\n  const {\r\n    revisionQuestions,\r\n    isLoading,\r\n    error,\r\n    stats,\r\n    hasEnoughWords,\r\n    canGenerateQuestions\r\n  } = useRevisionData(level, questionsCount);\r\n\r\n  // 2. HOOK DE LOGIQUE DU QUIZ\r\n  const quizEngine = useQuizEngine(revisionQuestions);\r\n  const slideAnim = useRef(new Animated.Value(0)).current;\r\n  const shakeAnim = useRef(new Animated.Value(0)).current;\r\n\r\n  // 3. HANDLERS & ANIMATIONS\r\n  const handleGoBack = useCallback(() => navigation.goBack(), [navigation]);\r\n\r\n  const triggerShakeAnimation = () => {\r\n    shakeAnim.setValue(0);\r\n    Animated.sequence([\r\n      Animated.timing(shakeAnim, { toValue: 10, duration: 80, useNativeDriver: true }),\r\n      Animated.timing(shakeAnim, { toValue: -10, duration: 80, useNativeDriver: true }),\r\n      Animated.timing(shakeAnim, { toValue: 10, duration: 80, useNativeDriver: true }),\r\n      Animated.timing(shakeAnim, { toValue: 0, duration: 80, useNativeDriver: true }),\r\n    ]).start();\r\n  };\r\n\r\n  const handleContinue = useCallback(() => {\r\n    // Slide out to the left\r\n    Animated.timing(slideAnim, {\r\n      toValue: -width,\r\n      duration: 300,\r\n      useNativeDriver: true,\r\n    }).start(() => {\r\n      quizEngine.goToNextQuestion();\r\n      // Position instantly off-screen to the right\r\n      slideAnim.setValue(width);\r\n      // Slide in from the right\r\n      Animated.spring(slideAnim, {\r\n        toValue: 0,\r\n        speed: 12,\r\n        bounciness: 5,\r\n        useNativeDriver: true,\r\n      }).start();\r\n    });\r\n  }, [slideAnim, quizEngine, width]);\r\n\r\n  const handleAnswer = useCallback((choice) => {\r\n    if (quizEngine.showResult) return;\r\n    const isCorrect = quizEngine.handleAnswer(choice);\r\n    if (!isCorrect) {\r\n      triggerShakeAnimation();\r\n    }\r\n  }, [quizEngine, triggerShakeAnimation]);\r\n\r\n  const handleRestart = useCallback(() => {\r\n    quizEngine.handleRestart();\r\n    slideAnim.setValue(0);\r\n  }, [quizEngine, slideAnim]);\r\n\r\n  const handleFinish = useCallback(async () => {\r\n    if (markRevisionCompleted) {\r\n      await markRevisionCompleted(revisionQuestions, quizEngine.score, quizEngine.totalQuestions);\r\n    }\r\n    navigation.goBack();\r\n  }, [navigation, markRevisionCompleted, revisionQuestions, quizEngine.score, quizEngine.totalQuestions]);\r\n\r\n  // 4. LOGIQUE D'AFFICHAGE (Le Chef d'Orchestre)\r\n  const renderContent = () => {\r\n    if (isLoading) {\r\n      return (\r\n        <EmptyState\r\n          type=\"loading\"\r\n          message=\"Récupération de vos mots appris\"\r\n          colors={colors}\r\n          localStyles={styles}\r\n        />\r\n      );\r\n    }\r\n\r\n    if (error) {\r\n      return (\r\n        <EmptyState\r\n          type=\"error\"\r\n          message={error}\r\n          onAction={handleGoBack}\r\n          colors={colors}\r\n          localStyles={styles}\r\n        />\r\n      );\r\n    }\r\n\r\n    if (!canGenerateQuestions || !hasEnoughWords) {\r\n      // Si le quiz ne peut pas être généré mais que la révision est débloquée, on affiche un message spécifique.\r\n      if (hasEnoughWords && !canGenerateQuestions) {\r\n        return <EmptyState type=\"noWords\" message={`Continuez d'apprendre pour diversifier les questions !\\nUn quiz de ${questionsCount} questions ne peut pas être généré pour ce niveau.`} onAction={handleGoBack} colors={colors} localStyles={styles} />;\r\n      }\r\n\r\n      // Sinon, on affiche l'écran de progression \"verrouillé\".\r\n      return (\r\n        <EmptyState\r\n          type=\"locked\"\r\n          progress={stats.totalLearned}\r\n          goal={MIN_WORDS_FOR_REVISION_UNLOCK}\r\n          onAction={handleGoBack}\r\n          colors={colors}\r\n          localStyles={styles}\r\n        />\r\n      );\r\n    }\r\n\r\n    if (quizEngine.isFinished) {\r\n      return (\r\n        <ResultScreen\r\n          score={quizEngine.score}\r\n          totalQuestions={quizEngine.totalQuestions}\r\n          source={source}\r\n          handleRestart={handleRestart}\r\n          handleFinish={handleFinish}\r\n          localStyles={styles}\r\n          colors={colors}\r\n        />\r\n      );\r\n    }\r\n\r\n        return (\r\n      <QuizScreen\r\n        quizEngine={quizEngine}\r\n        onGoBack={handleGoBack}\r\n        onAnswer={handleAnswer}\r\n        onContinue={handleContinue}\r\n        slideAnim={slideAnim}\r\n        shakeAnim={shakeAnim}\r\n        colors={colors}\r\n        localStyles={styles}\r\n      />\r\n    );\r\n  };\r\n\r\n  return (\r\n    <View style={[styles.container, { backgroundColor: colors.background }]}>\r\n      <StatusBar barStyle=\"dark-content\" backgroundColor={colors.background} />\r\n      {renderContent()}\r\n    </View>\r\n  );\r\n};\r\n\r\nexport default VocabularyRevision;\r\n"],"mappings":"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","ignoreList":[]}