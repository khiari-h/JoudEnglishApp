28319931911633d7a96b9610eec73113
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = useVocabularyStorage;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _react = require("react");
var _asyncStorage = _interopRequireDefault(require("@react-native-async-storage/async-storage"));
function useVocabularyStorage(_ref) {
  var STORAGE_KEY = _ref.STORAGE_KEY,
    progressKey = _ref.progressKey,
    loaded = _ref.loaded,
    setLoaded = _ref.setLoaded,
    completedWords = _ref.completedWords,
    setCompletedWords = _ref.setCompletedWords,
    setCategoryIndex = _ref.setCategoryIndex,
    setWordIndex = _ref.setWordIndex,
    exercises = _ref.exercises,
    isInitialized = _ref.isInitialized;
  var handleStorageError = function handleStorageError(error, operation) {
    var fallback = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
    console.warn(`Vocabulary storage error in ${operation}:`, error);
    return fallback;
  };
  (0, _react.useEffect)(function () {
    var loadData = function () {
      var _ref2 = (0, _asyncToGenerator2.default)(function* () {
        try {
          var saved = yield _asyncStorage.default.getItem(STORAGE_KEY);
          if (saved) {
            var _JSON$parse = JSON.parse(saved),
              savedCompleted = _JSON$parse.completedWords,
              lastPosition = _JSON$parse.lastPosition;
            setCompletedWords(savedCompleted || {});
            if (lastPosition) {
              setCategoryIndex(lastPosition.categoryIndex || 0);
              setWordIndex(lastPosition.wordIndex || 0);
            }
          }
        } catch (error) {
          handleStorageError(error, 'loadData');
        } finally {
          setLoaded(true);
        }
      });
      return function loadData() {
        return _ref2.apply(this, arguments);
      };
    }();
    loadData();
  }, [progressKey, STORAGE_KEY, setCompletedWords, setCategoryIndex, setWordIndex, setLoaded]);
  var saveData = (0, _react.useCallback)((0, _asyncToGenerator2.default)(function* () {
    try {
      var dataToSave = {
        completedWords: completedWords,
        lastPosition: {
          categoryIndex: 0,
          wordIndex: 0
        }
      };
      yield _asyncStorage.default.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
    } catch (error) {
      handleStorageError(error, 'saveData');
    }
  }), [completedWords, STORAGE_KEY]);
  (0, _react.useEffect)(function () {
    if (loaded) saveData();
  }, [saveData, loaded]);
  (0, _react.useEffect)(function () {
    if (loaded && exercises && !isInitialized.current) {
      var newCompletedWords = Object.assign({}, completedWords);
      exercises.forEach(function (_, index) {
        if (!newCompletedWords[index]) newCompletedWords[index] = [];
      });
      setCompletedWords(newCompletedWords);
      isInitialized.current = true;
    }
  }, [loaded, exercises, completedWords, setCompletedWords, isInitialized]);
  return {
    saveData: saveData
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJyZXF1aXJlIiwiX2FzeW5jU3RvcmFnZSIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJ1c2VWb2NhYnVsYXJ5U3RvcmFnZSIsIl9yZWYiLCJTVE9SQUdFX0tFWSIsInByb2dyZXNzS2V5IiwibG9hZGVkIiwic2V0TG9hZGVkIiwiY29tcGxldGVkV29yZHMiLCJzZXRDb21wbGV0ZWRXb3JkcyIsInNldENhdGVnb3J5SW5kZXgiLCJzZXRXb3JkSW5kZXgiLCJleGVyY2lzZXMiLCJpc0luaXRpYWxpemVkIiwiaGFuZGxlU3RvcmFnZUVycm9yIiwiZXJyb3IiLCJvcGVyYXRpb24iLCJmYWxsYmFjayIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsImNvbnNvbGUiLCJ3YXJuIiwidXNlRWZmZWN0IiwibG9hZERhdGEiLCJfcmVmMiIsIl9hc3luY1RvR2VuZXJhdG9yMiIsImRlZmF1bHQiLCJzYXZlZCIsIkFzeW5jU3RvcmFnZSIsImdldEl0ZW0iLCJfSlNPTiRwYXJzZSIsIkpTT04iLCJwYXJzZSIsInNhdmVkQ29tcGxldGVkIiwibGFzdFBvc2l0aW9uIiwiY2F0ZWdvcnlJbmRleCIsIndvcmRJbmRleCIsImFwcGx5Iiwic2F2ZURhdGEiLCJ1c2VDYWxsYmFjayIsImRhdGFUb1NhdmUiLCJzZXRJdGVtIiwic3RyaW5naWZ5IiwiY3VycmVudCIsIm5ld0NvbXBsZXRlZFdvcmRzIiwiT2JqZWN0IiwiYXNzaWduIiwiZm9yRWFjaCIsIl8iLCJpbmRleCJdLCJzb3VyY2VzIjpbInVzZVZvY2FidWxhcnlTdG9yYWdlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9zY3JlZW5zL2V4ZXJjaXNlcy92b2NhYnVsYXJ5L2hvb2tzL2ludGVybmFsL3VzZVZvY2FidWxhcnlTdG9yYWdlLmpzIC0gVkVSU0lPTiBDT1JSSUfDiUVcclxuXHJcbmltcG9ydCB7IHVzZUVmZmVjdCwgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCBBc3luY1N0b3JhZ2UgZnJvbSAnQHJlYWN0LW5hdGl2ZS1hc3luYy1zdG9yYWdlL2FzeW5jLXN0b3JhZ2UnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gdXNlVm9jYWJ1bGFyeVN0b3JhZ2Uoe1xyXG4gIFNUT1JBR0VfS0VZLFxyXG4gIHByb2dyZXNzS2V5LFxyXG4gIGxvYWRlZCxcclxuICBzZXRMb2FkZWQsXHJcbiAgY29tcGxldGVkV29yZHMsXHJcbiAgc2V0Q29tcGxldGVkV29yZHMsXHJcbiAgc2V0Q2F0ZWdvcnlJbmRleCxcclxuICBzZXRXb3JkSW5kZXgsXHJcbiAgZXhlcmNpc2VzLFxyXG4gIGlzSW5pdGlhbGl6ZWQsXHJcbn0pIHtcclxuICAvLyA9PT09PT09PT09PT09PT09PT09IEVSUk9SIEhBTkRMSU5HIEhFTFBFUiA9PT09PT09PT09PT09PT09PT09XHJcbiAgY29uc3QgaGFuZGxlU3RvcmFnZUVycm9yID0gKGVycm9yLCBvcGVyYXRpb24sIGZhbGxiYWNrID0gbnVsbCkgPT4ge1xyXG4gICAgY29uc29sZS53YXJuKGBWb2NhYnVsYXJ5IHN0b3JhZ2UgZXJyb3IgaW4gJHtvcGVyYXRpb259OmAsIGVycm9yKTtcclxuICAgIHJldHVybiBmYWxsYmFjaztcclxuICB9O1xyXG5cclxuICAvLyBMb2FkIGRhdGEgZnJvbSBzdG9yYWdlXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGNvbnN0IGxvYWREYXRhID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHNhdmVkID0gYXdhaXQgQXN5bmNTdG9yYWdlLmdldEl0ZW0oU1RPUkFHRV9LRVkpO1xyXG4gICAgICAgIGlmIChzYXZlZCkge1xyXG4gICAgICAgICAgY29uc3QgeyBjb21wbGV0ZWRXb3Jkczogc2F2ZWRDb21wbGV0ZWQsIGxhc3RQb3NpdGlvbiB9ID0gSlNPTi5wYXJzZShzYXZlZCk7XHJcbiAgICAgICAgICBzZXRDb21wbGV0ZWRXb3JkcyhzYXZlZENvbXBsZXRlZCB8fCB7fSk7XHJcbiAgICAgICAgICBpZiAobGFzdFBvc2l0aW9uKSB7XHJcbiAgICAgICAgICAgIHNldENhdGVnb3J5SW5kZXgobGFzdFBvc2l0aW9uLmNhdGVnb3J5SW5kZXggfHwgMCk7XHJcbiAgICAgICAgICAgIHNldFdvcmRJbmRleChsYXN0UG9zaXRpb24ud29yZEluZGV4IHx8IDApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAvLyDinIUgR2VzdGlvbiBkJ2VycmV1ciBhcHByb3ByacOpZVxyXG4gICAgICAgIGhhbmRsZVN0b3JhZ2VFcnJvcihlcnJvciwgJ2xvYWREYXRhJyk7XHJcbiAgICAgICAgLy8gRmFsbGJhY2s6IHV0aWxpc2VyIGxlcyB2YWxldXJzIHBhciBkw6lmYXV0XHJcbiAgICAgIH0gZmluYWxseSB7XHJcbiAgICAgICAgc2V0TG9hZGVkKHRydWUpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgbG9hZERhdGEoKTtcclxuICB9LCBbcHJvZ3Jlc3NLZXksIFNUT1JBR0VfS0VZLCBzZXRDb21wbGV0ZWRXb3Jkcywgc2V0Q2F0ZWdvcnlJbmRleCwgc2V0V29yZEluZGV4LCBzZXRMb2FkZWRdKTtcclxuXHJcbiAgLy8gU2F2ZSBkYXRhIHRvIHN0b3JhZ2VcclxuICBjb25zdCBzYXZlRGF0YSA9IHVzZUNhbGxiYWNrKGFzeW5jICgpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGRhdGFUb1NhdmUgPSB7XHJcbiAgICAgICAgY29tcGxldGVkV29yZHMsXHJcbiAgICAgICAgbGFzdFBvc2l0aW9uOiB7IGNhdGVnb3J5SW5kZXg6IDAsIHdvcmRJbmRleDogMCB9LFxyXG4gICAgICB9O1xyXG4gICAgICBhd2FpdCBBc3luY1N0b3JhZ2Uuc2V0SXRlbShTVE9SQUdFX0tFWSwgSlNPTi5zdHJpbmdpZnkoZGF0YVRvU2F2ZSkpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgLy8g4pyFIEdlc3Rpb24gZCdlcnJldXIgYXBwcm9wcmnDqWVcclxuICAgICAgaGFuZGxlU3RvcmFnZUVycm9yKGVycm9yLCAnc2F2ZURhdGEnKTtcclxuICAgICAgLy8gRmFsbGJhY2s6IGNvbnRpbnVlciBzYW5zIHNhdXZlZ2FyZGVcclxuICAgIH1cclxuICB9LCBbY29tcGxldGVkV29yZHMsIFNUT1JBR0VfS0VZXSk7XHJcblxyXG4gIC8vIEF1dG8tc2F2ZSB3aGVuIGRhdGEgY2hhbmdlc1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAobG9hZGVkKSBzYXZlRGF0YSgpO1xyXG4gIH0sIFtzYXZlRGF0YSwgbG9hZGVkXSk7XHJcblxyXG4gIC8vIEluaXRpYWxpemUgcHJvZ3Jlc3MgZm9yIG5ldyBjYXRlZ29yaWVzXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChsb2FkZWQgJiYgZXhlcmNpc2VzICYmICFpc0luaXRpYWxpemVkLmN1cnJlbnQpIHtcclxuICAgICAgY29uc3QgbmV3Q29tcGxldGVkV29yZHMgPSB7IC4uLmNvbXBsZXRlZFdvcmRzIH07XHJcbiAgICAgIGV4ZXJjaXNlcy5mb3JFYWNoKChfLCBpbmRleCkgPT4ge1xyXG4gICAgICAgIGlmICghbmV3Q29tcGxldGVkV29yZHNbaW5kZXhdKSBuZXdDb21wbGV0ZWRXb3Jkc1tpbmRleF0gPSBbXTtcclxuICAgICAgfSk7XHJcbiAgICAgIHNldENvbXBsZXRlZFdvcmRzKG5ld0NvbXBsZXRlZFdvcmRzKTtcclxuICAgICAgaXNJbml0aWFsaXplZC5jdXJyZW50ID0gdHJ1ZTtcclxuICAgIH1cclxuICB9LCBbbG9hZGVkLCBleGVyY2lzZXMsIGNvbXBsZXRlZFdvcmRzLCBzZXRDb21wbGV0ZWRXb3JkcywgaXNJbml0aWFsaXplZF0pO1xyXG5cclxuICByZXR1cm4geyBzYXZlRGF0YSB9O1xyXG59XHJcblxyXG5cclxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFFQSxJQUFBQSxNQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFB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