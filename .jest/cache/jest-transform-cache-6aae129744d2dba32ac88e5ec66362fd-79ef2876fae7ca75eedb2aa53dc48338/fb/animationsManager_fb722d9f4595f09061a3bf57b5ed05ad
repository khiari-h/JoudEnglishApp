a3196dfab39f8d5c9035b90df0b554a0
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.startWebLayoutAnimation = startWebLayoutAnimation;
exports.tryActivateLayoutTransition = tryActivateLayoutTransition;
var _config = require("./config");
var _commonTypes = require("../animationBuilder/commonTypes");
var _createAnimation = require("./createAnimation");
var _componentUtils = require("./componentUtils");
var _domUtils = require("./domUtils");
var _animationBuilder = require("../animationBuilder");
var _componentStyle = require("./componentStyle");
var _Easing = require("../../Easing");
var _logger = require("../../logger");
function chooseConfig(animationType, props) {
  var config = animationType === _commonTypes.LayoutAnimationType.ENTERING ? props.entering : animationType === _commonTypes.LayoutAnimationType.EXITING ? props.exiting : animationType === _commonTypes.LayoutAnimationType.LAYOUT ? props.layout : null;
  return config;
}
function checkUndefinedAnimationFail(initialAnimationName, needsCustomization) {
  if (initialAnimationName in _config.Animations || needsCustomization) {
    return false;
  }
  _logger.logger.warn("Couldn't load entering/exiting animation. Current version supports only predefined animations with modifiers: duration, delay, easing, randomizeDelay, withCallback, reducedMotion.");
  return true;
}
function maybeReportOverwrittenProperties(keyframe, styles) {
  var propertyRegex = /([a-zA-Z-]+)(?=:)/g;
  var animationProperties = new Set();
  for (var match of keyframe.matchAll(propertyRegex)) {
    animationProperties.add(match[1]);
  }
  var commonProperties = Array.from(styles).filter(function (style) {
    return animationProperties.has(style);
  });
  if (commonProperties.length === 0) {
    return;
  }
  _logger.logger.warn(`${commonProperties.length === 1 ? 'Property' : 'Properties'} [${commonProperties.join(', ')}] may be overwritten by a layout animation. Please wrap your component with an animated view and apply the layout animation on the wrapper.`);
}
function chooseAction(animationType, animationConfig, element, transitionData) {
  switch (animationType) {
    case _commonTypes.LayoutAnimationType.ENTERING:
      (0, _componentUtils.setElementAnimation)(element, animationConfig, true);
      break;
    case _commonTypes.LayoutAnimationType.LAYOUT:
      transitionData.reversed = animationConfig.reversed;
      (0, _componentUtils.handleLayoutTransition)(element, animationConfig, transitionData);
      break;
    case _commonTypes.LayoutAnimationType.EXITING:
      (0, _componentUtils.handleExitingAnimation)(element, animationConfig);
      break;
  }
}
function tryGetAnimationConfig(props, animationType) {
  var config = chooseConfig(animationType, props);
  if (!config) {
    return null;
  }
  var isLayoutTransition = animationType === _commonTypes.LayoutAnimationType.LAYOUT;
  var isCustomKeyframe = config instanceof _animationBuilder.Keyframe;
  var hasInitialValues = config.initialValues !== undefined;
  var animationName;
  if (isCustomKeyframe) {
    animationName = (0, _createAnimation.createCustomKeyFrameAnimation)(config.definitions);
  } else if (typeof config === 'function') {
    animationName = config.presetName;
  } else {
    animationName = config.constructor.presetName;
  }
  if (hasInitialValues) {
    animationName = (0, _createAnimation.createAnimationWithInitialValues)(animationName, config.initialValues);
  }
  var shouldFail = checkUndefinedAnimationFail(animationName, isLayoutTransition || isCustomKeyframe || hasInitialValues);
  if (shouldFail) {
    return null;
  }
  if (isCustomKeyframe) {
    var keyframeTimestamps = Object.keys(config.definitions);
    if (!(keyframeTimestamps.includes('100') || keyframeTimestamps.includes('to'))) {
      _logger.logger.warn(`Neither '100' nor 'to' was specified in Keyframe definition. This may result in wrong final position of your component. One possible solution is to duplicate last timestamp in definition as '100' (or 'to')`);
    }
  }
  var animationConfig = (0, _componentUtils.getProcessedConfig)(animationName, animationType, config);
  return animationConfig;
}
function startWebLayoutAnimation(props, element, animationType, transitionData) {
  var animationConfig = tryGetAnimationConfig(props, animationType);
  (0, _componentUtils.maybeModifyStyleForKeyframe)(element, props.entering);
  if ((animationConfig == null ? void 0 : animationConfig.animationName) in _config.Animations) {
    maybeReportOverwrittenProperties(_config.Animations[animationConfig == null ? void 0 : animationConfig.animationName].style, element.style);
  }
  if (animationConfig) {
    chooseAction(animationType, animationConfig, element, transitionData);
  } else {
    (0, _componentStyle.makeElementVisible)(element, 0);
  }
}
function tryActivateLayoutTransition(props, element, snapshot) {
  var _enteringV, _exitingV, _easingXV$EasingNameS, _easingXV, _easingYV$EasingNameS, _easingYV;
  if (!props.layout) {
    return;
  }
  var rect = element.getBoundingClientRect();
  if ((0, _domUtils.areDOMRectsEqual)(rect, snapshot)) {
    return;
  }
  var enteringAnimation = (_enteringV = props.layout.enteringV) == null ? void 0 : _enteringV.presetName;
  var exitingAnimation = (_exitingV = props.layout.exitingV) == null ? void 0 : _exitingV.presetName;
  var transitionData = {
    translateX: snapshot.x - rect.x,
    translateY: snapshot.y - rect.y,
    scaleX: snapshot.width / rect.width,
    scaleY: snapshot.height / rect.height,
    reversed: false,
    easingX: (_easingXV$EasingNameS = (_easingXV = props.layout.easingXV) == null ? void 0 : _easingXV[_Easing.EasingNameSymbol]) != null ? _easingXV$EasingNameS : 'ease',
    easingY: (_easingYV$EasingNameS = (_easingYV = props.layout.easingYV) == null ? void 0 : _easingYV[_Easing.EasingNameSymbol]) != null ? _easingYV$EasingNameS : 'ease',
    entering: enteringAnimation,
    exiting: exitingAnimation
  };
  startWebLayoutAnimation(props, element, _commonTypes.LayoutAnimationType.LAYOUT, transitionData);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsInN0YXJ0V2ViTGF5b3V0QW5pbWF0aW9uIiwidHJ5QWN0aXZhdGVMYXlvdXRUcmFuc2l0aW9uIiwiX2NvbmZpZyIsInJlcXVpcmUiLCJfY29tbW9uVHlwZXMiLCJfY3JlYXRlQW5pbWF0aW9uIiwiX2NvbXBvbmVudFV0aWxzIiwiX2RvbVV0aWxzIiwiX2FuaW1hdGlvbkJ1aWxkZXIiLCJfY29tcG9uZW50U3R5bGUiLCJfRWFzaW5nIiwiX2xvZ2dlciIsImNob29zZUNvbmZpZyIsImFuaW1hdGlvblR5cGUiLCJwcm9wcyIsImNvbmZpZyIsIkxheW91dEFuaW1hdGlvblR5cGUiLCJFTlRFUklORyIsImVudGVyaW5nIiwiRVhJVElORyIsImV4aXRpbmciLCJMQVlPVVQiLCJsYXlvdXQiLCJjaGVja1VuZGVmaW5lZEFuaW1hdGlvbkZhaWwiLCJpbml0aWFsQW5pbWF0aW9uTmFtZSIsIm5lZWRzQ3VzdG9taXphdGlvbiIsIkFuaW1hdGlvbnMiLCJsb2dnZXIiLCJ3YXJuIiwibWF5YmVSZXBvcnRPdmVyd3JpdHRlblByb3BlcnRpZXMiLCJrZXlmcmFtZSIsInN0eWxlcyIsInByb3BlcnR5UmVnZXgiLCJhbmltYXRpb25Qcm9wZXJ0aWVzIiwiU2V0IiwibWF0Y2giLCJtYXRjaEFsbCIsImFkZCIsImNvbW1vblByb3BlcnRpZXMiLCJBcnJheSIsImZyb20iLCJmaWx0ZXIiLCJzdHlsZSIsImhhcyIsImxlbmd0aCIsImpvaW4iLCJjaG9vc2VBY3Rpb24iLCJhbmltYXRpb25Db25maWciLCJlbGVtZW50IiwidHJhbnNpdGlvbkRhdGEiLCJzZXRFbGVtZW50QW5pbWF0aW9uIiwicmV2ZXJzZWQiLCJoYW5kbGVMYXlvdXRUcmFuc2l0aW9uIiwiaGFuZGxlRXhpdGluZ0FuaW1hdGlvbiIsInRyeUdldEFuaW1hdGlvbkNvbmZpZyIsImlzTGF5b3V0VHJhbnNpdGlvbiIsImlzQ3VzdG9tS2V5ZnJhbWUiLCJLZXlmcmFtZSIsImhhc0luaXRpYWxWYWx1ZXMiLCJpbml0aWFsVmFsdWVzIiwidW5kZWZpbmVkIiwiYW5pbWF0aW9uTmFtZSIsImNyZWF0ZUN1c3RvbUtleUZyYW1lQW5pbWF0aW9uIiwiZGVmaW5pdGlvbnMiLCJwcmVzZXROYW1lIiwiY29uc3RydWN0b3IiLCJjcmVhdGVBbmltYXRpb25XaXRoSW5pdGlhbFZhbHVlcyIsInNob3VsZEZhaWwiLCJrZXlmcmFtZVRpbWVzdGFtcHMiLCJrZXlzIiwiaW5jbHVkZXMiLCJnZXRQcm9jZXNzZWRDb25maWciLCJtYXliZU1vZGlmeVN0eWxlRm9yS2V5ZnJhbWUiLCJtYWtlRWxlbWVudFZpc2libGUiLCJzbmFwc2hvdCIsIl9lbnRlcmluZ1YiLCJfZXhpdGluZ1YiLCJfZWFzaW5nWFYkRWFzaW5nTmFtZVMiLCJfZWFzaW5nWFYiLCJfZWFzaW5nWVYkRWFzaW5nTmFtZVMiLCJfZWFzaW5nWVYiLCJyZWN0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwiYXJlRE9NUmVjdHNFcXVhbCIsImVudGVyaW5nQW5pbWF0aW9uIiwiZW50ZXJpbmdWIiwiZXhpdGluZ0FuaW1hdGlvbiIsImV4aXRpbmdWIiwidHJhbnNsYXRlWCIsIngiLCJ0cmFuc2xhdGVZIiwieSIsInNjYWxlWCIsIndpZHRoIiwic2NhbGVZIiwiaGVpZ2h0IiwiZWFzaW5nWCIsImVhc2luZ1hWIiwiRWFzaW5nTmFtZVN5bWJvbCIsImVhc2luZ1kiLCJlYXNpbmdZViJdLCJzb3VyY2VzIjpbImFuaW1hdGlvbnNNYW5hZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHR5cGUge1xuICBBbmltYXRpb25Db25maWcsXG4gIEFuaW1hdGlvbk5hbWVzLFxuICBDdXN0b21Db25maWcsXG4gIEluaXRpYWxWYWx1ZXNTdHlsZVByb3BzLFxuICBLZXlmcmFtZURlZmluaXRpb25zLFxufSBmcm9tICcuL2NvbmZpZyc7XG5pbXBvcnQgeyBBbmltYXRpb25zIH0gZnJvbSAnLi9jb25maWcnO1xuaW1wb3J0IHR5cGUge1xuICBBbmltYXRlZENvbXBvbmVudFByb3BzLFxuICBMYXlvdXRBbmltYXRpb25TdGF0aWNDb250ZXh0LFxufSBmcm9tICcuLi8uLi9jcmVhdGVBbmltYXRlZENvbXBvbmVudC9jb21tb25UeXBlcyc7XG5pbXBvcnQgeyBMYXlvdXRBbmltYXRpb25UeXBlIH0gZnJvbSAnLi4vYW5pbWF0aW9uQnVpbGRlci9jb21tb25UeXBlcyc7XG5pbXBvcnQge1xuICBjcmVhdGVBbmltYXRpb25XaXRoSW5pdGlhbFZhbHVlcyxcbiAgY3JlYXRlQ3VzdG9tS2V5RnJhbWVBbmltYXRpb24sXG59IGZyb20gJy4vY3JlYXRlQW5pbWF0aW9uJztcbmltcG9ydCB7XG4gIGdldFByb2Nlc3NlZENvbmZpZyxcbiAgaGFuZGxlRXhpdGluZ0FuaW1hdGlvbixcbiAgaGFuZGxlTGF5b3V0VHJhbnNpdGlvbixcbiAgbWF5YmVNb2RpZnlTdHlsZUZvcktleWZyYW1lLFxuICBzZXRFbGVtZW50QW5pbWF0aW9uLFxufSBmcm9tICcuL2NvbXBvbmVudFV0aWxzJztcbmltcG9ydCB7IGFyZURPTVJlY3RzRXF1YWwgfSBmcm9tICcuL2RvbVV0aWxzJztcbmltcG9ydCB0eXBlIHsgVHJhbnNpdGlvbkRhdGEgfSBmcm9tICcuL2FuaW1hdGlvblBhcnNlcic7XG5pbXBvcnQgeyBLZXlmcmFtZSB9IGZyb20gJy4uL2FuaW1hdGlvbkJ1aWxkZXInO1xuaW1wb3J0IHsgbWFrZUVsZW1lbnRWaXNpYmxlIH0gZnJvbSAnLi9jb21wb25lbnRTdHlsZSc7XG5pbXBvcnQgeyBFYXNpbmdOYW1lU3ltYm9sIH0gZnJvbSAnLi4vLi4vRWFzaW5nJztcbmltcG9ydCB0eXBlIHsgUmVhbmltYXRlZEhUTUxFbGVtZW50IH0gZnJvbSAnLi4vLi4vanMtcmVhbmltYXRlZCc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICcuLi8uLi9sb2dnZXInO1xuXG5mdW5jdGlvbiBjaG9vc2VDb25maWc8Q29tcG9uZW50UHJvcHMgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4oXG4gIGFuaW1hdGlvblR5cGU6IExheW91dEFuaW1hdGlvblR5cGUsXG4gIHByb3BzOiBSZWFkb25seTxBbmltYXRlZENvbXBvbmVudFByb3BzPENvbXBvbmVudFByb3BzPj5cbikge1xuICBjb25zdCBjb25maWcgPVxuICAgIGFuaW1hdGlvblR5cGUgPT09IExheW91dEFuaW1hdGlvblR5cGUuRU5URVJJTkdcbiAgICAgID8gcHJvcHMuZW50ZXJpbmdcbiAgICAgIDogYW5pbWF0aW9uVHlwZSA9PT0gTGF5b3V0QW5pbWF0aW9uVHlwZS5FWElUSU5HXG4gICAgICAgID8gcHJvcHMuZXhpdGluZ1xuICAgICAgICA6IGFuaW1hdGlvblR5cGUgPT09IExheW91dEFuaW1hdGlvblR5cGUuTEFZT1VUXG4gICAgICAgICAgPyBwcm9wcy5sYXlvdXRcbiAgICAgICAgICA6IG51bGw7XG5cbiAgcmV0dXJuIGNvbmZpZztcbn1cblxuZnVuY3Rpb24gY2hlY2tVbmRlZmluZWRBbmltYXRpb25GYWlsKFxuICBpbml0aWFsQW5pbWF0aW9uTmFtZTogc3RyaW5nLFxuICBuZWVkc0N1c3RvbWl6YXRpb246IGJvb2xlYW5cbikge1xuICAvLyBUaGlzIHByZXZlbnRzIGNyYXNoZXMgaWYgd2UgdHJ5IHRvIHNldCBhbmltYXRpb25zIHRoYXQgYXJlIG5vdCBkZWZpbmVkLlxuICAvLyBXZSBkb24ndCBjYXJlIGFib3V0IGxheW91dCB0cmFuc2l0aW9ucyBvciBjdXN0b20ga2V5ZnJhbWVzIHNpbmNlIHRoZXkncmUgY3JlYXRlZCBkeW5hbWljYWxseVxuICBpZiAoaW5pdGlhbEFuaW1hdGlvbk5hbWUgaW4gQW5pbWF0aW9ucyB8fCBuZWVkc0N1c3RvbWl6YXRpb24pIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBsb2dnZXIud2FybihcbiAgICBcIkNvdWxkbid0IGxvYWQgZW50ZXJpbmcvZXhpdGluZyBhbmltYXRpb24uIEN1cnJlbnQgdmVyc2lvbiBzdXBwb3J0cyBvbmx5IHByZWRlZmluZWQgYW5pbWF0aW9ucyB3aXRoIG1vZGlmaWVyczogZHVyYXRpb24sIGRlbGF5LCBlYXNpbmcsIHJhbmRvbWl6ZURlbGF5LCB3aXRoQ2FsbGJhY2ssIHJlZHVjZWRNb3Rpb24uXCJcbiAgKTtcblxuICByZXR1cm4gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gbWF5YmVSZXBvcnRPdmVyd3JpdHRlblByb3BlcnRpZXMoXG4gIGtleWZyYW1lOiBzdHJpbmcsXG4gIHN0eWxlczogQ1NTU3R5bGVEZWNsYXJhdGlvblxuKSB7XG4gIGNvbnN0IHByb3BlcnR5UmVnZXggPSAvKFthLXpBLVotXSspKD89OikvZztcbiAgY29uc3QgYW5pbWF0aW9uUHJvcGVydGllcyA9IG5ldyBTZXQoKTtcblxuICBmb3IgKGNvbnN0IG1hdGNoIG9mIGtleWZyYW1lLm1hdGNoQWxsKHByb3BlcnR5UmVnZXgpKSB7XG4gICAgYW5pbWF0aW9uUHJvcGVydGllcy5hZGQobWF0Y2hbMV0pO1xuICB9XG5cbiAgY29uc3QgY29tbW9uUHJvcGVydGllcyA9IEFycmF5LmZyb20oc3R5bGVzKS5maWx0ZXIoKHN0eWxlKSA9PlxuICAgIGFuaW1hdGlvblByb3BlcnRpZXMuaGFzKHN0eWxlKVxuICApO1xuXG4gIGlmIChjb21tb25Qcm9wZXJ0aWVzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxvZ2dlci53YXJuKFxuICAgIGAke1xuICAgICAgY29tbW9uUHJvcGVydGllcy5sZW5ndGggPT09IDEgPyAnUHJvcGVydHknIDogJ1Byb3BlcnRpZXMnXG4gICAgfSBbJHtjb21tb25Qcm9wZXJ0aWVzLmpvaW4oXG4gICAgICAnLCAnXG4gICAgKX1dIG1heSBiZSBvdmVyd3JpdHRlbiBieSBhIGxheW91dCBhbmltYXRpb24uIFBsZWFzZSB3cmFwIHlvdXIgY29tcG9uZW50IHdpdGggYW4gYW5pbWF0ZWQgdmlldyBhbmQgYXBwbHkgdGhlIGxheW91dCBhbmltYXRpb24gb24gdGhlIHdyYXBwZXIuYFxuICApO1xufVxuXG5mdW5jdGlvbiBjaG9vc2VBY3Rpb24oXG4gIGFuaW1hdGlvblR5cGU6IExheW91dEFuaW1hdGlvblR5cGUsXG4gIGFuaW1hdGlvbkNvbmZpZzogQW5pbWF0aW9uQ29uZmlnLFxuICBlbGVtZW50OiBSZWFuaW1hdGVkSFRNTEVsZW1lbnQsXG4gIHRyYW5zaXRpb25EYXRhOiBUcmFuc2l0aW9uRGF0YVxuKSB7XG4gIHN3aXRjaCAoYW5pbWF0aW9uVHlwZSkge1xuICAgIGNhc2UgTGF5b3V0QW5pbWF0aW9uVHlwZS5FTlRFUklORzpcbiAgICAgIHNldEVsZW1lbnRBbmltYXRpb24oZWxlbWVudCwgYW5pbWF0aW9uQ29uZmlnLCB0cnVlKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgTGF5b3V0QW5pbWF0aW9uVHlwZS5MQVlPVVQ6XG4gICAgICB0cmFuc2l0aW9uRGF0YS5yZXZlcnNlZCA9IGFuaW1hdGlvbkNvbmZpZy5yZXZlcnNlZDtcbiAgICAgIGhhbmRsZUxheW91dFRyYW5zaXRpb24oZWxlbWVudCwgYW5pbWF0aW9uQ29uZmlnLCB0cmFuc2l0aW9uRGF0YSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIExheW91dEFuaW1hdGlvblR5cGUuRVhJVElORzpcbiAgICAgIGhhbmRsZUV4aXRpbmdBbmltYXRpb24oZWxlbWVudCwgYW5pbWF0aW9uQ29uZmlnKTtcbiAgICAgIGJyZWFrO1xuICB9XG59XG5cbmZ1bmN0aW9uIHRyeUdldEFuaW1hdGlvbkNvbmZpZzxDb21wb25lbnRQcm9wcyBleHRlbmRzIFJlY29yZDxzdHJpbmcsIHVua25vd24+PihcbiAgcHJvcHM6IFJlYWRvbmx5PEFuaW1hdGVkQ29tcG9uZW50UHJvcHM8Q29tcG9uZW50UHJvcHM+PixcbiAgYW5pbWF0aW9uVHlwZTogTGF5b3V0QW5pbWF0aW9uVHlwZVxuKSB7XG4gIGNvbnN0IGNvbmZpZyA9IGNob29zZUNvbmZpZyhhbmltYXRpb25UeXBlLCBwcm9wcyk7XG4gIGlmICghY29uZmlnKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICB0eXBlIENvbnN0cnVjdG9yV2l0aFN0YXRpY0NvbnRleHQgPSBMYXlvdXRBbmltYXRpb25TdGF0aWNDb250ZXh0ICZcbiAgICB0eXBlb2YgY29uZmlnLmNvbnN0cnVjdG9yO1xuXG4gIGNvbnN0IGlzTGF5b3V0VHJhbnNpdGlvbiA9IGFuaW1hdGlvblR5cGUgPT09IExheW91dEFuaW1hdGlvblR5cGUuTEFZT1VUO1xuICBjb25zdCBpc0N1c3RvbUtleWZyYW1lID0gY29uZmlnIGluc3RhbmNlb2YgS2V5ZnJhbWU7XG4gIGNvbnN0IGhhc0luaXRpYWxWYWx1ZXMgPSAoY29uZmlnIGFzIEN1c3RvbUNvbmZpZykuaW5pdGlhbFZhbHVlcyAhPT0gdW5kZWZpbmVkO1xuXG4gIGxldCBhbmltYXRpb25OYW1lO1xuXG4gIGlmIChpc0N1c3RvbUtleWZyYW1lKSB7XG4gICAgYW5pbWF0aW9uTmFtZSA9IGNyZWF0ZUN1c3RvbUtleUZyYW1lQW5pbWF0aW9uKFxuICAgICAgKGNvbmZpZyBhcyBDdXN0b21Db25maWcpLmRlZmluaXRpb25zIGFzIEtleWZyYW1lRGVmaW5pdGlvbnNcbiAgICApO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBjb25maWcgPT09ICdmdW5jdGlvbicpIHtcbiAgICBhbmltYXRpb25OYW1lID0gY29uZmlnLnByZXNldE5hbWU7XG4gIH0gZWxzZSB7XG4gICAgYW5pbWF0aW9uTmFtZSA9IChjb25maWcuY29uc3RydWN0b3IgYXMgQ29uc3RydWN0b3JXaXRoU3RhdGljQ29udGV4dClcbiAgICAgIC5wcmVzZXROYW1lO1xuICB9XG5cbiAgaWYgKGhhc0luaXRpYWxWYWx1ZXMpIHtcbiAgICBhbmltYXRpb25OYW1lID0gY3JlYXRlQW5pbWF0aW9uV2l0aEluaXRpYWxWYWx1ZXMoXG4gICAgICBhbmltYXRpb25OYW1lLFxuICAgICAgKGNvbmZpZyBhcyBDdXN0b21Db25maWcpLmluaXRpYWxWYWx1ZXMgYXMgSW5pdGlhbFZhbHVlc1N0eWxlUHJvcHNcbiAgICApO1xuICB9XG5cbiAgY29uc3Qgc2hvdWxkRmFpbCA9IGNoZWNrVW5kZWZpbmVkQW5pbWF0aW9uRmFpbChcbiAgICBhbmltYXRpb25OYW1lLFxuICAgIGlzTGF5b3V0VHJhbnNpdGlvbiB8fCBpc0N1c3RvbUtleWZyYW1lIHx8IGhhc0luaXRpYWxWYWx1ZXNcbiAgKTtcblxuICBpZiAoc2hvdWxkRmFpbCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgaWYgKGlzQ3VzdG9tS2V5ZnJhbWUpIHtcbiAgICBjb25zdCBrZXlmcmFtZVRpbWVzdGFtcHMgPSBPYmplY3Qua2V5cyhcbiAgICAgIChjb25maWcgYXMgQ3VzdG9tQ29uZmlnKS5kZWZpbml0aW9ucyBhcyBLZXlmcmFtZURlZmluaXRpb25zXG4gICAgKTtcblxuICAgIGlmIChcbiAgICAgICEoa2V5ZnJhbWVUaW1lc3RhbXBzLmluY2x1ZGVzKCcxMDAnKSB8fCBrZXlmcmFtZVRpbWVzdGFtcHMuaW5jbHVkZXMoJ3RvJykpXG4gICAgKSB7XG4gICAgICBsb2dnZXIud2FybihcbiAgICAgICAgYE5laXRoZXIgJzEwMCcgbm9yICd0bycgd2FzIHNwZWNpZmllZCBpbiBLZXlmcmFtZSBkZWZpbml0aW9uLiBUaGlzIG1heSByZXN1bHQgaW4gd3JvbmcgZmluYWwgcG9zaXRpb24gb2YgeW91ciBjb21wb25lbnQuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiBpcyB0byBkdXBsaWNhdGUgbGFzdCB0aW1lc3RhbXAgaW4gZGVmaW5pdGlvbiBhcyAnMTAwJyAob3IgJ3RvJylgXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGFuaW1hdGlvbkNvbmZpZyA9IGdldFByb2Nlc3NlZENvbmZpZyhcbiAgICBhbmltYXRpb25OYW1lLFxuICAgIGFuaW1hdGlvblR5cGUsXG4gICAgY29uZmlnIGFzIEN1c3RvbUNvbmZpZ1xuICApO1xuXG4gIHJldHVybiBhbmltYXRpb25Db25maWc7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzdGFydFdlYkxheW91dEFuaW1hdGlvbjxcbiAgQ29tcG9uZW50UHJvcHMgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPixcbj4oXG4gIHByb3BzOiBSZWFkb25seTxBbmltYXRlZENvbXBvbmVudFByb3BzPENvbXBvbmVudFByb3BzPj4sXG4gIGVsZW1lbnQ6IFJlYW5pbWF0ZWRIVE1MRWxlbWVudCxcbiAgYW5pbWF0aW9uVHlwZTogTGF5b3V0QW5pbWF0aW9uVHlwZSxcbiAgdHJhbnNpdGlvbkRhdGE/OiBUcmFuc2l0aW9uRGF0YVxuKSB7XG4gIGNvbnN0IGFuaW1hdGlvbkNvbmZpZyA9IHRyeUdldEFuaW1hdGlvbkNvbmZpZyhwcm9wcywgYW5pbWF0aW9uVHlwZSk7XG5cbiAgbWF5YmVNb2RpZnlTdHlsZUZvcktleWZyYW1lKGVsZW1lbnQsIHByb3BzLmVudGVyaW5nIGFzIEN1c3RvbUNvbmZpZyk7XG5cbiAgaWYgKChhbmltYXRpb25Db25maWc/LmFuaW1hdGlvbk5hbWUgYXMgQW5pbWF0aW9uTmFtZXMpIGluIEFuaW1hdGlvbnMpIHtcbiAgICBtYXliZVJlcG9ydE92ZXJ3cml0dGVuUHJvcGVydGllcyhcbiAgICAgIEFuaW1hdGlvbnNbYW5pbWF0aW9uQ29uZmlnPy5hbmltYXRpb25OYW1lIGFzIEFuaW1hdGlvbk5hbWVzXS5zdHlsZSxcbiAgICAgIGVsZW1lbnQuc3R5bGVcbiAgICApO1xuICB9XG5cbiAgaWYgKGFuaW1hdGlvbkNvbmZpZykge1xuICAgIGNob29zZUFjdGlvbihcbiAgICAgIGFuaW1hdGlvblR5cGUsXG4gICAgICBhbmltYXRpb25Db25maWcsXG4gICAgICBlbGVtZW50LFxuICAgICAgdHJhbnNpdGlvbkRhdGEgYXMgVHJhbnNpdGlvbkRhdGFcbiAgICApO1xuICB9IGVsc2Uge1xuICAgIG1ha2VFbGVtZW50VmlzaWJsZShlbGVtZW50LCAwKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdHJ5QWN0aXZhdGVMYXlvdXRUcmFuc2l0aW9uPFxuICBDb21wb25lbnRQcm9wcyBleHRlbmRzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuPihcbiAgcHJvcHM6IFJlYWRvbmx5PEFuaW1hdGVkQ29tcG9uZW50UHJvcHM8Q29tcG9uZW50UHJvcHM+PixcbiAgZWxlbWVudDogUmVhbmltYXRlZEhUTUxFbGVtZW50LFxuICBzbmFwc2hvdDogRE9NUmVjdFxuKSB7XG4gIGlmICghcHJvcHMubGF5b3V0KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgcmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgaWYgKGFyZURPTVJlY3RzRXF1YWwocmVjdCwgc25hcHNob3QpKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgZW50ZXJpbmdBbmltYXRpb24gPSAocHJvcHMubGF5b3V0IGFzIEN1c3RvbUNvbmZpZykuZW50ZXJpbmdWXG4gICAgPy5wcmVzZXROYW1lO1xuICBjb25zdCBleGl0aW5nQW5pbWF0aW9uID0gKHByb3BzLmxheW91dCBhcyBDdXN0b21Db25maWcpLmV4aXRpbmdWPy5wcmVzZXROYW1lO1xuXG4gIGNvbnN0IHRyYW5zaXRpb25EYXRhOiBUcmFuc2l0aW9uRGF0YSA9IHtcbiAgICB0cmFuc2xhdGVYOiBzbmFwc2hvdC54IC0gcmVjdC54LFxuICAgIHRyYW5zbGF0ZVk6IHNuYXBzaG90LnkgLSByZWN0LnksXG4gICAgc2NhbGVYOiBzbmFwc2hvdC53aWR0aCAvIHJlY3Qud2lkdGgsXG4gICAgc2NhbGVZOiBzbmFwc2hvdC5oZWlnaHQgLyByZWN0LmhlaWdodCxcbiAgICByZXZlcnNlZDogZmFsc2UsIC8vIFRoaXMgZmllbGQgaXMgdXNlZCBvbmx5IGluIGBTZXF1ZW5jZWRUcmFuc2l0aW9uYCwgc28gYnkgZGVmYXVsdCBpdCB3aWxsIGJlIGZhbHNlXG4gICAgZWFzaW5nWDpcbiAgICAgIChwcm9wcy5sYXlvdXQgYXMgQ3VzdG9tQ29uZmlnKS5lYXNpbmdYVj8uW0Vhc2luZ05hbWVTeW1ib2xdID8/ICdlYXNlJyxcbiAgICBlYXNpbmdZOlxuICAgICAgKHByb3BzLmxheW91dCBhcyBDdXN0b21Db25maWcpLmVhc2luZ1lWPy5bRWFzaW5nTmFtZVN5bWJvbF0gPz8gJ2Vhc2UnLFxuICAgIGVudGVyaW5nOiBlbnRlcmluZ0FuaW1hdGlvbixcbiAgICBleGl0aW5nOiBleGl0aW5nQW5pbWF0aW9uLFxuICB9O1xuXG4gIHN0YXJ0V2ViTGF5b3V0QW5pbWF0aW9uKFxuICAgIHByb3BzLFxuICAgIGVsZW1lbnQsXG4gICAgTGF5b3V0QW5pbWF0aW9uVHlwZS5MQVlPVVQsXG4gICAgdHJhbnNpdGlvbkRhdGFcbiAgKTtcbn1cbiJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWTs7QUFBQ0EsTUFBQSxDQUFBQyxjQUFBLENBQUFDLE9BQUE7RUFBQUMsS0FBQTtBQUFBO0FBQUFELE9BQUEsQ0FBQUUsdUJBQUEsR0FBQUEsdUJBQUE7QUFBQUYsT0FBQSxDQUFBRywyQkFBQSxHQUFBQSwyQkFBQTtBQVNiLElBQUFDLE9BQUEsR0FBQUMsT0FBQTtBQUtBLElBQUFDLFlBQUEsR0FBQUQsT0FBQTtBQUNBLElBQUFFLGdCQUFBLEdBQUFGLE9BQUE7QUFJQSxJQUFBRyxlQUFBLEdBQUFILE9BQUE7QUFPQSxJQUFBSSxTQUFBLEdBQUFKLE9BQUE7QUFFQSxJQUFBSyxpQkFBQSxHQUFBTCxPQUFBO0FBQ0EsSUFBQU0sZUFBQSxHQUFBTixPQUFBO0FBQ0EsSUFBQU8sT0FBQSxHQUFBUCxPQUFBO0FBRUEsSUFBQVEsT0FBQSxHQUFBUixPQUFBO0FBRUEsU0FBU1MsWUFBWUEsQ0FDbkJDLGFBQWtDLEVBQ2xDQyxLQUF1RCxFQUN2RDtFQUNBLElBQU1DLE1BQU0sR0FDVkYsYUFBYSxLQUFLRyxnQ0FBbUIsQ0FBQ0MsUUFBUSxHQUMxQ0gsS0FBSyxDQUFDSSxRQUFRLEdBQ2RMLGFBQWEsS0FBS0csZ0NBQW1CLENBQUNHLE9BQU8sR0FDM0NMLEtBQUssQ0FBQ00sT0FBTyxHQUNiUCxhQUFhLEtBQUtHLGdDQUFtQixDQUFDSyxNQUFNLEdBQzFDUCxLQUFLLENBQUNRLE1BQU0sR0FDWixJQUFJO0VBRWQsT0FBT1AsTUFBTTtBQUNmO0FBRUEsU0FBU1EsMkJBQTJCQSxDQUNsQ0Msb0JBQTRCLEVBQzVCQyxrQkFBMkIsRUFDM0I7RUFHQSxJQUFJRCxvQkFBb0IsSUFBSUUsa0JBQVUsSUFBSUQsa0JBQWtCLEVBQUU7SUFDNUQsT0FBTyxLQUFLO0VBQ2Q7RUFFQUUsY0FBTSxDQUFDQyxJQUFJLENBQ1QscUxBQ0YsQ0FBQztFQUVELE9BQU8sSUFBSTtBQUNiO0FBRUEsU0FBU0MsZ0NBQWdDQSxDQUN2Q0MsUUFBZ0IsRUFDaEJDLE1BQTJCLEVBQzNCO0VBQ0EsSUFBTUMsYUFBYSxHQUFHLG9CQUFvQjtFQUMxQyxJQUFNQyxtQkFBbUIsR0FBRyxJQUFJQyxHQUFHLENBQUMsQ0FBQztFQUVyQyxLQUFLLElBQU1DLEtBQUssSUFBSUwsUUFBUSxDQUFDTSxRQUFRLENBQUNKLGFBQWEsQ0FBQyxFQUFFO0lBQ3BEQyxtQkFBbUIsQ0FBQ0ksR0FBRyxDQUFDRixLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7RUFDbkM7RUFFQSxJQUFNRyxnQkFBZ0IsR0FBR0MsS0FBSyxDQUFDQyxJQUFJLENBQUNULE1BQU0sQ0FBQyxDQUFDVSxNQUFNLENBQUMsVUFBQ0MsS0FBSztJQUFBLE9BQ3ZEVCxtQkFBbUIsQ0FBQ1UsR0FBRyxDQUFDRCxLQUFLLENBQUM7RUFBQSxDQUNoQyxDQUFDO0VBRUQsSUFBSUosZ0JBQWdCLENBQUNNLE1BQU0sS0FBSyxDQUFDLEVBQUU7SUFDakM7RUFDRjtFQUVBakIsY0FBTSxDQUFDQyxJQUFJLENBQ1QsR0FDRVUsZ0JBQWdCLENBQUNNLE1BQU0sS0FBSyxDQUFDLEdBQUcsVUFBVSxHQUFHLFlBQVksS0FDdEROLGdCQUFnQixDQUFDTyxJQUFJLENBQ3hCLElBQ0YsQ0FBQyw2SUFDSCxDQUFDO0FBQ0g7QUFFQSxTQUFTQyxZQUFZQSxDQUNuQmpDLGFBQWtDLEVBQ2xDa0MsZUFBZ0MsRUFDaENDLE9BQThCLEVBQzlCQyxjQUE4QixFQUM5QjtFQUNBLFFBQVFwQyxhQUFhO0lBQ25CLEtBQUtHLGdDQUFtQixDQUFDQyxRQUFRO01BQy9CLElBQUFpQyxtQ0FBbUIsRUFBQ0YsT0FBTyxFQUFFRCxlQUFlLEVBQUUsSUFBSSxDQUFDO01BQ25EO0lBQ0YsS0FBSy9CLGdDQUFtQixDQUFDSyxNQUFNO01BQzdCNEIsY0FBYyxDQUFDRSxRQUFRLEdBQUdKLGVBQWUsQ0FBQ0ksUUFBUTtNQUNsRCxJQUFBQyxzQ0FBc0IsRUFBQ0osT0FBTyxFQUFFRCxlQUFlLEVBQUVFLGNBQWMsQ0FBQztNQUNoRTtJQUNGLEtBQUtqQyxnQ0FBbUIsQ0FBQ0csT0FBTztNQUM5QixJQUFBa0Msc0NBQXNCLEVBQUNMLE9BQU8sRUFBRUQsZUFBZSxDQUFDO01BQ2hEO0VBQ0o7QUFDRjtBQUVBLFNBQVNPLHFCQUFxQkEsQ0FDNUJ4QyxLQUF1RCxFQUN2REQsYUFBa0MsRUFDbEM7RUFDQSxJQUFNRSxNQUFNLEdBQUdILFlBQVksQ0FBQ0MsYUFBYSxFQUFFQyxLQUFLLENBQUM7RUFDakQsSUFBSSxDQUFDQyxNQUFNLEVBQUU7SUFDWCxPQUFPLElBQUk7RUFDYjtFQUtBLElBQU13QyxrQkFBa0IsR0FBRzFDLGFBQWEsS0FBS0csZ0NBQW1CLENBQUNLLE1BQU07RUFDdkUsSUFBTW1DLGdCQUFnQixHQUFHekMsTUFBTSxZQUFZMEMsMEJBQVE7RUFDbkQsSUFBTUMsZ0JBQWdCLEdBQUkzQyxNQUFNLENBQWtCNEMsYUFBYSxLQUFLQyxTQUFTO0VBRTdFLElBQUlDLGFBQWE7RUFFakIsSUFBSUwsZ0JBQWdCLEVBQUU7SUFDcEJLLGFBQWEsR0FBRyxJQUFBQyw4Q0FBNkIsRUFDMUMvQyxNQUFNLENBQWtCZ0QsV0FDM0IsQ0FBQztFQUNILENBQUMsTUFBTSxJQUFJLE9BQU9oRCxNQUFNLEtBQUssVUFBVSxFQUFFO0lBQ3ZDOEMsYUFBYSxHQUFHOUMsTUFBTSxDQUFDaUQsVUFBVTtFQUNuQyxDQUFDLE1BQU07SUFDTEgsYUFBYSxHQUFJOUMsTUFBTSxDQUFDa0QsV0FBVyxDQUNoQ0QsVUFBVTtFQUNmO0VBRUEsSUFBSU4sZ0JBQWdCLEVBQUU7SUFDcEJHLGFBQWEsR0FBRyxJQUFBSyxpREFBZ0MsRUFDOUNMLGFBQWEsRUFDWjlDLE1BQU0sQ0FBa0I0QyxhQUMzQixDQUFDO0VBQ0g7RUFFQSxJQUFNUSxVQUFVLEdBQUc1QywyQkFBMkIsQ0FDNUNzQyxhQUFhLEVBQ2JOLGtCQUFrQixJQUFJQyxnQkFBZ0IsSUFBSUUsZ0JBQzVDLENBQUM7RUFFRCxJQUFJUyxVQUFVLEVBQUU7SUFDZCxPQUFPLElBQUk7RUFDYjtFQUVBLElBQUlYLGdCQUFnQixFQUFFO0lBQ3BCLElBQU1ZLGtCQUFrQixHQUFHeEUsTUFBTSxDQUFDeUUsSUFBSSxDQUNuQ3RELE1BQU0sQ0FBa0JnRCxXQUMzQixDQUFDO0lBRUQsSUFDRSxFQUFFSyxrQkFBa0IsQ0FBQ0UsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJRixrQkFBa0IsQ0FBQ0UsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQzFFO01BQ0EzQyxjQUFNLENBQUNDLElBQUksQ0FDVCwrTUFDRixDQUFDO0lBQ0g7RUFDRjtFQUVBLElBQU1tQixlQUFlLEdBQUcsSUFBQXdCLGtDQUFrQixFQUN4Q1YsYUFBYSxFQUNiaEQsYUFBYSxFQUNiRSxNQUNGLENBQUM7RUFFRCxPQUFPZ0MsZUFBZTtBQUN4QjtBQUVPLFNBQVMvQyx1QkFBdUJBLENBR3JDYyxLQUF1RCxFQUN2RGtDLE9BQThCLEVBQzlCbkMsYUFBa0MsRUFDbENvQyxjQUErQixFQUMvQjtFQUNBLElBQU1GLGVBQWUsR0FBR08scUJBQXFCLENBQUN4QyxLQUFLLEVBQUVELGFBQWEsQ0FBQztFQUVuRSxJQUFBMkQsMkNBQTJCLEVBQUN4QixPQUFPLEVBQUVsQyxLQUFLLENBQUNJLFFBQXdCLENBQUM7RUFFcEUsSUFBSSxDQUFDNkIsZUFBZSxvQkFBZkEsZUFBZSxDQUFFYyxhQUFhLEtBQXVCbkMsa0JBQVUsRUFBRTtJQUNwRUcsZ0NBQWdDLENBQzlCSCxrQkFBVSxDQUFDcUIsZUFBZSxvQkFBZkEsZUFBZSxDQUFFYyxhQUFhLENBQW1CLENBQUNuQixLQUFLLEVBQ2xFTSxPQUFPLENBQUNOLEtBQ1YsQ0FBQztFQUNIO0VBRUEsSUFBSUssZUFBZSxFQUFFO0lBQ25CRCxZQUFZLENBQ1ZqQyxhQUFhLEVBQ2JrQyxlQUFlLEVBQ2ZDLE9BQU8sRUFDUEMsY0FDRixDQUFDO0VBQ0gsQ0FBQyxNQUFNO0lBQ0wsSUFBQXdCLGtDQUFrQixFQUFDekIsT0FBTyxFQUFFLENBQUMsQ0FBQztFQUNoQztBQUNGO0FBRU8sU0FBUy9DLDJCQUEyQkEsQ0FHekNhLEtBQXVELEVBQ3ZEa0MsT0FBOEIsRUFDOUIwQixRQUFpQixFQUNqQjtFQUFBLElBQUFDLFVBQUEsRUFBQUMsU0FBQSxFQUFBQyxxQkFBQSxFQUFBQyxTQUFBLEVBQUFDLHFCQUFBLEVBQUFDLFNBQUE7RUFDQSxJQUFJLENBQUNsRSxLQUFLLENBQUNRLE1BQU0sRUFBRTtJQUNqQjtFQUNGO0VBRUEsSUFBTTJELElBQUksR0FBR2pDLE9BQU8sQ0FBQ2tDLHFCQUFxQixDQUFDLENBQUM7RUFFNUMsSUFBSSxJQUFBQywwQkFBZ0IsRUFBQ0YsSUFBSSxFQUFFUCxRQUFRLENBQUMsRUFBRTtJQUNwQztFQUNGO0VBRUEsSUFBTVUsaUJBQWlCLElBQUFULFVBQUEsR0FBSTdELEtBQUssQ0FBQ1EsTUFBTSxDQUFrQitELFNBQVMscUJBQXhDVixVQUFBLENBQ3RCWCxVQUFVO0VBQ2QsSUFBTXNCLGdCQUFnQixJQUFBVixTQUFBLEdBQUk5RCxLQUFLLENBQUNRLE1BQU0sQ0FBa0JpRSxRQUFRLHFCQUF2Q1gsU0FBQSxDQUF5Q1osVUFBVTtFQUU1RSxJQUFNZixjQUE4QixHQUFHO0lBQ3JDdUMsVUFBVSxFQUFFZCxRQUFRLENBQUNlLENBQUMsR0FBR1IsSUFBSSxDQUFDUSxDQUFDO0lBQy9CQyxVQUFVLEVBQUVoQixRQUFRLENBQUNpQixDQUFDLEdBQUdWLElBQUksQ0FBQ1UsQ0FBQztJQUMvQkMsTUFBTSxFQUFFbEIsUUFBUSxDQUFDbUIsS0FBSyxHQUFHWixJQUFJLENBQUNZLEtBQUs7SUFDbkNDLE1BQU0sRUFBRXBCLFFBQVEsQ0FBQ3FCLE1BQU0sR0FBR2QsSUFBSSxDQUFDYyxNQUFNO0lBQ3JDNUMsUUFBUSxFQUFFLEtBQUs7SUFDZjZDLE9BQU8sR0FBQW5CLHFCQUFBLElBQUFDLFNBQUEsR0FDSmhFLEtBQUssQ0FBQ1EsTUFBTSxDQUFrQjJFLFFBQVEscUJBQXZDbkIsU0FBQSxDQUEwQ29CLHdCQUFnQixDQUFDLFlBQUFyQixxQkFBQSxHQUFJLE1BQU07SUFDdkVzQixPQUFPLEdBQUFwQixxQkFBQSxJQUFBQyxTQUFBLEdBQ0psRSxLQUFLLENBQUNRLE1BQU0sQ0FBa0I4RSxRQUFRLHFCQUF2Q3BCLFNBQUEsQ0FBMENrQix3QkFBZ0IsQ0FBQyxZQUFBbkIscUJBQUEsR0FBSSxNQUFNO0lBQ3ZFN0QsUUFBUSxFQUFFa0UsaUJBQWlCO0lBQzNCaEUsT0FBTyxFQUFFa0U7RUFDWCxDQUFDO0VBRUR0Rix1QkFBdUIsQ0FDckJjLEtBQUssRUFDTGtDLE9BQU8sRUFDUGhDLGdDQUFtQixDQUFDSyxNQUFNLEVBQzFCNEIsY0FDRixDQUFDO0FBQ0giLCJpZ25vcmVMaXN0IjpbXX0=