63e1f0751f85e15be395f4c53f71627e
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _classPrivateFieldLooseBase2 = _interopRequireDefault(require("@babel/runtime/helpers/classPrivateFieldLooseBase"));
var _classPrivateFieldLooseKey2 = _interopRequireDefault(require("@babel/runtime/helpers/classPrivateFieldLooseKey"));
var _NativeAnimatedHelper2 = _interopRequireDefault(require("../../../src/private/animated/NativeAnimatedHelper"));
var _invariant = _interopRequireDefault(require("invariant"));
var _NativeAnimatedHelper = _NativeAnimatedHelper2.default.API,
  startListeningToAnimatedNodeValue = _NativeAnimatedHelper.startListeningToAnimatedNodeValue,
  stopListeningToAnimatedNodeValue = _NativeAnimatedHelper.stopListeningToAnimatedNodeValue;
var _uniqueId = 1;
var _assertNativeAnimatedModule2 = function _assertNativeAnimatedModule() {
  _NativeAnimatedHelper2.default.assertNativeAnimatedModule();
  _assertNativeAnimatedModule2 = null;
};
var _listeners = (0, _classPrivateFieldLooseKey2.default)("listeners");
var AnimatedNode = exports.default = function () {
  function AnimatedNode() {
    (0, _classCallCheck2.default)(this, AnimatedNode);
    Object.defineProperty(this, _listeners, {
      writable: true,
      value: new Map()
    });
    this._platformConfig = undefined;
    this.__nativeAnimatedValueListener = null;
    this.__isNative = false;
    this.__nativeTag = undefined;
    this.__shouldUpdateListenersForNewNativeTag = false;
  }
  return (0, _createClass2.default)(AnimatedNode, [{
    key: "__attach",
    value: function __attach() {}
  }, {
    key: "__detach",
    value: function __detach() {
      this.removeAllListeners();
      if (this.__isNative && this.__nativeTag != null) {
        _NativeAnimatedHelper2.default.API.dropAnimatedNode(this.__nativeTag);
        this.__nativeTag = undefined;
      }
    }
  }, {
    key: "__getValue",
    value: function __getValue() {}
  }, {
    key: "__getAnimatedValue",
    value: function __getAnimatedValue() {
      return this.__getValue();
    }
  }, {
    key: "__addChild",
    value: function __addChild(child) {}
  }, {
    key: "__removeChild",
    value: function __removeChild(child) {}
  }, {
    key: "__getChildren",
    value: function __getChildren() {
      return [];
    }
  }, {
    key: "__makeNative",
    value: function __makeNative(platformConfig) {
      if (!this.__isNative) {
        throw new Error('This node cannot be made a "native" animated node');
      }
      this._platformConfig = platformConfig;
      if ((0, _classPrivateFieldLooseBase2.default)(this, _listeners)[_listeners].size > 0) {
        this._startListeningToNativeValueUpdates();
      }
    }
  }, {
    key: "addListener",
    value: function addListener(callback) {
      var id = String(_uniqueId++);
      (0, _classPrivateFieldLooseBase2.default)(this, _listeners)[_listeners].set(id, callback);
      if (this.__isNative) {
        this._startListeningToNativeValueUpdates();
      }
      return id;
    }
  }, {
    key: "removeListener",
    value: function removeListener(id) {
      (0, _classPrivateFieldLooseBase2.default)(this, _listeners)[_listeners].delete(id);
      if (this.__isNative && (0, _classPrivateFieldLooseBase2.default)(this, _listeners)[_listeners].size === 0) {
        this._stopListeningForNativeValueUpdates();
      }
    }
  }, {
    key: "removeAllListeners",
    value: function removeAllListeners() {
      (0, _classPrivateFieldLooseBase2.default)(this, _listeners)[_listeners].clear();
      if (this.__isNative) {
        this._stopListeningForNativeValueUpdates();
      }
    }
  }, {
    key: "hasListeners",
    value: function hasListeners() {
      return (0, _classPrivateFieldLooseBase2.default)(this, _listeners)[_listeners].size > 0;
    }
  }, {
    key: "_startListeningToNativeValueUpdates",
    value: function _startListeningToNativeValueUpdates() {
      var _this = this;
      if (this.__nativeAnimatedValueListener && !this.__shouldUpdateListenersForNewNativeTag) {
        return;
      }
      if (this.__shouldUpdateListenersForNewNativeTag) {
        this.__shouldUpdateListenersForNewNativeTag = false;
        this._stopListeningForNativeValueUpdates();
      }
      startListeningToAnimatedNodeValue(this.__getNativeTag());
      this.__nativeAnimatedValueListener = _NativeAnimatedHelper2.default.nativeEventEmitter.addListener('onAnimatedValueUpdate', function (data) {
        if (data.tag !== _this.__getNativeTag()) {
          return;
        }
        _this.__onAnimatedValueUpdateReceived(data.value);
      });
    }
  }, {
    key: "__onAnimatedValueUpdateReceived",
    value: function __onAnimatedValueUpdateReceived(value) {
      this.__callListeners(value);
    }
  }, {
    key: "__callListeners",
    value: function __callListeners(value) {
      var event = {
        value: value
      };
      (0, _classPrivateFieldLooseBase2.default)(this, _listeners)[_listeners].forEach(function (listener) {
        listener(event);
      });
    }
  }, {
    key: "_stopListeningForNativeValueUpdates",
    value: function _stopListeningForNativeValueUpdates() {
      if (!this.__nativeAnimatedValueListener) {
        return;
      }
      this.__nativeAnimatedValueListener.remove();
      this.__nativeAnimatedValueListener = null;
      stopListeningToAnimatedNodeValue(this.__getNativeTag());
    }
  }, {
    key: "__getNativeTag",
    value: function __getNativeTag() {
      var nativeTag = this.__nativeTag;
      if (nativeTag == null) {
        _assertNativeAnimatedModule2 == null || _assertNativeAnimatedModule2();
        (0, _invariant.default)(this.__isNative, 'Attempt to get native tag from node not marked as "native"');
        nativeTag = _NativeAnimatedHelper2.default.generateNewNodeTag();
        this.__nativeTag = nativeTag;
        var config = this.__getNativeConfig();
        if (this._platformConfig) {
          config.platformConfig = this._platformConfig;
        }
        _NativeAnimatedHelper2.default.API.createAnimatedNode(nativeTag, config);
        this.__shouldUpdateListenersForNewNativeTag = true;
      }
      return nativeTag;
    }
  }, {
    key: "__getNativeConfig",
    value: function __getNativeConfig() {
      throw new Error('This JS animated node type cannot be used as native animated node');
    }
  }, {
    key: "toJSON",
    value: function toJSON() {
      return this.__getValue();
    }
  }, {
    key: "__getPlatformConfig",
    value: function __getPlatformConfig() {
      return this._platformConfig;
    }
  }, {
    key: "__setPlatformConfig",
    value: function __setPlatformConfig(platformConfig) {
      this._platformConfig = platformConfig;
    }
  }]);
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiZGVmYXVsdCIsIl9jbGFzc0NhbGxDaGVjazIiLCJfY3JlYXRlQ2xhc3MyIiwiX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlMiIsIl9jbGFzc1ByaXZhdGVGaWVsZExvb3NlS2V5MiIsIl9OYXRpdmVBbmltYXRlZEhlbHBlcjIiLCJfaW52YXJpYW50IiwiX05hdGl2ZUFuaW1hdGVkSGVscGVyIiwiTmF0aXZlQW5pbWF0ZWRIZWxwZXIiLCJBUEkiLCJzdGFydExpc3RlbmluZ1RvQW5pbWF0ZWROb2RlVmFsdWUiLCJzdG9wTGlzdGVuaW5nVG9BbmltYXRlZE5vZGVWYWx1ZSIsIl91bmlxdWVJZCIsIl9hc3NlcnROYXRpdmVBbmltYXRlZE1vZHVsZSIsImFzc2VydE5hdGl2ZUFuaW1hdGVkTW9kdWxlIiwiX2xpc3RlbmVycyIsIkFuaW1hdGVkTm9kZSIsIndyaXRhYmxlIiwiTWFwIiwiX3BsYXRmb3JtQ29uZmlnIiwidW5kZWZpbmVkIiwiX19uYXRpdmVBbmltYXRlZFZhbHVlTGlzdGVuZXIiLCJfX2lzTmF0aXZlIiwiX19uYXRpdmVUYWciLCJfX3Nob3VsZFVwZGF0ZUxpc3RlbmVyc0Zvck5ld05hdGl2ZVRhZyIsImtleSIsIl9fYXR0YWNoIiwiX19kZXRhY2giLCJyZW1vdmVBbGxMaXN0ZW5lcnMiLCJkcm9wQW5pbWF0ZWROb2RlIiwiX19nZXRWYWx1ZSIsIl9fZ2V0QW5pbWF0ZWRWYWx1ZSIsIl9fYWRkQ2hpbGQiLCJjaGlsZCIsIl9fcmVtb3ZlQ2hpbGQiLCJfX2dldENoaWxkcmVuIiwiX19tYWtlTmF0aXZlIiwicGxhdGZvcm1Db25maWciLCJFcnJvciIsInNpemUiLCJfc3RhcnRMaXN0ZW5pbmdUb05hdGl2ZVZhbHVlVXBkYXRlcyIsImFkZExpc3RlbmVyIiwiY2FsbGJhY2siLCJpZCIsIlN0cmluZyIsInNldCIsInJlbW92ZUxpc3RlbmVyIiwiZGVsZXRlIiwiX3N0b3BMaXN0ZW5pbmdGb3JOYXRpdmVWYWx1ZVVwZGF0ZXMiLCJjbGVhciIsImhhc0xpc3RlbmVycyIsIl90aGlzIiwiX19nZXROYXRpdmVUYWciLCJuYXRpdmVFdmVudEVtaXR0ZXIiLCJkYXRhIiwidGFnIiwiX19vbkFuaW1hdGVkVmFsdWVVcGRhdGVSZWNlaXZlZCIsIl9fY2FsbExpc3RlbmVycyIsImV2ZW50IiwiZm9yRWFjaCIsImxpc3RlbmVyIiwicmVtb3ZlIiwibmF0aXZlVGFnIiwiaW52YXJpYW50IiwiZ2VuZXJhdGVOZXdOb2RlVGFnIiwiY29uZmlnIiwiX19nZXROYXRpdmVDb25maWciLCJjcmVhdGVBbmltYXRlZE5vZGUiLCJ0b0pTT04iLCJfX2dldFBsYXRmb3JtQ29uZmlnIiwiX19zZXRQbGF0Zm9ybUNvbmZpZyJdLCJzb3VyY2VzIjpbIkFuaW1hdGVkTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgTWV0YSBQbGF0Zm9ybXMsIEluYy4gYW5kIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB0eXBlIHtFdmVudFN1YnNjcmlwdGlvbn0gZnJvbSAnLi4vLi4vdmVuZG9yL2VtaXR0ZXIvRXZlbnRFbWl0dGVyJztcbmltcG9ydCB0eXBlIHtQbGF0Zm9ybUNvbmZpZ30gZnJvbSAnLi4vQW5pbWF0ZWRQbGF0Zm9ybUNvbmZpZyc7XG5cbmltcG9ydCBOYXRpdmVBbmltYXRlZEhlbHBlciBmcm9tICcuLi8uLi8uLi9zcmMvcHJpdmF0ZS9hbmltYXRlZC9OYXRpdmVBbmltYXRlZEhlbHBlcic7XG5pbXBvcnQgaW52YXJpYW50IGZyb20gJ2ludmFyaWFudCc7XG5cbmNvbnN0IHtzdGFydExpc3RlbmluZ1RvQW5pbWF0ZWROb2RlVmFsdWUsIHN0b3BMaXN0ZW5pbmdUb0FuaW1hdGVkTm9kZVZhbHVlfSA9XG4gIE5hdGl2ZUFuaW1hdGVkSGVscGVyLkFQSTtcblxudHlwZSBWYWx1ZUxpc3RlbmVyQ2FsbGJhY2sgPSAoc3RhdGU6IHt2YWx1ZTogbnVtYmVyLCAuLi59KSA9PiBtaXhlZDtcblxubGV0IF91bmlxdWVJZCA9IDE7XG5sZXQgX2Fzc2VydE5hdGl2ZUFuaW1hdGVkTW9kdWxlOiA/KCkgPT4gdm9pZCA9ICgpID0+IHtcbiAgTmF0aXZlQW5pbWF0ZWRIZWxwZXIuYXNzZXJ0TmF0aXZlQW5pbWF0ZWRNb2R1bGUoKTtcbiAgLy8gV2Ugb25seSBoYXZlIHRvIGFzc2VydCB0aGF0IHRoZSBtb2R1bGUgZXhpc3RzIG9uY2UuIEFmdGVyIHdlJ3ZlIGFzc2VydGVkXG4gIC8vIHRoaXMsIGNsZWFyIG91dCB0aGUgZnVuY3Rpb24gc28gd2Uga25vdyB0byBza2lwIGl0IGluIHRoZSBmdXR1cmUuXG4gIF9hc3NlcnROYXRpdmVBbmltYXRlZE1vZHVsZSA9IG51bGw7XG59O1xuXG4vLyBOb3RlKHZqZXV4KTogdGhpcyB3b3VsZCBiZSBiZXR0ZXIgYXMgYW4gaW50ZXJmYWNlIGJ1dCBmbG93IGRvZXNuJ3Rcbi8vIHN1cHBvcnQgdGhlbSB5ZXRcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFuaW1hdGVkTm9kZSB7XG4gICNsaXN0ZW5lcnM6IE1hcDxzdHJpbmcsIFZhbHVlTGlzdGVuZXJDYWxsYmFjaz4gPSBuZXcgTWFwKCk7XG4gIF9wbGF0Zm9ybUNvbmZpZzogP1BsYXRmb3JtQ29uZmlnID0gdW5kZWZpbmVkO1xuICBfX25hdGl2ZUFuaW1hdGVkVmFsdWVMaXN0ZW5lcjogP0V2ZW50U3Vic2NyaXB0aW9uID0gbnVsbDtcbiAgX19hdHRhY2goKTogdm9pZCB7fVxuICBfX2RldGFjaCgpOiB2b2lkIHtcbiAgICB0aGlzLnJlbW92ZUFsbExpc3RlbmVycygpO1xuICAgIGlmICh0aGlzLl9faXNOYXRpdmUgJiYgdGhpcy5fX25hdGl2ZVRhZyAhPSBudWxsKSB7XG4gICAgICBOYXRpdmVBbmltYXRlZEhlbHBlci5BUEkuZHJvcEFuaW1hdGVkTm9kZSh0aGlzLl9fbmF0aXZlVGFnKTtcbiAgICAgIHRoaXMuX19uYXRpdmVUYWcgPSB1bmRlZmluZWQ7XG4gICAgfVxuICB9XG4gIF9fZ2V0VmFsdWUoKTogYW55IHt9XG4gIF9fZ2V0QW5pbWF0ZWRWYWx1ZSgpOiBhbnkge1xuICAgIHJldHVybiB0aGlzLl9fZ2V0VmFsdWUoKTtcbiAgfVxuICBfX2FkZENoaWxkKGNoaWxkOiBBbmltYXRlZE5vZGUpIHt9XG4gIF9fcmVtb3ZlQ2hpbGQoY2hpbGQ6IEFuaW1hdGVkTm9kZSkge31cbiAgX19nZXRDaGlsZHJlbigpOiAkUmVhZE9ubHlBcnJheTxBbmltYXRlZE5vZGU+IHtcbiAgICByZXR1cm4gW107XG4gIH1cblxuICAvKiBNZXRob2RzIGFuZCBwcm9wcyB1c2VkIGJ5IG5hdGl2ZSBBbmltYXRlZCBpbXBsICovXG4gIF9faXNOYXRpdmU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgX19uYXRpdmVUYWc6ID9udW1iZXIgPSB1bmRlZmluZWQ7XG4gIF9fc2hvdWxkVXBkYXRlTGlzdGVuZXJzRm9yTmV3TmF0aXZlVGFnOiBib29sZWFuID0gZmFsc2U7XG5cbiAgX19tYWtlTmF0aXZlKHBsYXRmb3JtQ29uZmlnOiA/UGxhdGZvcm1Db25maWcpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuX19pc05hdGl2ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIG5vZGUgY2Fubm90IGJlIG1hZGUgYSBcIm5hdGl2ZVwiIGFuaW1hdGVkIG5vZGUnKTtcbiAgICB9XG5cbiAgICB0aGlzLl9wbGF0Zm9ybUNvbmZpZyA9IHBsYXRmb3JtQ29uZmlnO1xuICAgIGlmICh0aGlzLiNsaXN0ZW5lcnMuc2l6ZSA+IDApIHtcbiAgICAgIHRoaXMuX3N0YXJ0TGlzdGVuaW5nVG9OYXRpdmVWYWx1ZVVwZGF0ZXMoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQWRkcyBhbiBhc3luY2hyb25vdXMgbGlzdGVuZXIgdG8gdGhlIHZhbHVlIHNvIHlvdSBjYW4gb2JzZXJ2ZSB1cGRhdGVzIGZyb21cbiAgICogYW5pbWF0aW9ucy4gIFRoaXMgaXMgdXNlZnVsIGJlY2F1c2UgdGhlcmUgaXMgbm8gd2F5IHRvXG4gICAqIHN5bmNocm9ub3VzbHkgcmVhZCB0aGUgdmFsdWUgYmVjYXVzZSBpdCBtaWdodCBiZSBkcml2ZW4gbmF0aXZlbHkuXG4gICAqXG4gICAqIFNlZSBodHRwczovL3JlYWN0bmF0aXZlLmRldi9kb2NzL2FuaW1hdGVkdmFsdWUjYWRkbGlzdGVuZXJcbiAgICovXG4gIGFkZExpc3RlbmVyKGNhbGxiYWNrOiAodmFsdWU6IGFueSkgPT4gbWl4ZWQpOiBzdHJpbmcge1xuICAgIGNvbnN0IGlkID0gU3RyaW5nKF91bmlxdWVJZCsrKTtcbiAgICB0aGlzLiNsaXN0ZW5lcnMuc2V0KGlkLCBjYWxsYmFjayk7XG4gICAgaWYgKHRoaXMuX19pc05hdGl2ZSkge1xuICAgICAgdGhpcy5fc3RhcnRMaXN0ZW5pbmdUb05hdGl2ZVZhbHVlVXBkYXRlcygpO1xuICAgIH1cbiAgICByZXR1cm4gaWQ7XG4gIH1cblxuICAvKipcbiAgICogVW5yZWdpc3RlciBhIGxpc3RlbmVyLiBUaGUgYGlkYCBwYXJhbSBzaGFsbCBtYXRjaCB0aGUgaWRlbnRpZmllclxuICAgKiBwcmV2aW91c2x5IHJldHVybmVkIGJ5IGBhZGRMaXN0ZW5lcigpYC5cbiAgICpcbiAgICogU2VlIGh0dHBzOi8vcmVhY3RuYXRpdmUuZGV2L2RvY3MvYW5pbWF0ZWR2YWx1ZSNyZW1vdmVsaXN0ZW5lclxuICAgKi9cbiAgcmVtb3ZlTGlzdGVuZXIoaWQ6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuI2xpc3RlbmVycy5kZWxldGUoaWQpO1xuICAgIGlmICh0aGlzLl9faXNOYXRpdmUgJiYgdGhpcy4jbGlzdGVuZXJzLnNpemUgPT09IDApIHtcbiAgICAgIHRoaXMuX3N0b3BMaXN0ZW5pbmdGb3JOYXRpdmVWYWx1ZVVwZGF0ZXMoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIGFsbCByZWdpc3RlcmVkIGxpc3RlbmVycy5cbiAgICpcbiAgICogU2VlIGh0dHBzOi8vcmVhY3RuYXRpdmUuZGV2L2RvY3MvYW5pbWF0ZWR2YWx1ZSNyZW1vdmVhbGxsaXN0ZW5lcnNcbiAgICovXG4gIHJlbW92ZUFsbExpc3RlbmVycygpOiB2b2lkIHtcbiAgICB0aGlzLiNsaXN0ZW5lcnMuY2xlYXIoKTtcbiAgICBpZiAodGhpcy5fX2lzTmF0aXZlKSB7XG4gICAgICB0aGlzLl9zdG9wTGlzdGVuaW5nRm9yTmF0aXZlVmFsdWVVcGRhdGVzKCk7XG4gICAgfVxuICB9XG5cbiAgaGFzTGlzdGVuZXJzKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLiNsaXN0ZW5lcnMuc2l6ZSA+IDA7XG4gIH1cblxuICBfc3RhcnRMaXN0ZW5pbmdUb05hdGl2ZVZhbHVlVXBkYXRlcygpIHtcbiAgICBpZiAoXG4gICAgICB0aGlzLl9fbmF0aXZlQW5pbWF0ZWRWYWx1ZUxpc3RlbmVyICYmXG4gICAgICAhdGhpcy5fX3Nob3VsZFVwZGF0ZUxpc3RlbmVyc0Zvck5ld05hdGl2ZVRhZ1xuICAgICkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLl9fc2hvdWxkVXBkYXRlTGlzdGVuZXJzRm9yTmV3TmF0aXZlVGFnKSB7XG4gICAgICB0aGlzLl9fc2hvdWxkVXBkYXRlTGlzdGVuZXJzRm9yTmV3TmF0aXZlVGFnID0gZmFsc2U7XG4gICAgICB0aGlzLl9zdG9wTGlzdGVuaW5nRm9yTmF0aXZlVmFsdWVVcGRhdGVzKCk7XG4gICAgfVxuXG4gICAgc3RhcnRMaXN0ZW5pbmdUb0FuaW1hdGVkTm9kZVZhbHVlKHRoaXMuX19nZXROYXRpdmVUYWcoKSk7XG4gICAgdGhpcy5fX25hdGl2ZUFuaW1hdGVkVmFsdWVMaXN0ZW5lciA9XG4gICAgICBOYXRpdmVBbmltYXRlZEhlbHBlci5uYXRpdmVFdmVudEVtaXR0ZXIuYWRkTGlzdGVuZXIoXG4gICAgICAgICdvbkFuaW1hdGVkVmFsdWVVcGRhdGUnLFxuICAgICAgICBkYXRhID0+IHtcbiAgICAgICAgICBpZiAoZGF0YS50YWcgIT09IHRoaXMuX19nZXROYXRpdmVUYWcoKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLl9fb25BbmltYXRlZFZhbHVlVXBkYXRlUmVjZWl2ZWQoZGF0YS52YWx1ZSk7XG4gICAgICAgIH0sXG4gICAgICApO1xuICB9XG5cbiAgX19vbkFuaW1hdGVkVmFsdWVVcGRhdGVSZWNlaXZlZCh2YWx1ZTogbnVtYmVyKSB7XG4gICAgdGhpcy5fX2NhbGxMaXN0ZW5lcnModmFsdWUpO1xuICB9XG5cbiAgX19jYWxsTGlzdGVuZXJzKHZhbHVlOiBudW1iZXIpOiB2b2lkIHtcbiAgICBjb25zdCBldmVudCA9IHt2YWx1ZX07XG4gICAgdGhpcy4jbGlzdGVuZXJzLmZvckVhY2gobGlzdGVuZXIgPT4ge1xuICAgICAgbGlzdGVuZXIoZXZlbnQpO1xuICAgIH0pO1xuICB9XG5cbiAgX3N0b3BMaXN0ZW5pbmdGb3JOYXRpdmVWYWx1ZVVwZGF0ZXMoKSB7XG4gICAgaWYgKCF0aGlzLl9fbmF0aXZlQW5pbWF0ZWRWYWx1ZUxpc3RlbmVyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5fX25hdGl2ZUFuaW1hdGVkVmFsdWVMaXN0ZW5lci5yZW1vdmUoKTtcbiAgICB0aGlzLl9fbmF0aXZlQW5pbWF0ZWRWYWx1ZUxpc3RlbmVyID0gbnVsbDtcbiAgICBzdG9wTGlzdGVuaW5nVG9BbmltYXRlZE5vZGVWYWx1ZSh0aGlzLl9fZ2V0TmF0aXZlVGFnKCkpO1xuICB9XG5cbiAgX19nZXROYXRpdmVUYWcoKTogbnVtYmVyIHtcbiAgICBsZXQgbmF0aXZlVGFnID0gdGhpcy5fX25hdGl2ZVRhZztcbiAgICBpZiAobmF0aXZlVGFnID09IG51bGwpIHtcbiAgICAgIF9hc3NlcnROYXRpdmVBbmltYXRlZE1vZHVsZT8uKCk7XG5cbiAgICAgIC8vIGBfX2lzTmF0aXZlYCBpcyBpbml0aWFsaXplZCBhcyBmYWxzZSBhbmQgb25seSBldmVyIHNldCB0byB0cnVlLiBTbyB3ZVxuICAgICAgLy8gb25seSBuZWVkIHRvIGNoZWNrIGl0IG9uY2UgaGVyZSB3aGVuIGluaXRpYWxpemluZyBgX19uYXRpdmVUYWdgLlxuICAgICAgaW52YXJpYW50KFxuICAgICAgICB0aGlzLl9faXNOYXRpdmUsXG4gICAgICAgICdBdHRlbXB0IHRvIGdldCBuYXRpdmUgdGFnIGZyb20gbm9kZSBub3QgbWFya2VkIGFzIFwibmF0aXZlXCInLFxuICAgICAgKTtcblxuICAgICAgbmF0aXZlVGFnID0gTmF0aXZlQW5pbWF0ZWRIZWxwZXIuZ2VuZXJhdGVOZXdOb2RlVGFnKCk7XG4gICAgICB0aGlzLl9fbmF0aXZlVGFnID0gbmF0aXZlVGFnO1xuXG4gICAgICBjb25zdCBjb25maWcgPSB0aGlzLl9fZ2V0TmF0aXZlQ29uZmlnKCk7XG4gICAgICBpZiAodGhpcy5fcGxhdGZvcm1Db25maWcpIHtcbiAgICAgICAgY29uZmlnLnBsYXRmb3JtQ29uZmlnID0gdGhpcy5fcGxhdGZvcm1Db25maWc7XG4gICAgICB9XG4gICAgICBOYXRpdmVBbmltYXRlZEhlbHBlci5BUEkuY3JlYXRlQW5pbWF0ZWROb2RlKG5hdGl2ZVRhZywgY29uZmlnKTtcbiAgICAgIHRoaXMuX19zaG91bGRVcGRhdGVMaXN0ZW5lcnNGb3JOZXdOYXRpdmVUYWcgPSB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gbmF0aXZlVGFnO1xuICB9XG5cbiAgX19nZXROYXRpdmVDb25maWcoKTogT2JqZWN0IHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAnVGhpcyBKUyBhbmltYXRlZCBub2RlIHR5cGUgY2Fubm90IGJlIHVzZWQgYXMgbmF0aXZlIGFuaW1hdGVkIG5vZGUnLFxuICAgICk7XG4gIH1cblxuICB0b0pTT04oKTogYW55IHtcbiAgICByZXR1cm4gdGhpcy5fX2dldFZhbHVlKCk7XG4gIH1cblxuICBfX2dldFBsYXRmb3JtQ29uZmlnKCk6ID9QbGF0Zm9ybUNvbmZpZyB7XG4gICAgcmV0dXJuIHRoaXMuX3BsYXRmb3JtQ29uZmlnO1xuICB9XG5cbiAgX19zZXRQbGF0Zm9ybUNvbmZpZyhwbGF0Zm9ybUNvbmZpZzogP1BsYXRmb3JtQ29uZmlnKSB7XG4gICAgdGhpcy5fcGxhdGZvcm1Db25maWcgPSBwbGF0Zm9ybUNvbmZpZztcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiQUFVQSxZQUFZOztBQUFDLElBQUFBLHNCQUFBLEdBQUFDLE9BQUE7QUFBQUMsTUFBQSxDQUFBQyxjQUFBLENBQUFDLE9BQUE7RUFBQUMsS0FBQTtBQUFBO0FBQUFELE9BQUEsQ0FBQUUsT0FBQTtBQUFBLElBQUFDLGdCQUFBLEdBQUFQLHNCQUFBLENBQUFDLE9BQUE7QUFBQSxJQUFBTyxhQUFBLEdBQUFSLHNCQUFBLENBQUFDLE9BQUE7QUFBQSxJQUFBUSw0QkFBQSxHQUFBVCxzQkFBQSxDQUFBQyxPQUFBO0FBQUEsSUFBQVMsMkJBQUEsR0FBQVYsc0JBQUEsQ0FBQUMsT0FBQTtBQUtiLElBQUFVLHNCQUFBLEdBQUFYLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBVyxVQUFBLEdBQUFaLHNCQUFBLENBQUFDLE9BQUE7QUFFQSxJQUFBWSxxQkFBQSxHQUNFQyw4QkFBb0IsQ0FBQ0MsR0FBRztFQURuQkMsaUNBQWlDLEdBQUFILHFCQUFBLENBQWpDRyxpQ0FBaUM7RUFBRUMsZ0NBQWdDLEdBQUFKLHFCQUFBLENBQWhDSSxnQ0FBZ0M7QUFLMUUsSUFBSUMsU0FBUyxHQUFHLENBQUM7QUFDakIsSUFBSUMsNEJBQXdDLEdBQUcsU0FBM0NBLDJCQUF3Q0EsQ0FBQSxFQUFTO0VBQ25ETCw4QkFBb0IsQ0FBQ00sMEJBQTBCLENBQUMsQ0FBQztFQUdqREQsNEJBQTJCLEdBQUcsSUFBSTtBQUNw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