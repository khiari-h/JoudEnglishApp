0f6f23a0e8504a9a6790bbfb00ceea97
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useDashboardLevel = void 0;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _react = require("react");
var _asyncStorage = _interopRequireDefault(require("@react-native-async-storage/async-storage"));
var _constants = require("../../../utils/constants");
var ACTIVE_LEVEL_KEY = "user_active_level";
var mapOldToNewLevel = function mapOldToNewLevel(level) {
  var mapping = {
    A1: "1",
    A2: "2",
    B1: "3",
    B2: "4",
    C1: "5",
    C2: "6"
  };
  return mapping[level] || level;
};
var useDashboardLevel = exports.useDashboardLevel = function useDashboardLevel(_ref) {
  var _LANGUAGE_LEVELS$curr;
  var progressData = _ref.progress;
  var _useState = (0, _react.useState)("1"),
    _useState2 = (0, _slicedToArray2.default)(_useState, 2),
    currentLevel = _useState2[0],
    setCurrentLevel = _useState2[1];
  var _useState3 = (0, _react.useState)(false),
    _useState4 = (0, _slicedToArray2.default)(_useState3, 2),
    isLoaded = _useState4[0],
    setIsLoaded = _useState4[1];
  var _useState5 = (0, _react.useState)(null),
    _useState6 = (0, _slicedToArray2.default)(_useState5, 2),
    levelFoundInStorage = _useState6[0],
    setLevelFoundInStorage = _useState6[1];
  (0, _react.useEffect)(function () {
    var loadFromStorage = function () {
      var _ref2 = (0, _asyncToGenerator2.default)(function* () {
        try {
          var savedLevel = yield _asyncStorage.default.getItem(ACTIVE_LEVEL_KEY);
          if (savedLevel && _constants.LANGUAGE_LEVELS[savedLevel]) {
            setCurrentLevel(mapOldToNewLevel(savedLevel));
            setLevelFoundInStorage(true);
          } else {
            setLevelFoundInStorage(false);
          }
        } catch (error) {
          console.error('Erreur chargement niveau actif:', error);
          setLevelFoundInStorage(false);
        } finally {
          setIsLoaded(true);
        }
      });
      return function loadFromStorage() {
        return _ref2.apply(this, arguments);
      };
    }();
    loadFromStorage();
  }, []);
  (0, _react.useEffect)(function () {
    if (isLoaded && !levelFoundInStorage) {
      var levelFromProgress = progressData == null ? void 0 : progressData.currentLevel;
      if (levelFromProgress) {
        var mappedLevel = mapOldToNewLevel(levelFromProgress);
        if (_constants.LANGUAGE_LEVELS[mappedLevel]) {
          setCurrentLevel(mappedLevel);
        }
      }
    }
  }, [isLoaded, levelFoundInStorage, progressData]);
  var handleChangeActiveLevel = (0, _react.useCallback)(function () {
    var _ref3 = (0, _asyncToGenerator2.default)(function* (newLevel) {
      if (!_constants.LANGUAGE_LEVELS[newLevel]) return;
      setCurrentLevel(newLevel);
      try {
        yield _asyncStorage.default.setItem(ACTIVE_LEVEL_KEY, newLevel);
        setLevelFoundInStorage(true);
      } catch (error) {
        console.error('Erreur sauvegarde niveau actif:', error);
      }
    });
    return function (_x) {
      return _ref3.apply(this, arguments);
    };
  }(), []);
  var levelColor = ((_LANGUAGE_LEVELS$curr = _constants.LANGUAGE_LEVELS[currentLevel]) == null ? void 0 : _LANGUAGE_LEVELS$curr.color) || "#3B82F6";
  return {
    currentLevel: currentLevel,
    handleChangeActiveLevel: handleChangeActiveLevel,
    levelColor: levelColor,
    isLoaded: isLoaded
  };
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJyZXF1aXJlIiwiX2FzeW5jU3RvcmFnZSIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJfY29uc3RhbnRzIiwiQUNUSVZFX0xFVkVMX0tFWSIsIm1hcE9sZFRvTmV3TGV2ZWwiLCJsZXZlbCIsIm1hcHBpbmciLCJBMSIsIkEyIiwiQjEiLCJCMiIsIkMxIiwiQzIiLCJ1c2VEYXNoYm9hcmRMZXZlbCIsImV4cG9ydHMiLCJfcmVmIiwiX0xBTkdVQUdFX0xFVkVMUyRjdXJyIiwicHJvZ3Jlc3NEYXRhIiwicHJvZ3Jlc3MiLCJfdXNlU3RhdGUiLCJ1c2VTdGF0ZSIsIl91c2VTdGF0ZTIiLCJfc2xpY2VkVG9BcnJheTIiLCJkZWZhdWx0IiwiY3VycmVudExldmVsIiwic2V0Q3VycmVudExldmVsIiwiX3VzZVN0YXRlMyIsIl91c2VTdGF0ZTQiLCJpc0xvYWRlZCIsInNldElzTG9hZGVkIiwiX3VzZVN0YXRlNSIsIl91c2VTdGF0ZTYiLCJsZXZlbEZvdW5kSW5TdG9yYWdlIiwic2V0TGV2ZWxGb3VuZEluU3RvcmFnZSIsInVzZUVmZmVjdCIsImxvYWRGcm9tU3RvcmFnZSIsIl9yZWYyIiwiX2FzeW5jVG9HZW5lcmF0b3IyIiwic2F2ZWRMZXZlbCIsIkFzeW5jU3RvcmFnZSIsImdldEl0ZW0iLCJMQU5HVUFHRV9MRVZFTFMiLCJlcnJvciIsImNvbnNvbGUiLCJhcHBseSIsImFyZ3VtZW50cyIsImxldmVsRnJvbVByb2dyZXNzIiwibWFwcGVkTGV2ZWwiLCJoYW5kbGVDaGFuZ2VBY3RpdmVMZXZlbCIsInVzZUNhbGxiYWNrIiwiX3JlZjMiLCJuZXdMZXZlbCIsInNldEl0ZW0iLCJfeCIsImxldmVsQ29sb3IiLCJjb2xvciJdLCJzb3VyY2VzIjpbInVzZURhc2hib2FyZExldmVsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZUNhbGxiYWNrIH0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgQXN5bmNTdG9yYWdlIGZyb20gXCJAcmVhY3QtbmF0aXZlLWFzeW5jLXN0b3JhZ2UvYXN5bmMtc3RvcmFnZVwiO1xuaW1wb3J0IHsgTEFOR1VBR0VfTEVWRUxTIH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL2NvbnN0YW50c1wiO1xuXG5jb25zdCBBQ1RJVkVfTEVWRUxfS0VZID0gXCJ1c2VyX2FjdGl2ZV9sZXZlbFwiO1xuXG4vLyBGb25jdGlvbiBkZSBtYXBwaW5nIGRlcyBhbmNpZW5zIG5pdmVhdXggKHBldXQgw6p0cmUgc29ydGllIGR1IGhvb2sgc2kgbm9uIGR5bmFtaXF1ZSlcbmNvbnN0IG1hcE9sZFRvTmV3TGV2ZWwgPSAobGV2ZWwpID0+IHtcbiAgY29uc3QgbWFwcGluZyA9IHsgQTE6IFwiMVwiLCBBMjogXCIyXCIsIEIxOiBcIjNcIiwgQjI6IFwiNFwiLCBDMTogXCI1XCIsIEMyOiBcIjZcIiB9O1xuICByZXR1cm4gbWFwcGluZ1tsZXZlbF0gfHwgbGV2ZWw7XG59O1xuXG5leHBvcnQgY29uc3QgdXNlRGFzaGJvYXJkTGV2ZWwgPSAoeyBwcm9ncmVzczogcHJvZ3Jlc3NEYXRhIH0pID0+IHtcbiAgY29uc3QgW2N1cnJlbnRMZXZlbCwgc2V0Q3VycmVudExldmVsXSA9IHVzZVN0YXRlKFwiMVwiKTtcbiAgY29uc3QgW2lzTG9hZGVkLCBzZXRJc0xvYWRlZF0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIFxuICAvLyDDiXRhdCBwb3VyIHNhdm9pciBzaSB1bmUgdmFsZXVyIGEgw6l0w6kgY2hhcmfDqWUgZGVwdWlzIGxlIHN0b2NrYWdlLlxuICAvLyBudWxsID0gcGFzIGVuY29yZSB2w6lyaWZpw6ksIHRydWUgPSB0cm91dsOpZSwgZmFsc2UgPSBub24gdHJvdXbDqWUuXG4gIGNvbnN0IFtsZXZlbEZvdW5kSW5TdG9yYWdlLCBzZXRMZXZlbEZvdW5kSW5TdG9yYWdlXSA9IHVzZVN0YXRlKG51bGwpO1xuXG4gIC8vIEVmZmV0IG7CsDEgOiBDaGFyZ2VtZW50IGluaXRpYWwgZGVwdWlzIEFzeW5jU3RvcmFnZS5cbiAgLy8gTmUgcydleMOpY3V0ZSBxdSd1bmUgc2V1bGUgZm9pcyBhdSBtb250YWdlIGdyw6JjZSDDoCBgW11gLlxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IGxvYWRGcm9tU3RvcmFnZSA9IGFzeW5jICgpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHNhdmVkTGV2ZWwgPSBhd2FpdCBBc3luY1N0b3JhZ2UuZ2V0SXRlbShBQ1RJVkVfTEVWRUxfS0VZKTtcbiAgICAgICAgaWYgKHNhdmVkTGV2ZWwgJiYgTEFOR1VBR0VfTEVWRUxTW3NhdmVkTGV2ZWxdKSB7XG4gICAgICAgICAgc2V0Q3VycmVudExldmVsKG1hcE9sZFRvTmV3TGV2ZWwoc2F2ZWRMZXZlbCkpO1xuICAgICAgICAgIHNldExldmVsRm91bmRJblN0b3JhZ2UodHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2V0TGV2ZWxGb3VuZEluU3RvcmFnZShmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0VycmV1ciBjaGFyZ2VtZW50IG5pdmVhdSBhY3RpZjonLCBlcnJvcik7XG4gICAgICAgIHNldExldmVsRm91bmRJblN0b3JhZ2UoZmFsc2UpOyAvLyBFbiBjYXMgZCdlcnJldXIsIG9uIGNvbnNpZMOocmUgcXVlIHJpZW4gbidhIMOpdMOpIHRyb3V2w6lcbiAgICAgIH0gZmluYWxseSB7XG4gICAgICAgIHNldElzTG9hZGVkKHRydWUpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBsb2FkRnJvbVN0b3JhZ2UoKTtcbiAgfSwgW10pOyAvLyA8LS0gTGEgZMOpcGVuZGFuY2UgdmlkZSBlc3QgbGEgY2zDqVxuXG4gIC8vIEVmZmV0IG7CsDIgOiBTeW5jaHJvbmlzYXRpb24gYXZlYyBsZSBjb250ZXh0ZSBgcHJvZ3Jlc3NgLlxuICAvLyBTJ2V4w6ljdXRlIHNldWxlbWVudCBhcHLDqHMgbGUgY2hhcmdlbWVudCBFVCBzaSBhdWN1biBuaXZlYXUgbidhIMOpdMOpIHRyb3V2w6kgZW4gbcOpbW9pcmUuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgLy8gT24gbidhZ2l0IHF1ZSBzaSBsZSBjaGFyZ2VtZW50IGVzdCBmaW5pIGV0IHF1J2F1Y3VuIG5pdmVhdSBuJ2Egw6l0w6kgY2hhcmfDqSBkZXB1aXMgQXN5bmNTdG9yYWdlXG4gICAgaWYgKGlzTG9hZGVkICYmICFsZXZlbEZvdW5kSW5TdG9yYWdlKSB7XG4gICAgICBjb25zdCBsZXZlbEZyb21Qcm9ncmVzcyA9IHByb2dyZXNzRGF0YT8uY3VycmVudExldmVsO1xuICAgICAgaWYgKGxldmVsRnJvbVByb2dyZXNzKSB7XG4gICAgICAgIGNvbnN0IG1hcHBlZExldmVsID0gbWFwT2xkVG9OZXdMZXZlbChsZXZlbEZyb21Qcm9ncmVzcyk7XG4gICAgICAgIGlmIChMQU5HVUFHRV9MRVZFTFNbbWFwcGVkTGV2ZWxdKSB7XG4gICAgICAgICAgc2V0Q3VycmVudExldmVsKG1hcHBlZExldmVsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSwgW2lzTG9hZGVkLCBsZXZlbEZvdW5kSW5TdG9yYWdlLCBwcm9ncmVzc0RhdGFdKTtcblxuICAvLyBMZSByZXN0ZSBkdSBob29rIGVzdCBtw6ltb3Jpc8OpIGF2ZWMgdXNlQ2FsbGJhY2sgcG91ciBsYSBwZXJmb3JtYW5jZVxuICBjb25zdCBoYW5kbGVDaGFuZ2VBY3RpdmVMZXZlbCA9IHVzZUNhbGxiYWNrKGFzeW5jIChuZXdMZXZlbCkgPT4ge1xuICAgIGlmICghTEFOR1VBR0VfTEVWRUxTW25ld0xldmVsXSkgcmV0dXJuO1xuXG4gICAgc2V0Q3VycmVudExldmVsKG5ld0xldmVsKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgQXN5bmNTdG9yYWdlLnNldEl0ZW0oQUNUSVZFX0xFVkVMX0tFWSwgbmV3TGV2ZWwpO1xuICAgICAgLy8gU2kgbCd1dGlsaXNhdGV1ciBjaGFuZ2UgZGUgbml2ZWF1LCBvbiBjb25zaWTDqHJlIHF1ZSBsYSBzb3VyY2UgZGUgdsOpcml0w6kgZXN0IG1haW50ZW5hbnQgbGUgc3RvY2thZ2VcbiAgICAgIHNldExldmVsRm91bmRJblN0b3JhZ2UodHJ1ZSk7IFxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJldXIgc2F1dmVnYXJkZSBuaXZlYXUgYWN0aWY6JywgZXJyb3IpO1xuICAgIH1cbiAgfSwgW10pO1xuXG4gIGNvbnN0IGxldmVsQ29sb3IgPSBMQU5HVUFHRV9MRVZFTFNbY3VycmVudExldmVsXT8uY29sb3IgfHwgXCIjM0I4MkY2XCI7XG5cbiAgcmV0dXJuIHtcbiAgICBjdXJyZW50TGV2ZWwsXG4gICAgaGFuZGxlQ2hhbmdlQWN0aXZlTGV2ZWwsXG4gICAgbGV2ZWxDb2xvcixcbiAgICBpc0xvYWRlZCxcbiAgfTtcbn07Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUEsSUFBQUEsTUFBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsYUFBQSxHQUFBQyxzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQUcsVUFBQSxHQUFBSCxPQUFBO0FBRUEsSUFBTUksZ0JBQWdCLEdBQUcsbUJBQW1CO0FBRzVDLElBQU1DLGdCQUFnQixHQUFHLFNBQW5CQSxnQkFBZ0JBLENBQUlDLEtBQUssRUFBSztFQUNsQyxJQUFNQyxPQUFPLEdBQUc7SUFBRUMsRUFBRSxFQUFFLEdBQUc7SUFBRUMsRUFBRSxFQUFFLEdBQUc7SUFBRUMsRUFBRSxFQUFFLEdBQUc7SUFBRUMsRUFBRSxFQUFFLEdBQUc7SUFBRUMsRUFBRSxFQUFFLEdBQUc7SUFBRUMsRUFBRSxFQUFFO0VBQUksQ0FBQztFQUN4RSxPQUFPTixPQUFPLENBQUNELEtBQUssQ0FBQyxJQUFJQSxLQUFLO0FBQ2hDLENBQUM7QUFFTSxJQUFNUSxpQkFBaUIsR0FBQUMsT0FBQSxDQUFBRCxpQkFBQSxHQUFHLFNBQXBCQSxpQkFBaUJBLENBQUFFLElBQUEsRUFBbUM7RUFBQSxJQUFBQyxxQkFBQTtFQUFBLElBQW5CQyxZQUFZLEdBQUFGLElB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