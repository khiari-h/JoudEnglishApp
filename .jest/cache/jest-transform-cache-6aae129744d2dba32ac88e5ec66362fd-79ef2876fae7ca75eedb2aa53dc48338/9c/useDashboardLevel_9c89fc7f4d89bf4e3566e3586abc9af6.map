{"version":3,"names":["_react","require","_asyncStorage","_interopRequireDefault","_constants","ACTIVE_LEVEL_KEY","mapOldToNewLevel","level","mapping","A1","A2","B1","B2","C1","C2","useDashboardLevel","exports","_ref","_LANGUAGE_LEVELS$curr","progressData","progress","_useState","useState","_useState2","_slicedToArray2","default","currentLevel","setCurrentLevel","_useState3","_useState4","isLoaded","setIsLoaded","_useState5","_useState6","levelFoundInStorage","setLevelFoundInStorage","useEffect","loadFromStorage","_ref2","_asyncToGenerator2","savedLevel","AsyncStorage","getItem","LANGUAGE_LEVELS","error","console","apply","arguments","levelFromProgress","mappedLevel","handleChangeActiveLevel","useCallback","_ref3","newLevel","setItem","_x","levelColor","color"],"sources":["useDashboardLevel.js"],"sourcesContent":["import { useState, useEffect, useCallback } from \"react\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport { LANGUAGE_LEVELS } from \"../../../utils/constants\";\n\nconst ACTIVE_LEVEL_KEY = \"user_active_level\";\n\n// Fonction de mapping des anciens niveaux (peut être sortie du hook si non dynamique)\nconst mapOldToNewLevel = (level) => {\n  const mapping = { A1: \"1\", A2: \"2\", B1: \"3\", B2: \"4\", C1: \"5\", C2: \"6\" };\n  return mapping[level] || level;\n};\n\nexport const useDashboardLevel = ({ progress: progressData }) => {\n  const [currentLevel, setCurrentLevel] = useState(\"1\");\n  const [isLoaded, setIsLoaded] = useState(false);\n  \n  // État pour savoir si une valeur a été chargée depuis le stockage.\n  // null = pas encore vérifié, true = trouvée, false = non trouvée.\n  const [levelFoundInStorage, setLevelFoundInStorage] = useState(null);\n\n  // Effet n°1 : Chargement initial depuis AsyncStorage.\n  // Ne s'exécute qu'une seule fois au montage grâce à `[]`.\n  useEffect(() => {\n    const loadFromStorage = async () => {\n      try {\n        const savedLevel = await AsyncStorage.getItem(ACTIVE_LEVEL_KEY);\n        if (savedLevel && LANGUAGE_LEVELS[savedLevel]) {\n          setCurrentLevel(mapOldToNewLevel(savedLevel));\n          setLevelFoundInStorage(true);\n        } else {\n          setLevelFoundInStorage(false);\n        }\n      } catch (error) {\n        console.error('Erreur chargement niveau actif:', error);\n        setLevelFoundInStorage(false); // En cas d'erreur, on considère que rien n'a été trouvé\n      } finally {\n        setIsLoaded(true);\n      }\n    };\n\n    loadFromStorage();\n  }, []); // <-- La dépendance vide est la clé\n\n  // Effet n°2 : Synchronisation avec le contexte `progress`.\n  // S'exécute seulement après le chargement ET si aucun niveau n'a été trouvé en mémoire.\n  useEffect(() => {\n    // On n'agit que si le chargement est fini et qu'aucun niveau n'a été chargé depuis AsyncStorage\n    if (isLoaded && !levelFoundInStorage) {\n      const levelFromProgress = progressData?.currentLevel;\n      if (levelFromProgress) {\n        const mappedLevel = mapOldToNewLevel(levelFromProgress);\n        if (LANGUAGE_LEVELS[mappedLevel]) {\n          setCurrentLevel(mappedLevel);\n        }\n      }\n    }\n  }, [isLoaded, levelFoundInStorage, progressData]);\n\n  // Le reste du hook est mémorisé avec useCallback pour la performance\n  const handleChangeActiveLevel = useCallback(async (newLevel) => {\n    if (!LANGUAGE_LEVELS[newLevel]) return;\n\n    setCurrentLevel(newLevel);\n    try {\n      await AsyncStorage.setItem(ACTIVE_LEVEL_KEY, newLevel);\n      // Si l'utilisateur change de niveau, on considère que la source de vérité est maintenant le stockage\n      setLevelFoundInStorage(true); \n    } catch (error) {\n      console.error('Erreur sauvegarde niveau actif:', error);\n    }\n  }, []);\n\n  const levelColor = LANGUAGE_LEVELS[currentLevel]?.color || \"#3B82F6\";\n\n  return {\n    currentLevel,\n    handleChangeActiveLevel,\n    levelColor,\n    isLoaded,\n  };\n};"],"mappings":"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","ignoreList":[]}