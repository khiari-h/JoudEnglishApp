eafc104012d08192791c95512a52adb1
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = useAnimatedProps;
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var ReactNativeFeatureFlags = _interopRequireWildcard(require("../../src/private/featureflags/ReactNativeFeatureFlags"));
var _ReactFabricPublicInstanceUtils = require("../ReactNative/ReactFabricPublicInstance/ReactFabricPublicInstanceUtils");
var _useRefEffect = _interopRequireDefault(require("../Utilities/useRefEffect"));
var _AnimatedEvent = require("./AnimatedEvent");
var _NativeAnimatedHelper = _interopRequireDefault(require("../../src/private/animated/NativeAnimatedHelper"));
var _AnimatedNode = _interopRequireDefault(require("./nodes/AnimatedNode"));
var _AnimatedProps = _interopRequireDefault(require("./nodes/AnimatedProps"));
var _AnimatedValue = _interopRequireDefault(require("./nodes/AnimatedValue"));
var _react = require("react");
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function _interopRequireWildcard(e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (var _t in e) "default" !== _t && {}.hasOwnProperty.call(e, _t) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, _t)) && (i.get || i.set) ? o(f, _t, i) : f[_t] = e[_t]); return f; })(e, t); }
function useAnimatedProps(props) {
  var _useReducer = (0, _react.useReducer)(function (count) {
      return count + 1;
    }, 0),
    _useReducer2 = (0, _slicedToArray2.default)(_useReducer, 2),
    scheduleUpdate = _useReducer2[1];
  var onUpdateRef = (0, _react.useRef)(null);
  var timerRef = (0, _react.useRef)(null);
  var node = (0, _react.useMemo)(function () {
    return new _AnimatedProps.default(props, function () {
      return onUpdateRef.current == null ? void 0 : onUpdateRef.current();
    });
  }, [props]);
  var useNativePropsInFabric = ReactNativeFeatureFlags.shouldUseSetNativePropsInFabric();
  var useSetNativePropsInNativeAnimationsInFabric = ReactNativeFeatureFlags.shouldUseSetNativePropsInNativeAnimationsInFabric();
  var useAnimatedPropsLifecycle = ReactNativeFeatureFlags.usePassiveEffectsForAnimations() ? useAnimatedPropsLifecycle_passiveEffects : useAnimatedPropsLifecycle_layoutEffects;
  useAnimatedPropsLifecycle(node);
  var refEffect = (0, _react.useCallback)(function (instance) {
    node.setNativeView(instance);
    onUpdateRef.current = function () {
      if (process.env.NODE_ENV === 'test') {
        return scheduleUpdate();
      }
      var isFabricNode = isFabricInstance(instance);
      if (node.__isNative) {
        if (isFabricNode) {
          if (useSetNativePropsInNativeAnimationsInFabric) {
            instance.setNativeProps(node.__getAnimatedValue());
          } else {
            scheduleUpdate();
          }
        }
        return;
      }
      if (typeof instance !== 'object' || typeof (instance == null ? void 0 : instance.setNativeProps) !== 'function') {
        return scheduleUpdate();
      }
      if (!isFabricNode) {
        return instance.setNativeProps(node.__getAnimatedValue());
      }
      if (!useNativePropsInFabric) {
        return scheduleUpdate();
      }
      instance.setNativeProps(node.__getAnimatedValue());
      if (timerRef.current != null) {
        clearTimeout(timerRef.current);
      }
      timerRef.current = setTimeout(function () {
        timerRef.current = null;
        scheduleUpdate();
      }, 48);
    };
    var target = getEventTarget(instance);
    var events = [];
    var animatedValueListeners = [];
    for (var propName in props) {
      var propValue = props[propName];
      if (propValue instanceof _AnimatedEvent.AnimatedEvent && propValue.__isNative) {
        propValue.__attach(target, propName);
        events.push([propName, propValue]);
        addListenersToPropsValue(propValue, animatedValueListeners);
      }
    }
    return function () {
      onUpdateRef.current = null;
      for (var _ref of events) {
        var _ref2 = (0, _slicedToArray2.default)(_ref, 2);
        var _propName = _ref2[0];
        var _propValue = _ref2[1];
        _propValue.__detach(target, _propName);
      }
      for (var _ref3 of animatedValueListeners) {
        var _propValue2 = _ref3.propValue;
        var listenerId = _ref3.listenerId;
        _propValue2.removeListener(listenerId);
      }
    };
  }, [node, useNativePropsInFabric, useSetNativePropsInNativeAnimationsInFabric, props]);
  var callbackRef = (0, _useRefEffect.default)(refEffect);
  return [reduceAnimatedProps(node), callbackRef];
}
function reduceAnimatedProps(node) {
  return Object.assign({}, node.__getValue(), {
    collapsable: false
  });
}
function addListenersToPropsValue(propValue, accumulator) {
  if (propValue instanceof _AnimatedValue.default) {
    var listenerId = propValue.addListener(function () {});
    accumulator.push({
      propValue: propValue,
      listenerId: listenerId
    });
  } else if (Array.isArray(propValue)) {
    for (var prop of propValue) {
      addListenersToPropsValue(prop, accumulator);
    }
  } else if (propValue instanceof Object) {
    addAnimatedValuesListenersToProps(propValue, accumulator);
  }
}
function addAnimatedValuesListenersToProps(props, accumulator) {
  for (var propName in props) {
    var propValue = props[propName];
    addListenersToPropsValue(propValue, accumulator);
  }
}
function useAnimatedPropsLifecycle_layoutEffects(node) {
  var prevNodeRef = (0, _react.useRef)(null);
  var isUnmountingRef = (0, _react.useRef)(false);
  (0, _react.useEffect)(function () {
    _NativeAnimatedHelper.default.API.flushQueue();
    var drivenAnimationEndedListener = null;
    if (node.__isNative) {
      drivenAnimationEndedListener = _NativeAnimatedHelper.default.nativeEventEmitter.addListener('onUserDrivenAnimationEnded', function (data) {
        node.update();
      });
    }
    return function () {
      var _drivenAnimationEnded;
      (_drivenAnimationEnded = drivenAnimationEndedListener) == null || _drivenAnimationEnded.remove();
    };
  });
  (0, _react.useLayoutEffect)(function () {
    isUnmountingRef.current = false;
    return function () {
      isUnmountingRef.current = true;
    };
  }, []);
  (0, _react.useLayoutEffect)(function () {
    node.__attach();
    if (prevNodeRef.current != null) {
      var prevNode = prevNodeRef.current;
      prevNode.__restoreDefaultValues();
      prevNode.__detach();
      prevNodeRef.current = null;
    }
    return function () {
      if (isUnmountingRef.current) {
        node.__detach();
      } else {
        prevNodeRef.current = node;
      }
    };
  }, [node]);
}
function useAnimatedPropsLifecycle_passiveEffects(node) {
  var prevNodeRef = (0, _react.useRef)(null);
  var isUnmountingRef = (0, _react.useRef)(false);
  (0, _react.useEffect)(function () {
    _NativeAnimatedHelper.default.API.flushQueue();
  });
  (0, _react.useEffect)(function () {
    isUnmountingRef.current = false;
    return function () {
      isUnmountingRef.current = true;
    };
  }, []);
  (0, _react.useEffect)(function () {
    node.__attach();
    var drivenAnimationEndedListener = null;
    if (node.__isNative) {
      drivenAnimationEndedListener = _NativeAnimatedHelper.default.nativeEventEmitter.addListener('onUserDrivenAnimationEnded', function (data) {
        node.update();
      });
    }
    if (prevNodeRef.current != null) {
      var prevNode = prevNodeRef.current;
      prevNode.__restoreDefaultValues();
      prevNode.__detach();
      prevNodeRef.current = null;
    }
    return function () {
      var _drivenAnimationEnded2;
      if (isUnmountingRef.current) {
        node.__detach();
      } else {
        prevNodeRef.current = node;
      }
      (_drivenAnimationEnded2 = drivenAnimationEndedListener) == null || _drivenAnimationEnded2.remove();
    };
  }, [node]);
}
function getEventTarget(instance) {
  return typeof instance === 'object' && typeof (instance == null ? void 0 : instance.getScrollableNode) === 'function' ? instance.getScrollableNode() : instance;
}
function isFabricInstance(instance) {
  var _instance$getScrollRe;
  return (0, _ReactFabricPublicInstanceUtils.isPublicInstance)(instance) || (0, _ReactFabricPublicInstanceUtils.isPublicInstance)(instance == null || instance.getNativeScrollRef == null ? void 0 : instance.getNativeScrollRef()) || (0, _ReactFabricPublicInstanceUtils.isPublicInstance)(instance == null || instance.getScrollResponder == null || (_instance$getScrollRe = instance.getScrollResponder()) == null || _instance$getScrollRe.getNativeScrollRef == null ? void 0 : _instance$getScrollRe.getNativeScrollRef());
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiZGVmYXVsdCIsInVzZUFuaW1hdGVkUHJvcHMiLCJfc2xpY2VkVG9BcnJheTIiLCJSZWFjdE5hdGl2ZUZlYXR1cmVGbGFncyIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwiX1JlYWN0RmFicmljUHVibGljSW5zdGFuY2VVdGlscyIsIl91c2VSZWZFZmZlY3QiLCJfQW5pbWF0ZWRFdmVudCIsIl9OYXRpdmVBbmltYXRlZEhlbHBlciIsIl9BbmltYXRlZE5vZGUiLCJfQW5pbWF0ZWRQcm9wcyIsIl9BbmltYXRlZFZhbHVlIiwiX3JlYWN0IiwiZSIsInQiLCJXZWFrTWFwIiwiciIsIm4iLCJfX2VzTW9kdWxlIiwibyIsImkiLCJmIiwiX19wcm90b19fIiwiaGFzIiwiZ2V0Iiwic2V0IiwiX3QiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJwcm9wcyIsIl91c2VSZWR1Y2VyIiwidXNlUmVkdWNlciIsImNvdW50IiwiX3VzZVJlZHVjZXIyIiwic2NoZWR1bGVVcGRhdGUiLCJvblVwZGF0ZVJlZiIsInVzZVJlZiIsInRpbWVyUmVmIiwibm9kZSIsInVzZU1lbW8iLCJBbmltYXRlZFByb3BzIiwiY3VycmVudCIsInVzZU5hdGl2ZVByb3BzSW5GYWJyaWMiLCJzaG91bGRVc2VTZXROYXRpdmVQcm9wc0luRmFicmljIiwidXNlU2V0TmF0aXZlUHJvcHNJbk5hdGl2ZUFuaW1hdGlvbnNJbkZhYnJpYyIsInNob3VsZFVzZVNldE5hdGl2ZVByb3BzSW5OYXRpdmVBbmltYXRpb25zSW5GYWJyaWMiLCJ1c2VBbmltYXRlZFByb3BzTGlmZWN5Y2xlIiwidXNlUGFzc2l2ZUVmZmVjdHNGb3JBbmltYXRpb25zIiwidXNlQW5pbWF0ZWRQcm9wc0xpZmVjeWNsZV9wYXNzaXZlRWZmZWN0cyIsInVzZUFuaW1hdGVkUHJvcHNMaWZlY3ljbGVfbGF5b3V0RWZmZWN0cyIsInJlZkVmZmVjdCIsInVzZUNhbGxiYWNrIiwiaW5zdGFuY2UiLCJzZXROYXRpdmVWaWV3IiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwiaXNGYWJyaWNOb2RlIiwiaXNGYWJyaWNJbnN0YW5jZSIsIl9faXNOYXRpdmUiLCJzZXROYXRpdmVQcm9wcyIsIl9fZ2V0QW5pbWF0ZWRWYWx1ZSIsImNsZWFyVGltZW91dCIsInNldFRpbWVvdXQiLCJ0YXJnZXQiLCJnZXRFdmVudFRhcmdldCIsImV2ZW50cyIsImFuaW1hdGVkVmFsdWVMaXN0ZW5lcnMiLCJwcm9wTmFtZSIsInByb3BWYWx1ZSIsIkFuaW1hdGVkRXZlbnQiLCJfX2F0dGFjaCIsInB1c2giLCJhZGRMaXN0ZW5lcnNUb1Byb3BzVmFsdWUiLCJfcmVmIiwiX3JlZjIiLCJfX2RldGFjaCIsIl9yZWYzIiwibGlzdGVuZXJJZCIsInJlbW92ZUxpc3RlbmVyIiwiY2FsbGJhY2tSZWYiLCJ1c2VSZWZFZmZlY3QiLCJyZWR1Y2VBbmltYXRlZFByb3BzIiwiYXNzaWduIiwiX19nZXRWYWx1ZSIsImNvbGxhcHNhYmxlIiwiYWNjdW11bGF0b3IiLCJBbmltYXRlZFZhbHVlIiwiYWRkTGlzdGVuZXIiLCJBcnJheSIsImlzQXJyYXkiLCJwcm9wIiwiYWRkQW5pbWF0ZWRWYWx1ZXNMaXN0ZW5lcnNUb1Byb3BzIiwicHJldk5vZGVSZWYiLCJpc1VubW91bnRpbmdSZWYiLCJ1c2VFZmZlY3QiLCJOYXRpdmVBbmltYXRlZEhlbHBlciIsIkFQSSIsImZsdXNoUXVldWUiLCJkcml2ZW5BbmltYXRpb25FbmRlZExpc3RlbmVyIiwibmF0aXZlRXZlbnRFbWl0dGVyIiwiZGF0YSIsInVwZGF0ZSIsIl9kcml2ZW5BbmltYXRpb25FbmRlZCIsInJlbW92ZSIsInVzZUxheW91dEVmZmVjdCIsInByZXZOb2RlIiwiX19yZXN0b3JlRGVmYXVsdFZhbHVlcyIsIl9kcml2ZW5BbmltYXRpb25FbmRlZDIiLCJnZXRTY3JvbGxhYmxlTm9kZSIsIl9pbnN0YW5jZSRnZXRTY3JvbGxSZSIsImlzRmFicmljUHVibGljSW5zdGFuY2UiLCJnZXROYXRpdmVTY3JvbGxSZWYiLCJnZXRTY3JvbGxSZXNwb25kZXIiXSwic291cmNlcyI6WyJ1c2VBbmltYXRlZFByb3BzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBNZXRhIFBsYXRmb3JtcywgSW5jLiBhbmQgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZmxvdyBzdHJpY3QtbG9jYWxcbiAqIEBmb3JtYXRcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB0eXBlIHtFdmVudFN1YnNjcmlwdGlvbn0gZnJvbSAnLi4vRXZlbnRFbWl0dGVyL05hdGl2ZUV2ZW50RW1pdHRlcic7XG5cbmltcG9ydCAqIGFzIFJlYWN0TmF0aXZlRmVhdHVyZUZsYWdzIGZyb20gJy4uLy4uL3NyYy9wcml2YXRlL2ZlYXR1cmVmbGFncy9SZWFjdE5hdGl2ZUZlYXR1cmVGbGFncyc7XG5pbXBvcnQge2lzUHVibGljSW5zdGFuY2UgYXMgaXNGYWJyaWNQdWJsaWNJbnN0YW5jZX0gZnJvbSAnLi4vUmVhY3ROYXRpdmUvUmVhY3RGYWJyaWNQdWJsaWNJbnN0YW5jZS9SZWFjdEZhYnJpY1B1YmxpY0luc3RhbmNlVXRpbHMnO1xuaW1wb3J0IHVzZVJlZkVmZmVjdCBmcm9tICcuLi9VdGlsaXRpZXMvdXNlUmVmRWZmZWN0JztcbmltcG9ydCB7QW5pbWF0ZWRFdmVudH0gZnJvbSAnLi9BbmltYXRlZEV2ZW50JztcbmltcG9ydCBOYXRpdmVBbmltYXRlZEhlbHBlciBmcm9tICcuLi8uLi9zcmMvcHJpdmF0ZS9hbmltYXRlZC9OYXRpdmVBbmltYXRlZEhlbHBlcic7XG5pbXBvcnQgQW5pbWF0ZWROb2RlIGZyb20gJy4vbm9kZXMvQW5pbWF0ZWROb2RlJztcbmltcG9ydCBBbmltYXRlZFByb3BzIGZyb20gJy4vbm9kZXMvQW5pbWF0ZWRQcm9wcyc7XG5pbXBvcnQgQW5pbWF0ZWRWYWx1ZSBmcm9tICcuL25vZGVzL0FuaW1hdGVkVmFsdWUnO1xuaW1wb3J0IHtcbiAgdXNlQ2FsbGJhY2ssXG4gIHVzZUVmZmVjdCxcbiAgdXNlTGF5b3V0RWZmZWN0LFxuICB1c2VNZW1vLFxuICB1c2VSZWR1Y2VyLFxuICB1c2VSZWYsXG59IGZyb20gJ3JlYWN0JztcblxudHlwZSBSZWR1Y2VkUHJvcHM8VFByb3BzPiA9IHtcbiAgLi4uVFByb3BzLFxuICBjb2xsYXBzYWJsZTogYm9vbGVhbixcbiAgLi4uXG59O1xudHlwZSBDYWxsYmFja1JlZjxUPiA9IFQgPT4gbWl4ZWQ7XG5cbnR5cGUgQW5pbWF0ZWRWYWx1ZUxpc3RlbmVycyA9IEFycmF5PHtcbiAgcHJvcFZhbHVlOiBBbmltYXRlZFZhbHVlLFxuICBsaXN0ZW5lcklkOiBzdHJpbmcsXG59PjtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gdXNlQW5pbWF0ZWRQcm9wczxUUHJvcHM6IHsuLi59LCBUSW5zdGFuY2U+KFxuICBwcm9wczogVFByb3BzLFxuKTogW1JlZHVjZWRQcm9wczxUUHJvcHM+LCBDYWxsYmFja1JlZjxUSW5zdGFuY2UgfCBudWxsPl0ge1xuICBjb25zdCBbLCBzY2hlZHVsZVVwZGF0ZV0gPSB1c2VSZWR1Y2VyPG51bWJlciwgdm9pZD4oY291bnQgPT4gY291bnQgKyAxLCAwKTtcbiAgY29uc3Qgb25VcGRhdGVSZWYgPSB1c2VSZWY8PygpID0+IHZvaWQ+KG51bGwpO1xuICBjb25zdCB0aW1lclJlZiA9IHVzZVJlZjxUaW1lb3V0SUQgfCBudWxsPihudWxsKTtcblxuICAvLyBUT0RPOiBPbmx5IGludmFsaWRhdGUgYG5vZGVgIGlmIGFuaW1hdGVkIHByb3BzIG9yIGBzdHlsZWAgY2hhbmdlLiBJbiB0aGVcbiAgLy8gcHJldmlvdXMgaW1wbGVtZW50YXRpb24sIHdlIHBlcm1pdHRlZCBgc3R5bGVgIHRvIG92ZXJyaWRlIHByb3BzIHdpdGggdGhlXG4gIC8vIHNhbWUgbmFtZSBwcm9wZXJ0eSBuYW1lIGFzIHN0eWxlcywgc28gd2UgY2FuIHByb2JhYmx5IGNvbnRpbnVlIGRvaW5nIHRoYXQuXG4gIC8vIFRoZSBvcmRlcmluZyBvZiBvdGhlciBwcm9wcyAqc2hvdWxkKiBub3QgbWF0dGVyLlxuICBjb25zdCBub2RlID0gdXNlTWVtbyhcbiAgICAoKSA9PiBuZXcgQW5pbWF0ZWRQcm9wcyhwcm9wcywgKCkgPT4gb25VcGRhdGVSZWYuY3VycmVudD8uKCkpLFxuICAgIFtwcm9wc10sXG4gICk7XG4gIGNvbnN0IHVzZU5hdGl2ZVByb3BzSW5GYWJyaWMgPVxuICAgIFJlYWN0TmF0aXZlRmVhdHVyZUZsYWdzLnNob3VsZFVzZVNldE5hdGl2ZVByb3BzSW5GYWJyaWMoKTtcbiAgY29uc3QgdXNlU2V0TmF0aXZlUHJvcHNJbk5hdGl2ZUFuaW1hdGlvbnNJbkZhYnJpYyA9XG4gICAgUmVhY3ROYXRpdmVGZWF0dXJlRmxhZ3Muc2hvdWxkVXNlU2V0TmF0aXZlUHJvcHNJbk5hdGl2ZUFuaW1hdGlvbnNJbkZhYnJpYygpO1xuXG4gIGNvbnN0IHVzZUFuaW1hdGVkUHJvcHNMaWZlY3ljbGUgPVxuICAgIFJlYWN0TmF0aXZlRmVhdHVyZUZsYWdzLnVzZVBhc3NpdmVFZmZlY3RzRm9yQW5pbWF0aW9ucygpXG4gICAgICA/IHVzZUFuaW1hdGVkUHJvcHNMaWZlY3ljbGVfcGFzc2l2ZUVmZmVjdHNcbiAgICAgIDogdXNlQW5pbWF0ZWRQcm9wc0xpZmVjeWNsZV9sYXlvdXRFZmZlY3RzO1xuXG4gIHVzZUFuaW1hdGVkUHJvcHNMaWZlY3ljbGUobm9kZSk7XG5cbiAgLy8gVE9ETzogVGhpcyBcImVmZmVjdFwiIGRvZXMgdGhyZWUgdGhpbmdzOlxuICAvL1xuICAvLyAgIDEpIENhbGwgYHNldE5hdGl2ZVZpZXdgLlxuICAvLyAgIDIpIFVwZGF0ZSBgb25VcGRhdGVSZWZgLlxuICAvLyAgIDMpIFVwZGF0ZSBsaXN0ZW5lcnMgZm9yIGBBbmltYXRlZEV2ZW50YCBwcm9wcy5cbiAgLy9cbiAgLy8gSWRlYWxseSwgZWFjaCBvZiB0aGVzZSB3b3VsZCBiZSBzZXBhcmF0ZSBcImVmZmVjdHNcIiBzbyB0aGF0IHRoZXkgYXJlIG5vdFxuICAvLyB1bm5lY2Vzc2FyaWx5IHJlLXJ1biB3aGVuIGlycmVsZXZhbnQgZGVwZW5kZW5jaWVzIGNoYW5nZS4gRm9yIGV4YW1wbGUsIHdlXG4gIC8vIHNob3VsZCBiZSBhYmxlIHRvIGhvaXN0IGFsbCBgQW5pbWF0ZWRFdmVudGAgcHJvcHMgYW5kIG9ubHkgZG8gIzMgaWYgZWl0aGVyXG4gIC8vIHRoZSBgQW5pbWF0ZWRFdmVudGAgcHJvcHMgY2hhbmdlIG9yIGBpbnN0YW5jZWAgY2hhbmdlcy5cbiAgLy9cbiAgLy8gQnV0IHRoZXJlIGlzIG5vIHdheSB0byB0cmFuc3BhcmVudGx5IGNvbXBvc2UgdGhyZWUgc2VwYXJhdGUgY2FsbGJhY2sgcmVmcyxcbiAgLy8gc28gd2UganVzdCBjb21iaW5lIHRoZW0gYWxsIGludG8gb25lIGZvciBub3cuXG4gIGNvbnN0IHJlZkVmZmVjdCA9IHVzZUNhbGxiYWNrKFxuICAgIChpbnN0YW5jZTogVEluc3RhbmNlKSA9PiB7XG4gICAgICAvLyBOT1RFOiBUaGlzIG1heSBiZSBjYWxsZWQgbW9yZSBvZnRlbiB0aGFuIG5lY2Vzc2FyeSAoZS5nLiB3aGVuIGBwcm9wc2BcbiAgICAgIC8vIGNoYW5nZXMpLCBidXQgYHNldE5hdGl2ZVZpZXdgIGFscmVhZHkgb3B0aW1pemVzIGZvciB0aGF0LlxuICAgICAgbm9kZS5zZXROYXRpdmVWaWV3KGluc3RhbmNlKTtcblxuICAgICAgLy8gTk9URTogV2hlbiB1c2luZyB0aGUgSlMgYW5pbWF0aW9uIGRyaXZlciwgdGhpcyBjYWxsYmFjayBpcyBjYWxsZWQgb25cbiAgICAgIC8vIGV2ZXJ5IGFuaW1hdGlvbiBmcmFtZS4gV2hlbiB1c2luZyB0aGUgbmF0aXZlIGRyaXZlciwgdGhpcyBjYWxsYmFjayBpc1xuICAgICAgLy8gY2FsbGVkIHdoZW4gdGhlIGFuaW1hdGlvbiBjb21wbGV0ZXMuXG4gICAgICBvblVwZGF0ZVJlZi5jdXJyZW50ID0gKCkgPT4ge1xuICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0Jykge1xuICAgICAgICAgIC8vIENoZWNrIDE6IHRoaXMgaXMgYSB0ZXN0LlxuICAgICAgICAgIC8vIGNhbGwgYHNjaGVkdWxlVXBkYXRlYCB0byBieXBhc3MgdXNlIG9mIHNldE5hdGl2ZVByb3BzLlxuICAgICAgICAgIHJldHVybiBzY2hlZHVsZVVwZGF0ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaXNGYWJyaWNOb2RlID0gaXNGYWJyaWNJbnN0YW5jZShpbnN0YW5jZSk7XG4gICAgICAgIGlmIChub2RlLl9faXNOYXRpdmUpIHtcbiAgICAgICAgICAvLyBDaGVjayAyOiB0aGlzIGlzIGFuIGFuaW1hdGlvbiBkcml2ZW4gYnkgbmF0aXZlLlxuICAgICAgICAgIC8vIEluIG5hdGl2ZSBkcml2ZW4gYW5pbWF0aW9ucywgdGhpcyBjYWxsYmFjayBpcyBvbmx5IGNhbGxlZCBvbmNlIHRoZSBhbmltYXRpb24gY29tcGxldGVzLlxuICAgICAgICAgIGlmIChpc0ZhYnJpY05vZGUpIHtcbiAgICAgICAgICAgIC8vIENhbGwgYHNjaGVkdWxlVXBkYXRlYCB0byBzeW5jaHJvbmlzZSBGaWJlciBhbmQgU2hhZG93IHRyZWUuXG4gICAgICAgICAgICAvLyBNdXN0IG5vdCBiZSBjYWxsZWQgaW4gUGFwZXIuXG4gICAgICAgICAgICBpZiAodXNlU2V0TmF0aXZlUHJvcHNJbk5hdGl2ZUFuaW1hdGlvbnNJbkZhYnJpYykge1xuICAgICAgICAgICAgICAvLyAkRmxvd0ZpeE1lW2luY29tcGF0aWJsZS11c2VdXG4gICAgICAgICAgICAgIGluc3RhbmNlLnNldE5hdGl2ZVByb3BzKG5vZGUuX19nZXRBbmltYXRlZFZhbHVlKCkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgc2NoZWR1bGVVcGRhdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIHR5cGVvZiBpbnN0YW5jZSAhPT0gJ29iamVjdCcgfHxcbiAgICAgICAgICB0eXBlb2YgaW5zdGFuY2U/LnNldE5hdGl2ZVByb3BzICE9PSAnZnVuY3Rpb24nXG4gICAgICAgICkge1xuICAgICAgICAgIC8vIENoZWNrIDM6IHRoZSBpbnN0YW5jZSBkb2VzIG5vdCBzdXBwb3J0IHNldE5hdGl2ZVByb3BzLiBDYWxsIGBzY2hlZHVsZVVwZGF0ZWAuXG4gICAgICAgICAgcmV0dXJuIHNjaGVkdWxlVXBkYXRlKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWlzRmFicmljTm9kZSkge1xuICAgICAgICAgIC8vIENoZWNrIDQ6IHRoaXMgaXMgYSBwYXBlciBpbnN0YW5jZSwgY2FsbCBzZXROYXRpdmVQcm9wcy5cbiAgICAgICAgICAvLyAkRmxvd0lnbm9yZVtub3QtYS1mdW5jdGlvbl0gLSBBc3N1bWUgaXQncyBzdGlsbCBhIGZ1bmN0aW9uLlxuICAgICAgICAgIC8vICRGbG93Rml4TWVbaW5jb21wYXRpYmxlLXVzZV1cbiAgICAgICAgICByZXR1cm4gaW5zdGFuY2Uuc2V0TmF0aXZlUHJvcHMobm9kZS5fX2dldEFuaW1hdGVkVmFsdWUoKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXVzZU5hdGl2ZVByb3BzSW5GYWJyaWMpIHtcbiAgICAgICAgICAvLyBDaGVjayA1OiBzZXROYXRpdmVQcm9wcyBhcmUgZGlzYWJsZWQuXG4gICAgICAgICAgcmV0dXJuIHNjaGVkdWxlVXBkYXRlKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUaGlzIGlzIGEgRmFicmljIGluc3RhbmNlIGFuZCBzZXROYXRpdmVQcm9wcyBpcyBzdXBwb3J0ZWQuXG5cbiAgICAgICAgLy8gJEZsb3dJZ25vcmVbbm90LWEtZnVuY3Rpb25dIC0gQXNzdW1lIGl0J3Mgc3RpbGwgYSBmdW5jdGlvbi5cbiAgICAgICAgLy8gJEZsb3dGaXhNZVtpbmNvbXBhdGlibGUtdXNlXVxuICAgICAgICBpbnN0YW5jZS5zZXROYXRpdmVQcm9wcyhub2RlLl9fZ2V0QW5pbWF0ZWRWYWx1ZSgpKTtcblxuICAgICAgICAvLyBLZWVwaW5nIHN0YXRlIG9mIEZpYmVyIHRyZWUgYW5kIFNoYWRvdyB0cmVlIGluIHN5bmMuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIFRoaXMgaXMgZG9uZSBieSBjYWxsaW5nIGBzY2hlZHVsZVVwZGF0ZWAgd2hpY2ggd2lsbCB0cmlnZ2VyIGEgY29tbWl0LlxuICAgICAgICAvLyBIb3dldmVyLCBSZWFjdCBjb21taXQgaXMgbm90IGZhc3QgZW5vdWdoIHRvIGRyaXZlIGFuaW1hdGlvbnMuXG4gICAgICAgIC8vIFRoaXMgaXMgd2hlcmUgc2V0TmF0aXZlUHJvcHMgY29tZXMgaW4gaGFuZHkgYnV0IHRoZSBzdGF0ZSBiZXR3ZWVuXG4gICAgICAgIC8vIEZpYmVyIHRyZWUgYW5kIFNoYWRvdyB0cmVlIG5lZWRzIHRvIGJlIGtlcHQgaW4gc3luYy5cbiAgICAgICAgLy8gVGhlIGdvYWwgaXMgdG8gY2FsbCBgc2NoZWR1bGVVcGRhdGVgIGFzIGxpdHRsZSBhcyBwb3NzaWJsZSB0byBtYWludGFpblxuICAgICAgICAvLyBwZXJmb3JtYW5jZSBidXQgZnJlcXVlbnRseSBlbm91Z2ggdG8ga2VlcCBzdGF0ZSBpbiBzeW5jLlxuICAgICAgICAvLyBEZWJvdW5jZSBpcyBzZXQgdG8gNDhtcywgd2hpY2ggaXMgMyAqIHRoZSBkdXJhdGlvbiBvZiBhIGZyYW1lLlxuICAgICAgICAvLyAzIGZyYW1lcyB3YXMgdGhlIGhpZ2hlc3QgdmFsdWUgd2hlcmUgZmxpY2tlcmluZyBzdGF0ZSB3YXMgbm90IG9ic2VydmVkLlxuICAgICAgICBpZiAodGltZXJSZWYuY3VycmVudCAhPSBudWxsKSB7XG4gICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyUmVmLmN1cnJlbnQpO1xuICAgICAgICB9XG4gICAgICAgIHRpbWVyUmVmLmN1cnJlbnQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICB0aW1lclJlZi5jdXJyZW50ID0gbnVsbDtcbiAgICAgICAgICBzY2hlZHVsZVVwZGF0ZSgpO1xuICAgICAgICB9LCA0OCk7XG4gICAgICB9O1xuXG4gICAgICBjb25zdCB0YXJnZXQgPSBnZXRFdmVudFRhcmdldChpbnN0YW5jZSk7XG4gICAgICBjb25zdCBldmVudHMgPSBbXTtcbiAgICAgIGNvbnN0IGFuaW1hdGVkVmFsdWVMaXN0ZW5lcnM6IEFuaW1hdGVkVmFsdWVMaXN0ZW5lcnMgPSBbXTtcblxuICAgICAgZm9yIChjb25zdCBwcm9wTmFtZSBpbiBwcm9wcykge1xuICAgICAgICAvLyAkRmxvd0ZpeE1lW2ludmFsaWQtY29tcHV0ZWQtcHJvcF1cbiAgICAgICAgY29uc3QgcHJvcFZhbHVlID0gcHJvcHNbcHJvcE5hbWVdO1xuICAgICAgICBpZiAocHJvcFZhbHVlIGluc3RhbmNlb2YgQW5pbWF0ZWRFdmVudCAmJiBwcm9wVmFsdWUuX19pc05hdGl2ZSkge1xuICAgICAgICAgIHByb3BWYWx1ZS5fX2F0dGFjaCh0YXJnZXQsIHByb3BOYW1lKTtcbiAgICAgICAgICBldmVudHMucHVzaChbcHJvcE5hbWUsIHByb3BWYWx1ZV0pO1xuICAgICAgICAgIC8vICRGbG93Rml4TWVbaW5jb21wYXRpYmxlLWNhbGxdIC0gdGhlIGBhZGRMaXN0ZW5lcnNUb1Byb3BzVmFsdWVgIGRyaWxscyBkb3duIHRoZSBwcm9wVmFsdWUuXG4gICAgICAgICAgYWRkTGlzdGVuZXJzVG9Qcm9wc1ZhbHVlKHByb3BWYWx1ZSwgYW5pbWF0ZWRWYWx1ZUxpc3RlbmVycyk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgb25VcGRhdGVSZWYuY3VycmVudCA9IG51bGw7XG5cbiAgICAgICAgZm9yIChjb25zdCBbcHJvcE5hbWUsIHByb3BWYWx1ZV0gb2YgZXZlbnRzKSB7XG4gICAgICAgICAgcHJvcFZhbHVlLl9fZGV0YWNoKHRhcmdldCwgcHJvcE5hbWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChjb25zdCB7cHJvcFZhbHVlLCBsaXN0ZW5lcklkfSBvZiBhbmltYXRlZFZhbHVlTGlzdGVuZXJzKSB7XG4gICAgICAgICAgcHJvcFZhbHVlLnJlbW92ZUxpc3RlbmVyKGxpc3RlbmVySWQpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH0sXG4gICAgW1xuICAgICAgbm9kZSxcbiAgICAgIHVzZU5hdGl2ZVByb3BzSW5GYWJyaWMsXG4gICAgICB1c2VTZXROYXRpdmVQcm9wc0luTmF0aXZlQW5pbWF0aW9uc0luRmFicmljLFxuICAgICAgcHJvcHMsXG4gICAgXSxcbiAgKTtcbiAgY29uc3QgY2FsbGJhY2tSZWYgPSB1c2VSZWZFZmZlY3Q8VEluc3RhbmNlPihyZWZFZmZlY3QpO1xuXG4gIHJldHVybiBbcmVkdWNlQW5pbWF0ZWRQcm9wczxUUHJvcHM+KG5vZGUpLCBjYWxsYmFja1JlZl07XG59XG5cbmZ1bmN0aW9uIHJlZHVjZUFuaW1hdGVkUHJvcHM8VFByb3BzPihub2RlOiBBbmltYXRlZE5vZGUpOiBSZWR1Y2VkUHJvcHM8VFByb3BzPiB7XG4gIC8vIEZvcmNlIGBjb2xsYXBzYWJsZWAgdG8gYmUgZmFsc2Ugc28gdGhhdCB0aGUgbmF0aXZlIHZpZXcgaXMgbm90IGZsYXR0ZW5lZC5cbiAgLy8gRmxhdHRlbmVkIHZpZXdzIGNhbm5vdCBiZSBhY2N1cmF0ZWx5IHJlZmVyZW5jZWQgYnkgdGhlIG5hdGl2ZSBkcml2ZXIuXG4gIHJldHVybiB7XG4gICAgLi4ubm9kZS5fX2dldFZhbHVlKCksXG4gICAgY29sbGFwc2FibGU6IGZhbHNlLFxuICB9O1xufVxuXG5mdW5jdGlvbiBhZGRMaXN0ZW5lcnNUb1Byb3BzVmFsdWUoXG4gIHByb3BWYWx1ZTogQW5pbWF0ZWRWYWx1ZSxcbiAgYWNjdW11bGF0b3I6IEFuaW1hdGVkVmFsdWVMaXN0ZW5lcnMsXG4pIHtcbiAgLy8gcHJvcFZhbHVlIGNhbiBiZSBhIHNjYWxhciB2YWx1ZSwgYW4gYXJyYXkgb3IgYW4gb2JqZWN0LlxuICBpZiAocHJvcFZhbHVlIGluc3RhbmNlb2YgQW5pbWF0ZWRWYWx1ZSkge1xuICAgIGNvbnN0IGxpc3RlbmVySWQgPSBwcm9wVmFsdWUuYWRkTGlzdGVuZXIoKCkgPT4ge30pO1xuICAgIGFjY3VtdWxhdG9yLnB1c2goe3Byb3BWYWx1ZSwgbGlzdGVuZXJJZH0pO1xuICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkocHJvcFZhbHVlKSkge1xuICAgIC8vIEFuIGFycmF5IGNhbiBiZSBhbiBhcnJheSBvZiBzY2FsYXIgdmFsdWVzLCBhcnJheXMgb2YgYXJyYXlzLCBvciBhcnJheXMgb2Ygb2JqZWN0c1xuICAgIGZvciAoY29uc3QgcHJvcCBvZiBwcm9wVmFsdWUpIHtcbiAgICAgIGFkZExpc3RlbmVyc1RvUHJvcHNWYWx1ZShwcm9wLCBhY2N1bXVsYXRvcik7XG4gICAgfVxuICB9IGVsc2UgaWYgKHByb3BWYWx1ZSBpbnN0YW5jZW9mIE9iamVjdCkge1xuICAgIGFkZEFuaW1hdGVkVmFsdWVzTGlzdGVuZXJzVG9Qcm9wcyhwcm9wVmFsdWUsIGFjY3VtdWxhdG9yKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhZGRBbmltYXRlZFZhbHVlc0xpc3RlbmVyc1RvUHJvcHMoXG4gIHByb3BzOiBBbmltYXRlZE5vZGUsXG4gIGFjY3VtdWxhdG9yOiBBbmltYXRlZFZhbHVlTGlzdGVuZXJzLFxuKSB7XG4gIGZvciAoY29uc3QgcHJvcE5hbWUgaW4gcHJvcHMpIHtcbiAgICAvLyAkRmxvd0ZpeE1lW3Byb3AtbWlzc2luZ10gLSBUaGlzIGlzIGFuIG9iamVjdCBjb250YWluZWQgaW4gYSBwcm9wLCBidXQgd2UgZG9uJ3Qga25vdyB0aGUgZXhhY3QgdHlwZS5cbiAgICBjb25zdCBwcm9wVmFsdWUgPSBwcm9wc1twcm9wTmFtZV07XG4gICAgYWRkTGlzdGVuZXJzVG9Qcm9wc1ZhbHVlKHByb3BWYWx1ZSwgYWNjdW11bGF0b3IpO1xuICB9XG59XG5cbi8qKlxuICogTWFuYWdlcyB0aGUgbGlmZWN5Y2xlIG9mIHRoZSBzdXBwbGllZCBgQW5pbWF0ZWRQcm9wc2AgYnkgaW52b2tpbmcgYF9fYXR0YWNoYFxuICogYW5kIGBfX2RldGFjaGAuIEhvd2V2ZXIsIHRoaXMgaXMgbW9yZSBjb21wbGljYXRlZCBiZWNhdXNlIGBBbmltYXRlZFByb3BzYFxuICogdXNlcyByZWZlcmVuY2UgY291bnRpbmcgdG8gZGV0ZXJtaW5lIHdoZW4gdG8gcmVjdXJzaXZlbHkgZGV0YWNoIGl0cyBjaGlsZHJlblxuICogbm9kZXMuIFNvIGluIG9yZGVyIHRvIG9wdGltaXplIHRoaXMsIHdlIGF2b2lkIGRldGFjaGluZyB1bnRpbCB0aGUgbmV4dCBhdHRhY2hcbiAqIHVubGVzcyB3ZSBhcmUgdW5tb3VudGluZy5cbiAqL1xuZnVuY3Rpb24gdXNlQW5pbWF0ZWRQcm9wc0xpZmVjeWNsZV9sYXlvdXRFZmZlY3RzKG5vZGU6IEFuaW1hdGVkUHJvcHMpOiB2b2lkIHtcbiAgY29uc3QgcHJldk5vZGVSZWYgPSB1c2VSZWY8P0FuaW1hdGVkUHJvcHM+KG51bGwpO1xuICBjb25zdCBpc1VubW91bnRpbmdSZWYgPSB1c2VSZWY8Ym9vbGVhbj4oZmFsc2UpO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgLy8gSXQgaXMgb2sgZm9yIG11bHRpcGxlIGNvbXBvbmVudHMgdG8gY2FsbCBgZmx1c2hRdWV1ZWAgYmVjYXVzZSBpdCBub29wc1xuICAgIC8vIGlmIHRoZSBxdWV1ZSBpcyBlbXB0eS4gV2hlbiBtdWx0aXBsZSBhbmltYXRlZCBjb21wb25lbnRzIGFyZSBtb3VudGVkIGF0XG4gICAgLy8gdGhlIHNhbWUgdGltZS4gT25seSBmaXJzdCBjb21wb25lbnQgZmx1c2hlcyB0aGUgcXVldWUgYW5kIHRoZSBvdGhlcnMgd2lsbCBub29wLlxuICAgIE5hdGl2ZUFuaW1hdGVkSGVscGVyLkFQSS5mbHVzaFF1ZXVlKCk7XG4gICAgbGV0IGRyaXZlbkFuaW1hdGlvbkVuZGVkTGlzdGVuZXI6ID9FdmVudFN1YnNjcmlwdGlvbiA9IG51bGw7XG4gICAgaWYgKG5vZGUuX19pc05hdGl2ZSkge1xuICAgICAgZHJpdmVuQW5pbWF0aW9uRW5kZWRMaXN0ZW5lciA9XG4gICAgICAgIE5hdGl2ZUFuaW1hdGVkSGVscGVyLm5hdGl2ZUV2ZW50RW1pdHRlci5hZGRMaXN0ZW5lcihcbiAgICAgICAgICAnb25Vc2VyRHJpdmVuQW5pbWF0aW9uRW5kZWQnLFxuICAgICAgICAgIGRhdGEgPT4ge1xuICAgICAgICAgICAgbm9kZS51cGRhdGUoKTtcbiAgICAgICAgICB9LFxuICAgICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBkcml2ZW5BbmltYXRpb25FbmRlZExpc3RlbmVyPy5yZW1vdmUoKTtcbiAgICB9O1xuICB9KTtcblxuICB1c2VMYXlvdXRFZmZlY3QoKCkgPT4ge1xuICAgIGlzVW5tb3VudGluZ1JlZi5jdXJyZW50ID0gZmFsc2U7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGlzVW5tb3VudGluZ1JlZi5jdXJyZW50ID0gdHJ1ZTtcbiAgICB9O1xuICB9LCBbXSk7XG5cbiAgdXNlTGF5b3V0RWZmZWN0KCgpID0+IHtcbiAgICBub2RlLl9fYXR0YWNoKCk7XG4gICAgaWYgKHByZXZOb2RlUmVmLmN1cnJlbnQgIT0gbnVsbCkge1xuICAgICAgY29uc3QgcHJldk5vZGUgPSBwcmV2Tm9kZVJlZi5jdXJyZW50O1xuICAgICAgLy8gVE9ETzogU3RvcCByZXN0b3JpbmcgZGVmYXVsdCB2YWx1ZXMgKHVubGVzcyBgcmVzZXRgIGlzIGNhbGxlZCkuXG4gICAgICBwcmV2Tm9kZS5fX3Jlc3RvcmVEZWZhdWx0VmFsdWVzKCk7XG4gICAgICBwcmV2Tm9kZS5fX2RldGFjaCgpO1xuICAgICAgcHJldk5vZGVSZWYuY3VycmVudCA9IG51bGw7XG4gICAgfVxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBpZiAoaXNVbm1vdW50aW5nUmVmLmN1cnJlbnQpIHtcbiAgICAgICAgLy8gTk9URTogRG8gbm90IHJlc3RvcmUgZGVmYXVsdCB2YWx1ZXMgb24gdW5tb3VudCwgc2VlIEQxODE5NzczNS5cbiAgICAgICAgbm9kZS5fX2RldGFjaCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcHJldk5vZGVSZWYuY3VycmVudCA9IG5vZGU7XG4gICAgICB9XG4gICAgfTtcbiAgfSwgW25vZGVdKTtcbn1cblxuLyoqXG4gKiBNYW5hZ2VzIHRoZSBsaWZlY3ljbGUgb2YgdGhlIHN1cHBsaWVkIGBBbmltYXRlZFByb3BzYCBieSBpbnZva2luZyBgX19hdHRhY2hgXG4gKiBhbmQgYF9fZGV0YWNoYC4gSG93ZXZlciwgdGhpcyBpcyBtb3JlIGNvbXBsaWNhdGVkIGJlY2F1c2UgYEFuaW1hdGVkUHJvcHNgXG4gKiB1c2VzIHJlZmVyZW5jZSBjb3VudGluZyB0byBkZXRlcm1pbmUgd2hlbiB0byByZWN1cnNpdmVseSBkZXRhY2ggaXRzIGNoaWxkcmVuXG4gKiBub2Rlcy4gU28gaW4gb3JkZXIgdG8gb3B0aW1pemUgdGhpcywgd2UgYXZvaWQgZGV0YWNoaW5nIHVudGlsIHRoZSBuZXh0IGF0dGFjaFxuICogdW5sZXNzIHdlIGFyZSB1bm1vdW50aW5nLlxuICpcbiAqIE5PVEU6IHVubGlrZSBgdXNlQW5pbWF0ZWRQcm9wc0xpZmVjeWNsZV9sYXlvdXRFZmZlY3RzYCwgdGhpcyB2ZXJzaW9uIHVzZXMgcGFzc2l2ZSBlZmZlY3RzIHRvIHNldHVwIGFuaW1hdGlvbiBncmFwaC5cbiAqL1xuZnVuY3Rpb24gdXNlQW5pbWF0ZWRQcm9wc0xpZmVjeWNsZV9wYXNzaXZlRWZmZWN0cyhub2RlOiBBbmltYXRlZFByb3BzKTogdm9pZCB7XG4gIGNvbnN0IHByZXZOb2RlUmVmID0gdXNlUmVmPD9BbmltYXRlZFByb3BzPihudWxsKTtcbiAgY29uc3QgaXNVbm1vdW50aW5nUmVmID0gdXNlUmVmPGJvb2xlYW4+KGZhbHNlKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIC8vIEl0IGlzIG9rIGZvciBtdWx0aXBsZSBjb21wb25lbnRzIHRvIGNhbGwgYGZsdXNoUXVldWVgIGJlY2F1c2UgaXQgbm9vcHNcbiAgICAvLyBpZiB0aGUgcXVldWUgaXMgZW1wdHkuIFdoZW4gbXVsdGlwbGUgYW5pbWF0ZWQgY29tcG9uZW50cyBhcmUgbW91bnRlZCBhdFxuICAgIC8vIHRoZSBzYW1lIHRpbWUuIE9ubHkgZmlyc3QgY29tcG9uZW50IGZsdXNoZXMgdGhlIHF1ZXVlIGFuZCB0aGUgb3RoZXJzIHdpbGwgbm9vcC5cbiAgICBOYXRpdmVBbmltYXRlZEhlbHBlci5BUEkuZmx1c2hRdWV1ZSgpO1xuICB9KTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlzVW5tb3VudGluZ1JlZi5jdXJyZW50ID0gZmFsc2U7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGlzVW5tb3VudGluZ1JlZi5jdXJyZW50ID0gdHJ1ZTtcbiAgICB9O1xuICB9LCBbXSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBub2RlLl9fYXR0YWNoKCk7XG4gICAgbGV0IGRyaXZlbkFuaW1hdGlvbkVuZGVkTGlzdGVuZXI6ID9FdmVudFN1YnNjcmlwdGlvbiA9IG51bGw7XG5cbiAgICBpZiAobm9kZS5fX2lzTmF0aXZlKSB7XG4gICAgICBkcml2ZW5BbmltYXRpb25FbmRlZExpc3RlbmVyID1cbiAgICAgICAgTmF0aXZlQW5pbWF0ZWRIZWxwZXIubmF0aXZlRXZlbnRFbWl0dGVyLmFkZExpc3RlbmVyKFxuICAgICAgICAgICdvblVzZXJEcml2ZW5BbmltYXRpb25FbmRlZCcsXG4gICAgICAgICAgZGF0YSA9PiB7XG4gICAgICAgICAgICBub2RlLnVwZGF0ZSgpO1xuICAgICAgICAgIH0sXG4gICAgICAgICk7XG4gICAgfVxuICAgIGlmIChwcmV2Tm9kZVJlZi5jdXJyZW50ICE9IG51bGwpIHtcbiAgICAgIGNvbnN0IHByZXZOb2RlID0gcHJldk5vZGVSZWYuY3VycmVudDtcbiAgICAgIC8vIFRPRE86IFN0b3AgcmVzdG9yaW5nIGRlZmF1bHQgdmFsdWVzICh1bmxlc3MgYHJlc2V0YCBpcyBjYWxsZWQpLlxuICAgICAgcHJldk5vZGUuX19yZXN0b3JlRGVmYXVsdFZhbHVlcygpO1xuICAgICAgcHJldk5vZGUuX19kZXRhY2goKTtcbiAgICAgIHByZXZOb2RlUmVmLmN1cnJlbnQgPSBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgaWYgKGlzVW5tb3VudGluZ1JlZi5jdXJyZW50KSB7XG4gICAgICAgIC8vIE5PVEU6IERvIG5vdCByZXN0b3JlIGRlZmF1bHQgdmFsdWVzIG9uIHVubW91bnQsIHNlZSBEMTgxOTc3MzUuXG4gICAgICAgIG5vZGUuX19kZXRhY2goKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHByZXZOb2RlUmVmLmN1cnJlbnQgPSBub2RlO1xuICAgICAgfVxuXG4gICAgICBkcml2ZW5BbmltYXRpb25FbmRlZExpc3RlbmVyPy5yZW1vdmUoKTtcbiAgICB9O1xuICB9LCBbbm9kZV0pO1xufVxuXG5mdW5jdGlvbiBnZXRFdmVudFRhcmdldDxUSW5zdGFuY2U+KGluc3RhbmNlOiBUSW5zdGFuY2UpOiBUSW5zdGFuY2Uge1xuICByZXR1cm4gdHlwZW9mIGluc3RhbmNlID09PSAnb2JqZWN0JyAmJlxuICAgIHR5cGVvZiBpbnN0YW5jZT8uZ2V0U2Nyb2xsYWJsZU5vZGUgPT09ICdmdW5jdGlvbidcbiAgICA/IC8vICRGbG93Rml4TWVbaW5jb21wYXRpYmxlLXVzZV0gLSBMZWdhY3kgaW5zdGFuY2UgYXNzdW1wdGlvbnMuXG4gICAgICBpbnN0YW5jZS5nZXRTY3JvbGxhYmxlTm9kZSgpXG4gICAgOiBpbnN0YW5jZTtcbn1cblxuLy8gJEZsb3dGaXhNZVt1bmNsZWFyLXR5cGVdIC0gTGVnYWN5IGluc3RhbmNlIGFzc3VtcHRpb25zLlxuZnVuY3Rpb24gaXNGYWJyaWNJbnN0YW5jZShpbnN0YW5jZTogYW55KTogYm9vbGVhbiB7XG4gIHJldHVybiAoXG4gICAgaXNGYWJyaWNQdWJsaWNJbnN0YW5jZShpbnN0YW5jZSkgfHxcbiAgICAvLyBTb21lIGNvbXBvbmVudHMgaGF2ZSBhIHNldE5hdGl2ZVByb3BzIGZ1bmN0aW9uIGJ1dCBhcmVuJ3QgYSBob3N0IGNvbXBvbmVudFxuICAgIC8vIHN1Y2ggYXMgbGlzdHMgbGlrZSBGbGF0TGlzdCBhbmQgU2VjdGlvbkxpc3QuIFRoZXNlIHNob3VsZCBhbHNvIHVzZVxuICAgIC8vIGZvcmNlVXBkYXRlIGluIEZhYnJpYyBzaW5jZSBzZXROYXRpdmVQcm9wcyBkb2Vzbid0IGV4aXN0IG9uIHRoZSB1bmRlcmx5aW5nXG4gICAgLy8gaG9zdCBjb21wb25lbnQuIFRoaXMgY3JhenkgaGFjayBpcyBlc3NlbnRpYWxseSBzcGVjaWFsIGNhc2luZyB0aG9zZSBsaXN0cyBhbmRcbiAgICAvLyBTY3JvbGxWaWV3IGl0c2VsZiB0byB1c2UgZm9yY2VVcGRhdGUgaW4gRmFicmljLlxuICAgIC8vIElmIHRoZXNlIGNvbXBvbmVudHMgZW5kIHVwIHVzaW5nIGZvcndhcmRSZWYgdGhlbiB0aGVzZSBoYWNrcyBjYW4gZ28gYXdheVxuICAgIC8vIGFzIGluc3RhbmNlIHdvdWxkIGFjdHVhbGx5IGJlIHRoZSB1bmRlcmx5aW5nIGhvc3QgY29tcG9uZW50IGFuZCB0aGUgYWJvdmUgY2hlY2tcbiAgICAvLyB3b3VsZCBiZSBzdWZmaWNpZW50LlxuICAgIGlzRmFicmljUHVibGljSW5zdGFuY2UoaW5zdGFuY2U/LmdldE5hdGl2ZVNjcm9sbFJlZj8uKCkpIHx8XG4gICAgaXNGYWJyaWNQdWJsaWNJbnN0YW5jZShcbiAgICAgIGluc3RhbmNlPy5nZXRTY3JvbGxSZXNwb25kZXI/LigpPy5nZXROYXRpdmVTY3JvbGxSZWY/LigpLFxuICAgIClcbiAgKTtcbn1cbiJdLCJtYXBwaW5ncyI6IkFBVUEsWUFBWTs7QUFBQyxJQUFBQSxzQkFBQSxHQUFBQyxP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