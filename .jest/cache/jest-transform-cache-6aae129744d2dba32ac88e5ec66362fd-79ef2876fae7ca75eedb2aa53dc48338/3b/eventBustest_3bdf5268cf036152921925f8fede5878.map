{"version":3,"names":["_eventBus","require","describe","beforeEach","eventBus","listeners","Object","keys","forEach","key","it","callback","jest","fn","unsubscribe","subscribe","expect","toBe","callback1","callback2","emit","toHaveBeenCalledWith","toHaveBeenCalledTimes","not","toThrow","callback3","toHaveBeenCalled","testData","id","message","array","undefined","errorCallback","Error","normalCallback","consoleSpy","spyOn","console","mockImplementation","mockRestore","unsubscribe1","unsubscribe2","progressCallback","achievementCallback","level","score","type","value","settingsCallback","themeCallback","theme","language"],"sources":["eventBus.test.js"],"sourcesContent":["// __tests__/utils/eventBus.test.js\nimport { subscribe, emit } from '../../src/utils/eventBus';\n\ndescribe('eventBus', () => {\n  beforeEach(() => {\n    // Reset listeners avant chaque test\n    const eventBus = require('../../src/utils/eventBus');\n    // Accéder aux listeners internes pour les nettoyer\n    const listeners = eventBus.listeners || {};\n    Object.keys(listeners).forEach(key => delete listeners[key]);\n  });\n\n  describe('subscribe', () => {\n    it('devrait permettre de s\\'abonner à un événement', () => {\n      const callback = jest.fn();\n      const unsubscribe = subscribe('test-event', callback);\n\n      expect(typeof unsubscribe).toBe('function');\n    });\n\n    it('devrait permettre plusieurs abonnements au même événement', () => {\n      const callback1 = jest.fn();\n      const callback2 = jest.fn();\n\n      subscribe('test-event', callback1);\n      subscribe('test-event', callback2);\n\n      emit('test-event', 'test-data');\n\n      expect(callback1).toHaveBeenCalledWith('test-data');\n      expect(callback2).toHaveBeenCalledWith('test-data');\n    });\n\n    it('devrait retourner une fonction de désabonnement', () => {\n      const callback = jest.fn();\n      const unsubscribe = subscribe('test-event', callback);\n\n      emit('test-event', 'test-data');\n      expect(callback).toHaveBeenCalledTimes(1);\n\n      unsubscribe();\n      emit('test-event', 'test-data-2');\n      expect(callback).toHaveBeenCalledTimes(1); // Pas appelé après unsubscribe\n    });\n\n    it('devrait gérer les désabonnements multiples sans erreur', () => {\n      const callback = jest.fn();\n      const unsubscribe = subscribe('test-event', callback);\n\n      unsubscribe();\n      expect(() => unsubscribe()).not.toThrow();\n    });\n  });\n\n  describe('emit', () => {\n    it('devrait émettre un événement vers les abonnés', () => {\n      const callback = jest.fn();\n      subscribe('test-event', callback);\n\n      emit('test-event', 'test-data');\n\n      expect(callback).toHaveBeenCalledWith('test-data');\n      expect(callback).toHaveBeenCalledTimes(1);\n    });\n\n    it('devrait émettre vers tous les abonnés', () => {\n      const callback1 = jest.fn();\n      const callback2 = jest.fn();\n      const callback3 = jest.fn();\n\n      subscribe('test-event', callback1);\n      subscribe('test-event', callback2);\n      subscribe('other-event', callback3);\n\n      emit('test-event', 'test-data');\n\n      expect(callback1).toHaveBeenCalledWith('test-data');\n      expect(callback2).toHaveBeenCalledWith('test-data');\n      expect(callback3).not.toHaveBeenCalled();\n    });\n\n    it('devrait gérer l\\'émission d\\'événements sans abonnés', () => {\n      expect(() => {\n        emit('non-existent-event', 'data');\n      }).not.toThrow();\n    });\n\n    it('devrait passer les données correctement', () => {\n      const callback = jest.fn();\n      subscribe('test-event', callback);\n\n      const testData = { id: 1, message: 'hello', array: [1, 2, 3] };\n      emit('test-event', testData);\n\n      expect(callback).toHaveBeenCalledWith(testData);\n    });\n\n    it('devrait gérer les données undefined et null', () => {\n      const callback = jest.fn();\n      subscribe('test-event', callback);\n\n      emit('test-event', undefined);\n      expect(callback).toHaveBeenCalledWith(undefined);\n\n      emit('test-event', null);\n      expect(callback).toHaveBeenCalledWith(null);\n    });\n  });\n\n  describe('Gestion des erreurs', () => {\n    it('devrait continuer même si un callback lève une erreur', () => {\n      const errorCallback = jest.fn(() => {\n        throw new Error('Test error');\n      });\n      const normalCallback = jest.fn();\n\n      subscribe('test-event', errorCallback);\n      subscribe('test-event', normalCallback);\n\n      // Mock console.error pour éviter les logs de test\n      const consoleSpy = jest.spyOn(console, 'error').mockImplementation();\n\n      expect(() => {\n        emit('test-event', 'data');\n      }).not.toThrow();\n\n      expect(errorCallback).toHaveBeenCalled();\n      expect(normalCallback).toHaveBeenCalled();\n\n      consoleSpy.mockRestore();\n    });\n  });\n\n  describe('Gestion mémoire', () => {\n    it('devrait nettoyer correctement les listeners', () => {\n      const callback1 = jest.fn();\n      const callback2 = jest.fn();\n      const callback3 = jest.fn();\n\n      const unsubscribe1 = subscribe('event1', callback1);\n      const unsubscribe2 = subscribe('event1', callback2);\n      subscribe('event2', callback3);\n\n      // Désabonner callback1\n      unsubscribe1();\n\n      emit('event1', 'data');\n      expect(callback1).not.toHaveBeenCalled();\n      expect(callback2).toHaveBeenCalled();\n\n      // Désabonner callback2\n      unsubscribe2();\n\n      emit('event1', 'data2');\n      expect(callback2).toHaveBeenCalledTimes(1); // Pas appelé à nouveau\n    });\n\n    it('devrait gérer les événements avec des noms similaires', () => {\n      const callback1 = jest.fn();\n      const callback2 = jest.fn();\n\n      subscribe('user-login', callback1);\n      subscribe('user-logout', callback2);\n\n      emit('user-login', 'login-data');\n      expect(callback1).toHaveBeenCalledWith('login-data');\n      expect(callback2).not.toHaveBeenCalled();\n\n      emit('user-logout', 'logout-data');\n      expect(callback2).toHaveBeenCalledWith('logout-data');\n      expect(callback1).toHaveBeenCalledTimes(1);\n    });\n  });\n\n  describe('Cas d\\'usage réels', () => {\n    it('devrait gérer un scénario de progression utilisateur', () => {\n      const progressCallback = jest.fn();\n      const achievementCallback = jest.fn();\n\n      subscribe('progress-updated', progressCallback);\n      subscribe('achievement-unlocked', achievementCallback);\n\n      // Simulation progression\n      emit('progress-updated', { level: 1, score: 85 });\n      expect(progressCallback).toHaveBeenCalledWith({ level: 1, score: 85 });\n\n      // Simulation achievement\n      emit('achievement-unlocked', { type: 'streak', value: 7 });\n      expect(achievementCallback).toHaveBeenCalledWith({ type: 'streak', value: 7 });\n    });\n\n    it('devrait gérer un scénario de settings mis à jour', () => {\n      const settingsCallback = jest.fn();\n      const themeCallback = jest.fn();\n\n      subscribe('settings-updated', settingsCallback);\n      subscribe('theme-changed', themeCallback);\n\n      emit('settings-updated', { theme: 'dark', language: 'fr' });\n      emit('theme-changed', 'dark');\n\n      expect(settingsCallback).toHaveBeenCalledWith({ theme: 'dark', language: 'fr' });\n      expect(themeCallback).toHaveBeenCalledWith('dark');\n    });\n  });\n});"],"mappings":"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","ignoreList":[]}