{"version":3,"names":["_react","require","_asyncStorage","_interopRequireDefault","METRICS_STORAGE_KEY","useActivityMetrics","_useState","useState","_useState2","_slicedToArray2","default","currentStreak","setCurrentStreak","_useState3","_useState4","todayMinutes","setTodayMinutes","_useState5","_useState6","sessionStart","setSessionStart","_useState7","_useState8","isLoading","setIsLoading","_useState9","_useState0","metrics","setMetrics","getTodayString","Date","toDateString","loadMetrics","_ref","_asyncToGenerator2","stored","AsyncStorage","getItem","JSON","parse","error","apply","arguments","useEffect","startSession","useCallback","now","endSession","sessionEnd","sessionMinutes","Math","round","newTodayTotal","today","Promise","all","setItem","toString","updateStreak","lastDate","yesterday","setDate","getDate","isYesterday","newStreak","getStreakTrend","getFormattedTime","hours","floor","mins","streakTrend","formattedTime","_default","exports"],"sources":["useActivityMetrics.js"],"sourcesContent":["// src/hooks/useActivityMetrics.js - TEMPS QUOTIDIEN\n\nimport { useState, useEffect, useCallback } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\n\nconst METRICS_STORAGE_KEY = 'activity_metrics';\n\nconst useActivityMetrics = () => {\n  const [currentStreak, setCurrentStreak] = useState(0);\n  const [todayMinutes, setTodayMinutes] = useState(0); // ✅ CHANGÉ : quotidien\n  const [sessionStart, setSessionStart] = useState(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [metrics, setMetrics] = useState({});\n\n  // =================== DATES HELPER ===================\n  const getTodayString = () => new Date().toDateString();\n\n  const loadMetrics = async () => {\n    try {\n      setIsLoading(true);\n      const stored = await AsyncStorage.getItem(METRICS_STORAGE_KEY);\n      if (stored) {\n        setMetrics(JSON.parse(stored));\n      }\n    } catch (error) {\n      // Ignored on purpose\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // =================== CHARGEMENT INITIAL ===================\n  useEffect(() => {\n    loadMetrics();\n  }, []);\n\n  // =================== SESSION TIMER ===================\n  const startSession = useCallback(() => {\n    setSessionStart(Date.now());\n  }, []);\n\n  const endSession = useCallback(async () => {\n    if (!sessionStart) return;\n\n    try {\n      const sessionEnd = Date.now();\n      const sessionMinutes = Math.round((sessionEnd - sessionStart) / 60000);\n\n      if (sessionMinutes > 0) {\n        const newTodayTotal = todayMinutes + sessionMinutes;\n        setTodayMinutes(newTodayTotal);\n        \n        const today = getTodayString();\n        await Promise.all([\n          AsyncStorage.setItem('today_minutes', newTodayTotal.toString()),\n          AsyncStorage.setItem('last_time_date', today)\n        ]);\n      }\n\n      setSessionStart(null);\n    } catch (error) {\n      // Silently fail\n    }\n  }, [sessionStart, todayMinutes]);\n\n  // =================== STREAK LOGIC ===================\n  const updateStreak = useCallback(async () => {\n    try {\n      const today = getTodayString();\n      const lastDate = await AsyncStorage.getItem('last_activity_date');\n      \n      if (lastDate !== today) {\n        const yesterday = new Date();\n        yesterday.setDate(yesterday.getDate() - 1);\n        const isYesterday = lastDate === yesterday.toDateString();\n        \n        let newStreak = 0;\n        if (isYesterday) {\n          newStreak = currentStreak + 1;\n        } else {\n          newStreak = 1;\n        }\n        \n        setCurrentStreak(newStreak);\n        await Promise.all([\n          AsyncStorage.setItem('current_streak', newStreak.toString()),\n          AsyncStorage.setItem('last_activity_date', today)\n        ]);\n      }\n    } catch (error) {\n      // Silently fail\n    }\n  }, [currentStreak]);\n\n  // =================== GETTERS ===================\n  const getStreakTrend = useCallback(() => {\n    if (currentStreak >= 7) return '🏆 Incroyable!';\n    if (currentStreak >= 3) return '💪 En forme!';\n    if (currentStreak >= 1) return '🔥 Continue!';\n    return null;\n  }, [currentStreak]);\n\n  const getFormattedTime = useCallback(() => {\n    if (todayMinutes < 60) {\n      return `${todayMinutes}min`;\n    } else {\n      const hours = Math.floor(todayMinutes / 60);\n      const mins = todayMinutes % 60;\n      return `${hours}h${mins > 0 ? `${mins}min` : ''}`;\n    }\n  }, [todayMinutes]);\n\n  return {\n    startSession,\n    endSession,\n    updateStreak,\n    isLoading,\n    metrics,\n    currentStreak: currentStreak || 0,\n    todayMinutes: todayMinutes || 0, // ✅ CHANGÉ : quotidien\n    streakTrend: getStreakTrend(),\n    formattedTime: getFormattedTime() || '0min',\n  };\n};\n\nexport default useActivityMetrics;"],"mappings":"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","ignoreList":[]}