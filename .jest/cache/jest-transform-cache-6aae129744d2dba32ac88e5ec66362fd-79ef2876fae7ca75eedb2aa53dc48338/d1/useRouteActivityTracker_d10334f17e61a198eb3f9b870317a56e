f9b10fa89eeb61c509d725408130bf60
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _react = require("react");
var _expoRouter = require("expo-router");
var _useActivityMetrics2 = _interopRequireDefault(require("./useActivityMetrics"));
var useRouteActivityTracker = function useRouteActivityTracker() {
  var segments = (0, _expoRouter.useSegments)();
  var pathname = (0, _expoRouter.usePathname)();
  var _useActivityMetrics = (0, _useActivityMetrics2.default)(),
    startSession = _useActivityMetrics.startSession,
    endSession = _useActivityMetrics.endSession,
    updateStreak = _useActivityMetrics.updateStreak;
  var currentSessionRef = (0, _react.useRef)(null);
  var isTrackingRef = (0, _react.useRef)(false);
  var lastPathnameRef = (0, _react.useRef)(null);
  (0, _react.useEffect)(function () {
    if (lastPathnameRef.current === pathname) {
      return;
    }
    lastPathnameRef.current = pathname;
    var isExercise = segments.some(function (segment) {
      return segment.includes('Exercise') || segment.includes('exercise') || segment.includes('Assessment') || segment.includes('assessment');
    });
    if (isExercise) {
      var exerciseType = segments[segments.length - 1];
      if (!isTrackingRef.current || currentSessionRef.current !== exerciseType) {
        if (isTrackingRef.current) {
          try {
            endSession();
            updateStreak();
          } catch (error) {
            console.warn('Erreur lors de la fin de session:', error);
          }
        }
        try {
          isTrackingRef.current = true;
          currentSessionRef.current = exerciseType;
          startSession(exerciseType);
        } catch (error) {
          console.warn('Erreur lors du d√©marrage de session:', error);
          isTrackingRef.current = false;
          currentSessionRef.current = null;
        }
      }
    } else {
      if (isTrackingRef.current) {
        try {
          isTrackingRef.current = false;
          currentSessionRef.current = null;
          endSession();
          updateStreak();
        } catch (error) {
          console.warn('Erreur lors de la fin de session:', error);
        }
      }
    }
    return function () {
      if (isTrackingRef.current) {
        try {
          isTrackingRef.current = false;
          currentSessionRef.current = null;
          endSession();
        } catch (error) {
          console.warn('Erreur lors du cleanup:', error);
        }
      }
    };
  }, [segments, pathname]);
  (0, _react.useEffect)(function () {
    return function () {
      if (isTrackingRef.current) {
        try {
          endSession();
        } catch (error) {
          console.warn('Erreur lors du cleanup final:', error);
        }
      }
    };
  }, []);
};
var _default = exports.default = useRouteActivityTracker;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJyZXF1aXJlIiwiX2V4cG9Sb3V0ZXIiLCJfdXNlQWN0aXZpdHlNZXRyaWNzMiIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJ1c2VSb3V0ZUFjdGl2aXR5VHJhY2tlciIsInNlZ21lbnRzIiwidXNlU2VnbWVudHMiLCJwYXRobmFtZSIsInVzZVBhdGhuYW1lIiwiX3VzZUFjdGl2aXR5TWV0cmljcyIsInVzZUFjdGl2aXR5TWV0cmljcyIsInN0YXJ0U2Vzc2lvbiIsImVuZFNlc3Npb24iLCJ1cGRhdGVTdHJlYWsiLCJjdXJyZW50U2Vzc2lvblJlZiIsInVzZVJlZiIsImlzVHJhY2tpbmdSZWYiLCJsYXN0UGF0aG5hbWVSZWYiLCJ1c2VFZmZlY3QiLCJjdXJyZW50IiwiaXNFeGVyY2lzZSIsInNvbWUiLCJzZWdtZW50IiwiaW5jbHVkZXMiLCJleGVyY2lzZVR5cGUiLCJsZW5ndGgiLCJlcnJvciIsImNvbnNvbGUiLCJ3YXJuIiwiX2RlZmF1bHQiLCJleHBvcnRzIiwiZGVmYXVsdCJdLCJzb3VyY2VzIjpbInVzZVJvdXRlQWN0aXZpdHlUcmFja2VyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9ob29rcy91c2VSb3V0ZUFjdGl2aXR5VHJhY2tlci5qcyAtIFZFUlNJT04gQ09SUklHw4lFIFNBTlMgQk9VQ0xFXHJcbmltcG9ydCB7IHVzZUVmZmVjdCwgdXNlUmVmIH0gZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgeyB1c2VTZWdtZW50cywgdXNlUGF0aG5hbWUgfSBmcm9tICdleHBvLXJvdXRlcic7XHJcbmltcG9ydCB1c2VBY3Rpdml0eU1ldHJpY3MgZnJvbSAnLi91c2VBY3Rpdml0eU1ldHJpY3MnO1xyXG5cclxuY29uc3QgdXNlUm91dGVBY3Rpdml0eVRyYWNrZXIgPSAoKSA9PiB7XHJcbiAgY29uc3Qgc2VnbWVudHMgPSB1c2VTZWdtZW50cygpO1xyXG4gIGNvbnN0IHBhdGhuYW1lID0gdXNlUGF0aG5hbWUoKTtcclxuICBjb25zdCB7IHN0YXJ0U2Vzc2lvbiwgZW5kU2Vzc2lvbiwgdXBkYXRlU3RyZWFrIH0gPSB1c2VBY3Rpdml0eU1ldHJpY3MoKTtcclxuICBcclxuICAvLyDinIUgQ09SUkVDVElPTiA6IFJlZnMgcG91ciDDqXZpdGVyIGxlcyBhcHBlbHMgZW4gYm91Y2xlXHJcbiAgY29uc3QgY3VycmVudFNlc3Npb25SZWYgPSB1c2VSZWYobnVsbCk7XHJcbiAgY29uc3QgaXNUcmFja2luZ1JlZiA9IHVzZVJlZihmYWxzZSk7XHJcbiAgY29uc3QgbGFzdFBhdGhuYW1lUmVmID0gdXNlUmVmKG51bGwpO1xyXG5cclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgLy8g4pyFIENPUlJFQ1RJT04gOiBFdml0ZXIgbGVzIHJlLWTDqWNsZW5jaGVtZW50cyBpbnV0aWxlc1xyXG4gICAgaWYgKGxhc3RQYXRobmFtZVJlZi5jdXJyZW50ID09PSBwYXRobmFtZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsYXN0UGF0aG5hbWVSZWYuY3VycmVudCA9IHBhdGhuYW1lO1xyXG5cclxuICAgIC8vIFbDqXJpZmllciBzaSBjJ2VzdCB1biBleGVyY2ljZVxyXG4gICAgY29uc3QgaXNFeGVyY2lzZSA9IHNlZ21lbnRzLnNvbWUoc2VnbWVudCA9PiBcclxuICAgICAgc2VnbWVudC5pbmNsdWRlcygnRXhlcmNpc2UnKSB8fFxyXG4gICAgICBzZWdtZW50LmluY2x1ZGVzKCdleGVyY2lzZScpIHx8XHJcbiAgICAgIHNlZ21lbnQuaW5jbHVkZXMoJ0Fzc2Vzc21lbnQnKSB8fFxyXG4gICAgICBzZWdtZW50LmluY2x1ZGVzKCdhc3Nlc3NtZW50JylcclxuICAgICk7XHJcblxyXG4gICAgaWYgKGlzRXhlcmNpc2UpIHtcclxuICAgICAgLy8gUsOpY3Vww6lyZXIgbGUgdHlwZSBkJ2V4ZXJjaWNlIChkZXJuaWVyIHNlZ21lbnQpXHJcbiAgICAgIGNvbnN0IGV4ZXJjaXNlVHlwZSA9IHNlZ21lbnRzW3NlZ21lbnRzLmxlbmd0aCAtIDFdO1xyXG4gICAgICBcclxuICAgICAgLy8g4pyFIENPUlJFQ1RJT04gOiBMb2dpcXVlIGRpcmVjdGUgc2FucyBjYWxsYmFja3NcclxuICAgICAgaWYgKCFpc1RyYWNraW5nUmVmLmN1cnJlbnQgfHwgY3VycmVudFNlc3Npb25SZWYuY3VycmVudCAhPT0gZXhlcmNpc2VUeXBlKSB7XHJcbiAgICAgICAgLy8gQXJyw6p0ZXIgbGEgc2Vzc2lvbiBwcsOpY8OpZGVudGUgc2kgZWxsZSBleGlzdGVcclxuICAgICAgICBpZiAoaXNUcmFja2luZ1JlZi5jdXJyZW50KSB7XHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBlbmRTZXNzaW9uKCk7XHJcbiAgICAgICAgICAgIHVwZGF0ZVN0cmVhaygpO1xyXG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS53YXJuKCdFcnJldXIgbG9ycyBkZSBsYSBmaW4gZGUgc2Vzc2lvbjonLCBlcnJvcik7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIETDqW1hcnJlciBsYSBub3V2ZWxsZSBzZXNzaW9uXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGlzVHJhY2tpbmdSZWYuY3VycmVudCA9IHRydWU7XHJcbiAgICAgICAgICBjdXJyZW50U2Vzc2lvblJlZi5jdXJyZW50ID0gZXhlcmNpc2VUeXBlO1xyXG4gICAgICAgICAgc3RhcnRTZXNzaW9uKGV4ZXJjaXNlVHlwZSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgIGNvbnNvbGUud2FybignRXJyZXVyIGxvcnMgZHUgZMOpbWFycmFnZSBkZSBzZXNzaW9uOicsIGVycm9yKTtcclxuICAgICAgICAgIGlzVHJhY2tpbmdSZWYuY3VycmVudCA9IGZhbHNlO1xyXG4gICAgICAgICAgY3VycmVudFNlc3Npb25SZWYuY3VycmVudCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBTaSBvbiBuJ2VzdCBwbHVzIHN1ciB1biBleGVyY2ljZSwgYXJyw6p0ZXIgbGEgc2Vzc2lvblxyXG4gICAgICBpZiAoaXNUcmFja2luZ1JlZi5jdXJyZW50KSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGlzVHJhY2tpbmdSZWYuY3VycmVudCA9IGZhbHNlO1xyXG4gICAgICAgICAgY3VycmVudFNlc3Npb25SZWYuY3VycmVudCA9IG51bGw7XHJcbiAgICAgICAgICBlbmRTZXNzaW9uKCk7XHJcbiAgICAgICAgICB1cGRhdGVTdHJlYWsoKTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS53YXJuKCdFcnJldXIgbG9ycyBkZSBsYSBmaW4gZGUgc2Vzc2lvbjonLCBlcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8g4pyFIENPUlJFQ1RJT04gOiBDbGVhbnVwIHVuaXF1ZSBldCBzdGFibGVcclxuICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgIGlmIChpc1RyYWNraW5nUmVmLmN1cnJlbnQpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgaXNUcmFja2luZ1JlZi5jdXJyZW50ID0gZmFsc2U7XHJcbiAgICAgICAgICBjdXJyZW50U2Vzc2lvblJlZi5jdXJyZW50ID0gbnVsbDtcclxuICAgICAgICAgIGVuZFNlc3Npb24oKTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS53YXJuKCdFcnJldXIgbG9ycyBkdSBjbGVhbnVwOicsIGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgLy8gU3VwcHJlc3Npb24gZHUgcmV0dXJuIG51bGwgKGF1Y3VuIHJldHVybiBhdHRlbmR1KVxyXG4gICAgfTtcclxuICB9LCBbc2VnbWVudHMsIHBhdGhuYW1lXSk7IC8vIOKchSBDT1JSSUfDiSA6IFNldWxlbWVudCBsZXMgdnJhaWVzIGTDqXBlbmRhbmNlc1xyXG5cclxuICAvLyDinIUgQ09SUkVDVElPTiA6IENsZWFudXAgZmluYWwgc2V1bGVtZW50IGF1IGTDqW1vbnRhZ2VcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgaWYgKGlzVHJhY2tpbmdSZWYuY3VycmVudCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBlbmRTZXNzaW9uKCk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgIGNvbnNvbGUud2FybignRXJyZXVyIGxvcnMgZHUgY2xlYW51cCBmaW5hbDonLCBlcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH0sIFtdKTsgLy8g4pyFIENPUlJJR8OJIDogQXVjdW5lIGTDqXBlbmRhbmNlID0gc2V1bGVtZW50IGF1IGTDqW1vbnRhZ2VcclxuXHJcbiAgLy8gUGFzIGRlIHJlbmR1XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCB1c2VSb3V0ZUFjdGl2aXR5VHJhY2tlcjsiXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsSUFBQUEsTUFBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsV0FBQSxHQUFBRCxPQUFBO0FBQ0EsSUFBQUUsb0JBQUEsR0FBQUMsc0JBQUEsQ0FBQUgsT0FBQTtBQUVBLElBQU1JLHVCQUF1QixHQUFHLFNBQTFCQSx1QkFBdUJBLENBQUEsRUFBUztFQUNwQyxJQUFNQyxRQUFRLEdBQUcsSUFBQUMsdUJBQVcsRUFBQyxDQUFDO0VBQzlCLElBQU1DLFFBQVEsR0FBRyxJQUFBQyx1QkFBVyxFQUFDLENBQUM7RUFDOUIsSUFBQUMsbUJBQUEsR0FBbUQsSUFBQUMsNEJBQWtCLEVBQUMsQ0FBQztJQUEvREMsWUFBWSxHQUFBRixtQkFBQSxDQUFaRSxZQUFZO0lBQUVDLFVBQVUsR0FBQUgsbUJBQUEsQ0FBVkcsVUFBVTtJQUFFQyxZQUFZLEdBQUFKLG1CQUFBLENBQVpJLFlBQVk7RUFHOUMsSUFBTUMsaUJBQWlCLEdBQUcsSUFBQUMsYUFBTSxFQUFDLElBQUksQ0FBQztFQUN0QyxJQUFNQyxhQUFhLEdBQUcsSUFBQUQsYUFBTSxFQUFDLEtBQUssQ0FBQztFQUNuQyxJQUFNRSxlQUFlLEdBQUcsSUFBQUYsYUFBTSxFQUFDLElBQUksQ0FBQztFQUVwQyxJQUFBRyxnQkFBUyxFQUFDLFlBQU07SUFFZCxJQUFJRCxlQUFlLENBQUNFLE9BQU8sS0FBS1osUUFBUSxFQUFFO01BQ3hDO0lBQ0Y7SUFDQVUsZUFBZSxDQUFDRSxPQUFPLEdBQUdaLFFBQVE7SUFHbEMsSUFBTWEsVUFBVSxHQUFHZixRQUFRLENBQUNnQixJQUFJLENBQUMsVUFBQUMsT0FBTztNQUFBLE9BQ3RDQSxPQUFPLENBQUNDLFFBQVEsQ0FBQyxVQUFVLENBQUMsSUFDNUJELE9BQU8sQ0FBQ0MsUUFBUSxDQUFDLFVBQVUsQ0FBQyxJQUM1QkQsT0FBTyxDQUFDQyxRQUFRLENBQUMsWUFBWSxDQUFDLElBQzlCRCxPQUFPLENBQUNDLFFBQVEsQ0FBQyxZQUFZLENBQUM7SUFBQSxDQUNoQyxDQUFDO0lBRUQsSUFBSUgsVUFBVSxFQUFFO01BRWQsSUFBTUksWUFBWSxHQUFHbkIsUUFBUSxDQUFDQSxRQUFRLENBQUNvQixNQUFNLEdBQUcsQ0FBQyxDQUFDO01BR2xELElBQUksQ0FBQ1QsYUFBYSxDQUFDRyxPQUFPLElBQUlMLGlCQUFpQixDQUFDSyxPQUFPLEtBQUtLLFlBQVksRUFBRTtRQUV4RSxJQUFJUixhQUFhLENBQUNHLE9BQU8sRUFBRTtVQUN6QixJQUFJO1lBQ0ZQLFVBQVUsQ0FBQyxDQUFDO1lBQ1pDLFlBQVksQ0FBQyxDQUFDO1VBQ2hCLENBQUMsQ0FBQyxPQUFPYSxLQUFLLEVBQUU7WUFDZEMsT0FBTyxDQUFDQyxJQUFJLENBQUMsbUNBQW1DLEVBQUVGLEtBQUssQ0FBQztVQUMxRDtRQUNGO1FBR0EsSUFBSTtVQUNGVixhQUFhLENBQUNHLE9BQU8sR0FBRyxJQUFJO1VBQzVCTCxpQkFBaUIsQ0FBQ0ssT0FBTyxHQUFHSyxZQUFZO1VBQ3hDYixZQUFZLENBQUNhLFlBQVksQ0FBQztRQUM1QixDQUFDLENBQUMsT0FBT0UsS0FBSyxFQUFFO1VBQ2RDLE9BQU8sQ0FBQ0MsSUFBSSxDQUFDLHNDQUFzQyxFQUFFRixLQUFLLENBQUM7VUFDM0RWLGFBQWEsQ0FBQ0csT0FBTyxHQUFHLEtBQUs7VUFDN0JMLGlCQUFpQixDQUFDSyxPQUFPLEdBQUcsSUFBSTtRQUNsQztNQUNGO0lBQ0YsQ0FBQyxNQUFNO01BRUwsSUFBSUgsYUFBYSxDQUFDRyxPQUFPLEVBQUU7UUFDekIsSUFBSTtVQUNGSCxhQUFhLENBQUNHLE9BQU8sR0FBRyxLQUFLO1VBQzdCTCxpQkFBaUIsQ0FBQ0ssT0FBTyxHQUFHLElBQUk7VUFDaENQLFVBQVUsQ0FBQyxDQUFDO1VBQ1pDLFlBQVksQ0FBQyxDQUFDO1FBQ2hCLENBQUMsQ0FBQyxPQUFPYSxLQUFLLEVBQUU7VUFDZEMsT0FBTyxDQUFDQyxJQUFJLENBQUMsbUNBQW1DLEVBQUVGLEtBQUssQ0FBQztRQUMxRDtNQUNGO0lBQ0Y7SUFHQSxPQUFPLFlBQU07TUFDWCxJQUFJVixhQUFhLENBQUNHLE9BQU8sRUFBRTtRQUN6QixJQUFJO1VBQ0ZILGFBQWEsQ0FBQ0csT0FBTyxHQUFHLEtBQUs7VUFDN0JMLGlCQUFpQixDQUFDSyxPQUFPLEdBQUcsSUFBSTtVQUNoQ1AsVUFBVSxDQUFDLENBQUM7UUFDZCxDQUFDLENBQUMsT0FBT2MsS0FBSyxFQUFFO1VBQ2RDLE9BQU8sQ0FBQ0MsSUFBSSxDQUFDLHlCQUF5QixFQUFFRixLQUFLLENBQUM7UUFDaEQ7TUFDRjtJQUVGLENBQUM7RUFDSCxDQUFDLEVBQUUsQ0FBQ3JCLFFBQVEsRUFBRUUsUUFBUSxDQUFDLENBQUM7RUFHeEIsSUFBQVcsZ0JBQVMsRUFBQyxZQUFNO0lBQ2QsT0FBTyxZQUFNO01BQ1gsSUFBSUYsYUFBYSxDQUFDRyxPQUFPLEVBQUU7UUFDekIsSUFBSTtVQUNGUCxVQUFVLENBQUMsQ0FBQztRQUNkLENBQUMsQ0FBQyxPQUFPYyxLQUFLLEVBQUU7VUFDZEMsT0FBTyxDQUFDQyxJQUFJLENBQUMsK0JBQStCLEVBQUVGLEtBQUssQ0FBQztRQUN0RDtNQUNGO0lBQ0YsQ0FBQztFQUNILENBQUMsRUFBRSxFQUFFLENBQUM7QUFHUixDQUFDO0FBQUMsSUFBQUcsUUFBQSxHQUFBQyxPQUFBLENBQUFDLE9BQUEsR0FFYTNCLHVCQUF1QiIsImlnbm9yZUxpc3QiOltdfQ==