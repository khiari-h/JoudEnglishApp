{"version":3,"names":["_getJestObj","mock","Object","assign","jest","requireActual","useFocusEffect","fn","callback","router","push","useDashboardState","showLevelProgress","setShowLevelProgress","openLevelProgressModal","closeLevelProgressModal","refreshing","activeTab","setActiveTab","onRefresh","mockResolvedValue","lastActivity","isLoading","reload","getLevelProgress","refresh","useProgress","progress","overall","levels","updateProgress","mockUpdateProgress","getProgressForLevel","_interopRequireDefault","require","_asyncToGenerator2","_react","_reactNative","_expoRouter","_Dashboard","_ProgressContext","_ThemeContext","_CurrentLevelContext","_jsxRuntime","_require","FakeExerciseScreen","_ref","onComplete","handleComplete","jsx","onClick","children","describe","beforeEach","clearAllMocks","it","default","_render","render","ThemeProvider","ProgressProvider","CurrentLevelProvider","getByTestId","rerender","fireEvent","click","waitFor","expect","toHaveBeenCalledWith","toHaveBeenCalledTimes"],"sources":["progress-update.test.js"],"sourcesContent":["// __tests__/integration/progress-update.test.js\nimport React from 'react';\nimport { render, fireEvent, waitFor } from '@testing-library/react-native';\nimport { router } from 'expo-router';\nimport Dashboard from '../../src/screens/Dashboard';\nimport { ProgressProvider, useProgress } from '../../src/contexts/ProgressContext';\nimport { ThemeProvider } from '../../src/contexts/ThemeContext';\nimport { CurrentLevelProvider } from '../../src/contexts/CurrentLevelContext';\n\n// Mock de expo-router\njest.mock('expo-router', () => ({\n  ...jest.requireActual('expo-router'),\n  useFocusEffect: jest.fn(callback => callback()),\n  router: {\n    push: jest.fn(),\n  },\n}));\n\n// Mocks des hooks et composants\njest.mock('../../src/screens/Dashboard/hooks/useDashboardState', () => ({\n  useDashboardState: jest.fn(() => ({\n    showLevelProgress: false,\n    setShowLevelProgress: jest.fn(),\n    openLevelProgressModal: jest.fn(),\n    closeLevelProgressModal: jest.fn(),\n    refreshing: false,\n    activeTab: \"home\",\n    setActiveTab: jest.fn(),\n    onRefresh: jest.fn().mockResolvedValue(),\n  })),\n}));\n\njest.mock('../../src/hooks/useLastActivity', () => () => ({\n  lastActivity: null,\n  isLoading: false,\n  reload: jest.fn(),\n}));\n\njest.mock('../../src/hooks/useRealTimeProgress', () => () => ({\n  getLevelProgress: jest.fn(() => 0),\n  refresh: jest.fn(),\n}));\n\nconst mockUpdateProgress = jest.fn();\n\njest.mock('../../src/contexts/ProgressContext', () => ({\n  ...jest.requireActual('../../src/contexts/ProgressContext'),\n  useProgress: () => ({\n    progress: { overall: 0, levels: {} },\n    isLoading: false,\n    updateProgress: mockUpdateProgress,\n    getProgressForLevel: () => 0,\n  }),\n}));\n\n// Composant de test pour simuler un exercice\nconst FakeExerciseScreen = ({ onComplete }) => {\n  const handleComplete = () => {\n    onComplete('A1', 'vocabulary', 80);\n  };\n\n  return (\n    <button data-testid=\"complete-exercise\" onClick={handleComplete}>\n      Terminer l'exercice\n    </button>\n  );\n};\n\ndescribe('Scénario 1: Mise à jour de la progression', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it(\"devrait appeler updateProgress avec les bonnes données après la fin d'un exercice\", async () => {\n    // NOTE: Ce test simule la fin d'un exercice et vérifie que `updateProgress` est appelé.\n    // Il ne teste pas la navigation complète, mais l'intégration entre un écran d'exercice (simulé)\n    // et le ProgressContext.\n\n    const { getByTestId, rerender } = render(\n      <ThemeProvider>\n        <ProgressProvider>\n          <CurrentLevelProvider>\n            <Dashboard />\n          </CurrentLevelProvider>\n        </ProgressProvider>\n      </ThemeProvider>\n    );\n\n    // Simuler la navigation vers un exercice\n    rerender(<FakeExerciseScreen onComplete={mockUpdateProgress} />);\n\n    // Simuler la fin de l'exercice\n    fireEvent.click(getByTestId('complete-exercise'));\n\n    // Vérifier que la mise à jour de la progression a été appelée\n    await waitFor(() => {\n      expect(mockUpdateProgress).toHaveBeenCalledWith('A1', 'vocabulary', 80);\n      expect(mockUpdateProgress).toHaveBeenCalledTimes(1);\n    });\n  });\n});"],"mappings":"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","ignoreList":[]}