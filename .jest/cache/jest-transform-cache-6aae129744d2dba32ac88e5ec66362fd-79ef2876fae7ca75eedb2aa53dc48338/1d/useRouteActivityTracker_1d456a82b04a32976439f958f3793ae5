d40087893a89d2cb3c85af2ee2ffaaa4
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _react = require("react");
var _expoRouter = require("expo-router");
var _useActivityMetrics2 = _interopRequireDefault(require("./useActivityMetrics"));
var useRouteActivityTracker = function useRouteActivityTracker() {
  var segments = (0, _expoRouter.useSegments)();
  var pathname = (0, _expoRouter.usePathname)();
  var _useActivityMetrics = (0, _useActivityMetrics2.default)(),
    startSession = _useActivityMetrics.startSession,
    endSession = _useActivityMetrics.endSession,
    updateStreak = _useActivityMetrics.updateStreak;
  var currentSessionRef = (0, _react.useRef)(null);
  var isTrackingRef = (0, _react.useRef)(false);
  var lastPathnameRef = (0, _react.useRef)(null);
  var safeExecute = function safeExecute(fn, errorMessage) {
    try {
      return fn();
    } catch (error) {
      console.warn(errorMessage, error);
      return false;
    }
  };
  var detectExercise = function detectExercise(segments) {
    return segments.some(function (segment) {
      return segment.includes('Exercise') || segment.includes('exercise') || segment.includes('Assessment') || segment.includes('assessment');
    });
  };
  var handleExerciseStart = function handleExerciseStart(exerciseType) {
    if (isTrackingRef.current && currentSessionRef.current === exerciseType) {
      return;
    }
    if (isTrackingRef.current) {
      safeExecute(function () {
        endSession();
        updateStreak();
      }, 'Erreur lors de la fin de session:');
    }
    var success = safeExecute(function () {
      startSession(exerciseType);
    }, 'Erreur lors du d√©marrage de session:');
    if (success) {
      isTrackingRef.current = true;
      currentSessionRef.current = exerciseType;
    } else {
      isTrackingRef.current = false;
      currentSessionRef.current = null;
    }
  };
  var handleExerciseEnd = function handleExerciseEnd() {
    if (!isTrackingRef.current) {
      return;
    }
    safeExecute(function () {
      endSession();
      updateStreak();
    }, 'Erreur lors de la fin de session:');
    isTrackingRef.current = false;
    currentSessionRef.current = null;
  };
  var cleanup = function cleanup() {
    if (isTrackingRef.current) {
      safeExecute(function () {
        endSession();
      }, 'Erreur lors du cleanup:');
      isTrackingRef.current = false;
      currentSessionRef.current = null;
    }
  };
  (0, _react.useEffect)(function () {
    if (lastPathnameRef.current === pathname) {
      return;
    }
    lastPathnameRef.current = pathname;
    var isExercise = detectExercise(segments);
    if (isExercise) {
      var exerciseType = segments[segments.length - 1];
      handleExerciseStart(exerciseType);
    } else {
      handleExerciseEnd();
    }
    return cleanup;
  }, [segments, pathname, startSession, endSession, updateStreak]);
  (0, _react.useEffect)(function () {
    return cleanup;
  }, [endSession]);
};
var _default = exports.default = useRouteActivityTracker;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJyZXF1aXJlIiwiX2V4cG9Sb3V0ZXIiLCJfdXNlQWN0aXZpdHlNZXRyaWNzMiIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJ1c2VSb3V0ZUFjdGl2aXR5VHJhY2tlciIsInNlZ21lbnRzIiwidXNlU2VnbWVudHMiLCJwYXRobmFtZSIsInVzZVBhdGhuYW1lIiwiX3VzZUFjdGl2aXR5TWV0cmljcyIsInVzZUFjdGl2aXR5TWV0cmljcyIsInN0YXJ0U2Vzc2lvbiIsImVuZFNlc3Npb24iLCJ1cGRhdGVTdHJlYWsiLCJjdXJyZW50U2Vzc2lvblJlZiIsInVzZVJlZiIsImlzVHJhY2tpbmdSZWYiLCJsYXN0UGF0aG5hbWVSZWYiLCJzYWZlRXhlY3V0ZSIsImZuIiwiZXJyb3JNZXNzYWdlIiwiZXJyb3IiLCJjb25zb2xlIiwid2FybiIsImRldGVjdEV4ZXJjaXNlIiwic29tZSIsInNlZ21lbnQiLCJpbmNsdWRlcyIsImhhbmRsZUV4ZXJjaXNlU3RhcnQiLCJleGVyY2lzZVR5cGUiLCJjdXJyZW50Iiwic3VjY2VzcyIsImhhbmRsZUV4ZXJjaXNlRW5kIiwiY2xlYW51cCIsInVzZUVmZmVjdCIsImlzRXhlcmNpc2UiLCJsZW5ndGgiLCJfZGVmYXVsdCIsImV4cG9ydHMiLCJkZWZhdWx0Il0sInNvdXJjZXMiOlsidXNlUm91dGVBY3Rpdml0eVRyYWNrZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL2hvb2tzL3VzZVJvdXRlQWN0aXZpdHlUcmFja2VyLmpzIC0gUkVGQUNUT1JJU8OJIHBvdXIgcsOpZHVpcmUgbGEgY29tcGxleGl0w6kgY29nbml0aXZlXHJcbmltcG9ydCB7IHVzZUVmZmVjdCwgdXNlUmVmIH0gZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgeyB1c2VTZWdtZW50cywgdXNlUGF0aG5hbWUgfSBmcm9tICdleHBvLXJvdXRlcic7XHJcbmltcG9ydCB1c2VBY3Rpdml0eU1ldHJpY3MgZnJvbSAnLi91c2VBY3Rpdml0eU1ldHJpY3MnO1xyXG5cclxuY29uc3QgdXNlUm91dGVBY3Rpdml0eVRyYWNrZXIgPSAoKSA9PiB7XHJcbiAgY29uc3Qgc2VnbWVudHMgPSB1c2VTZWdtZW50cygpO1xyXG4gIGNvbnN0IHBhdGhuYW1lID0gdXNlUGF0aG5hbWUoKTtcclxuICBjb25zdCB7IHN0YXJ0U2Vzc2lvbiwgZW5kU2Vzc2lvbiwgdXBkYXRlU3RyZWFrIH0gPSB1c2VBY3Rpdml0eU1ldHJpY3MoKTtcclxuICBcclxuICAvLyBSZWZzIHBvdXIgw6l2aXRlciBsZXMgYXBwZWxzIGVuIGJvdWNsZVxyXG4gIGNvbnN0IGN1cnJlbnRTZXNzaW9uUmVmID0gdXNlUmVmKG51bGwpO1xyXG4gIGNvbnN0IGlzVHJhY2tpbmdSZWYgPSB1c2VSZWYoZmFsc2UpO1xyXG4gIGNvbnN0IGxhc3RQYXRobmFtZVJlZiA9IHVzZVJlZihudWxsKTtcclxuXHJcbiAgLy8gRm9uY3Rpb24gdXRpbGl0YWlyZSBwb3VyIGV4w6ljdXRlciBkZXMgZm9uY3Rpb25zIGRlIG1hbmnDqHJlIHPDqWN1cmlzw6llXHJcbiAgY29uc3Qgc2FmZUV4ZWN1dGUgPSAoZm4sIGVycm9yTWVzc2FnZSkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgcmV0dXJuIGZuKCk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLndhcm4oZXJyb3JNZXNzYWdlLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICAvLyBGb25jdGlvbiBwb3VyIGTDqXRlY3RlciBzaSBvbiBlc3Qgc3VyIHVuIGV4ZXJjaWNlXHJcbiAgY29uc3QgZGV0ZWN0RXhlcmNpc2UgPSAoc2VnbWVudHMpID0+IHtcclxuICAgIHJldHVybiBzZWdtZW50cy5zb21lKHNlZ21lbnQgPT4gXHJcbiAgICAgIHNlZ21lbnQuaW5jbHVkZXMoJ0V4ZXJjaXNlJykgfHxcclxuICAgICAgc2VnbWVudC5pbmNsdWRlcygnZXhlcmNpc2UnKSB8fFxyXG4gICAgICBzZWdtZW50LmluY2x1ZGVzKCdBc3Nlc3NtZW50JykgfHxcclxuICAgICAgc2VnbWVudC5pbmNsdWRlcygnYXNzZXNzbWVudCcpXHJcbiAgICApO1xyXG4gIH07XHJcblxyXG4gIC8vIEZvbmN0aW9uIHBvdXIgZ8OpcmVyIGxlIGTDqW1hcnJhZ2UgZCd1biBleGVyY2ljZVxyXG4gIGNvbnN0IGhhbmRsZUV4ZXJjaXNlU3RhcnQgPSAoZXhlcmNpc2VUeXBlKSA9PiB7XHJcbiAgICBpZiAoaXNUcmFja2luZ1JlZi5jdXJyZW50ICYmIGN1cnJlbnRTZXNzaW9uUmVmLmN1cnJlbnQgPT09IGV4ZXJjaXNlVHlwZSkge1xyXG4gICAgICByZXR1cm47IC8vIETDqWrDoCBlbiBjb3VycyBkZSB0cmFja2luZ1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEFycsOqdGVyIGxhIHNlc3Npb24gcHLDqWPDqWRlbnRlIHNpIGVsbGUgZXhpc3RlXHJcbiAgICBpZiAoaXNUcmFja2luZ1JlZi5jdXJyZW50KSB7XHJcbiAgICAgIHNhZmVFeGVjdXRlKCgpID0+IHtcclxuICAgICAgICBlbmRTZXNzaW9uKCk7XHJcbiAgICAgICAgdXBkYXRlU3RyZWFrKCk7XHJcbiAgICAgIH0sICdFcnJldXIgbG9ycyBkZSBsYSBmaW4gZGUgc2Vzc2lvbjonKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gRMOpbWFycmVyIGxhIG5vdXZlbGxlIHNlc3Npb25cclxuICAgIGNvbnN0IHN1Y2Nlc3MgPSBzYWZlRXhlY3V0ZSgoKSA9PiB7XHJcbiAgICAgIHN0YXJ0U2Vzc2lvbihleGVyY2lzZVR5cGUpO1xyXG4gICAgfSwgJ0VycmV1ciBsb3JzIGR1IGTDqW1hcnJhZ2UgZGUgc2Vzc2lvbjonKTtcclxuXHJcbiAgICBpZiAoc3VjY2Vzcykge1xyXG4gICAgICBpc1RyYWNraW5nUmVmLmN1cnJlbnQgPSB0cnVlO1xyXG4gICAgICBjdXJyZW50U2Vzc2lvblJlZi5jdXJyZW50ID0gZXhlcmNpc2VUeXBlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaXNUcmFja2luZ1JlZi5jdXJyZW50ID0gZmFsc2U7XHJcbiAgICAgIGN1cnJlbnRTZXNzaW9uUmVmLmN1cnJlbnQgPSBudWxsO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIC8vIEZvbmN0aW9uIHBvdXIgZ8OpcmVyIGxhIGZpbiBkJ3VuIGV4ZXJjaWNlXHJcbiAgY29uc3QgaGFuZGxlRXhlcmNpc2VFbmQgPSAoKSA9PiB7XHJcbiAgICBpZiAoIWlzVHJhY2tpbmdSZWYuY3VycmVudCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgc2FmZUV4ZWN1dGUoKCkgPT4ge1xyXG4gICAgICBlbmRTZXNzaW9uKCk7XHJcbiAgICAgIHVwZGF0ZVN0cmVhaygpO1xyXG4gICAgfSwgJ0VycmV1ciBsb3JzIGRlIGxhIGZpbiBkZSBzZXNzaW9uOicpO1xyXG5cclxuICAgIGlzVHJhY2tpbmdSZWYuY3VycmVudCA9IGZhbHNlO1xyXG4gICAgY3VycmVudFNlc3Npb25SZWYuY3VycmVudCA9IG51bGw7XHJcbiAgfTtcclxuXHJcbiAgLy8gRm9uY3Rpb24gcG91ciBuZXR0b3llciBsJ8OpdGF0XHJcbiAgY29uc3QgY2xlYW51cCA9ICgpID0+IHtcclxuICAgIGlmIChpc1RyYWNraW5nUmVmLmN1cnJlbnQpIHtcclxuICAgICAgc2FmZUV4ZWN1dGUoKCkgPT4ge1xyXG4gICAgICAgIGVuZFNlc3Npb24oKTtcclxuICAgICAgfSwgJ0VycmV1ciBsb3JzIGR1IGNsZWFudXA6Jyk7XHJcbiAgICAgIFxyXG4gICAgICBpc1RyYWNraW5nUmVmLmN1cnJlbnQgPSBmYWxzZTtcclxuICAgICAgY3VycmVudFNlc3Npb25SZWYuY3VycmVudCA9IG51bGw7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIC8vIMOJdml0ZXIgbGVzIHJlLWTDqWNsZW5jaGVtZW50cyBpbnV0aWxlc1xyXG4gICAgaWYgKGxhc3RQYXRobmFtZVJlZi5jdXJyZW50ID09PSBwYXRobmFtZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsYXN0UGF0aG5hbWVSZWYuY3VycmVudCA9IHBhdGhuYW1lO1xyXG5cclxuICAgIGNvbnN0IGlzRXhlcmNpc2UgPSBkZXRlY3RFeGVyY2lzZShzZWdtZW50cyk7XHJcblxyXG4gICAgaWYgKGlzRXhlcmNpc2UpIHtcclxuICAgICAgY29uc3QgZXhlcmNpc2VUeXBlID0gc2VnbWVudHNbc2VnbWVudHMubGVuZ3RoIC0gMV07XHJcbiAgICAgIGhhbmRsZUV4ZXJjaXNlU3RhcnQoZXhlcmNpc2VUeXBlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGhhbmRsZUV4ZXJjaXNlRW5kKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGNsZWFudXA7XHJcbiAgfSwgW3NlZ21lbnRzLCBwYXRobmFtZSwgc3RhcnRTZXNzaW9uLCBlbmRTZXNzaW9uLCB1cGRhdGVTdHJlYWtdKTtcclxuXHJcbiAgLy8gQ2xlYW51cCBmaW5hbCBhdSBkw6ltb250YWdlXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIHJldHVybiBjbGVhbnVwO1xyXG4gIH0sIFtlbmRTZXNzaW9uXSk7XHJcblxyXG4gIC8vIFBhcyBkZSByZW5kdVxyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgdXNlUm91dGVBY3Rpdml0eVRyYWNrZXI7Il0sIm1hcHBpbmdzIjoiOzs7OztBQUNBLElBQUFBLE1BQUEsR0FBQUMsT0FBQTtBQUNBLElBQUFDLFdBQUEsR0FBQUQsT0FBQTtBQUNBLElBQUFFLG9CQUFBLEdBQUFDLHNCQUFBLENBQUFILE9BQUE7QUFFQSxJQUFNSSx1QkFBdUIsR0FBRyxTQUExQkEsdUJBQXVCQSxDQUFBLEVBQVM7RUFDcEMsSUFBTUMsUUFBUSxHQUFHLElBQUFDLHVCQUFXLEVBQUMsQ0FBQztFQUM5QixJQUFNQyxRQUFRLEdBQUcsSUFBQUMsdUJBQVcsRUFBQyxDQUFDO0VBQzlCLElBQUFDLG1CQUFBLEdBQW1ELElBQUFDLDRCQUFrQixFQUFDLENB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