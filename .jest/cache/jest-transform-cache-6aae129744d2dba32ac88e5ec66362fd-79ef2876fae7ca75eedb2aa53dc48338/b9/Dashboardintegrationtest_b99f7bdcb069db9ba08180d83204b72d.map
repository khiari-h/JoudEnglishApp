{"version":3,"names":["_getJestObj","mock","getItem","jest","fn","setItem","LinearGradient","_ref","children","props","_objectWithoutProperties2","default","_excluded","_require","require","View","_jsxRuntime","jsx","Object","assign","router","push","__esModule","getLevelProgress","mockGetLevelProgress","refresh","mockResolvedValue","lastActivity","mockLastActivity","isLoading","mockIsLoading","reload","_require2","Text","TouchableOpacity","_ref2","onPress","jsxs","testID","title","LANGUAGE_LEVELS","color","EXERCISES","vocabulary","id","route","CONTAINER_SAFE_EDGES","NO_BOTTOM","_require3","ScrollView","Container","_ref3","_interopRequireDefault","_asyncToGenerator2","_react","_reactNative","_asyncStorage","_Dashboard","_ThemeContext","_ProgressContext","_CurrentLevelContext","_useDashboardLevel","_require5","type","level","_require4","describe","mockThemeContext","colors","background","primary","surface","text","mockProgressContext","progress","mockCurrentLevelContext","setCurrentLevel","currentLevel","mockHandleChangeActiveLevel","beforeEach","clearAllMocks","useProgress","mockReturnValue","useCurrentLevel","useDashboardLevel","handleChangeActiveLevel","levelColor","AsyncStorage","renderDashboard","render","ThemeContext","Provider","value","it","_renderDashboard","findByTestId","startButton","fireEvent","press","expect","toHaveBeenCalledWith","_renderDashboard2","findByText","rerender","level2Circle","waitFor","exploreButton"],"sources":["Dashboard.integration.test.js"],"sourcesContent":["// __tests__/screens/Dashboard/Dashboard.integration.test.js\nimport React from 'react';\nimport { render, fireEvent, waitFor } from '@testing-library/react-native';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport Dashboard from '../../../src/screens/Dashboard';\nimport { ThemeContext } from '../../../src/contexts/ThemeContext';\nimport { useProgress } from '../../../src/contexts/ProgressContext';\nimport { useCurrentLevel } from '../../../src/contexts/CurrentLevelContext';\nimport { useDashboardLevel } from '../../../src/screens/Dashboard/hooks/useDashboardLevel';\n\n// Mock des dépendances\njest.mock('@react-native-async-storage/async-storage', () => ({\n  getItem: jest.fn(),\n  setItem: jest.fn(),\n}));\n\njest.mock('expo-linear-gradient', () => ({\n  LinearGradient: ({ children, ...props }) => {\n    const { View } = require('react-native');\n    return <View {...props}>{children}</View>;\n  }\n}));\n\njest.mock('expo-router', () => ({\n  router: {\n    push: jest.fn(),\n  },\n}));\n\n// Mock des contextes et hooks\njest.mock('../../../src/contexts/ProgressContext');\njest.mock('../../../src/contexts/CurrentLevelContext');\njest.mock('../../../src/screens/Dashboard/hooks/useDashboardLevel');\n\n// Variables pour contrôler les mocks dynamiquement\nlet mockLastActivity = { type: 'vocabulary', level: '2', title: 'Vocabulaire Famille' };\nlet mockIsLoading = false;\nconst mockGetLevelProgress = jest.fn((level) => ({ '1': 25, '2': 50, '3': 75 }[level] || 0));\n\njest.mock('../../../src/hooks/useRealTimeProgress', () => ({\n  __esModule: true,\n  default: () => ({ getLevelProgress: mockGetLevelProgress, refresh: jest.fn().mockResolvedValue() })\n}));\njest.mock('../../../src/hooks/useLastActivity', () => ({\n  __esModule: true,\n  default: () => ({ lastActivity: mockLastActivity, isLoading: mockIsLoading, reload: jest.fn().mockResolvedValue() })\n}));\n\n// Mock des composants\njest.mock('../../../src/screens/Dashboard/components/HeroContinueSection', () => {\n  const { View, Text, TouchableOpacity } = require('react-native');\n  return ({ lastActivity, onPress }) => {\n    if (lastActivity) {\n      return (\n        <TouchableOpacity onPress={() => onPress(lastActivity)} testID=\"continue-activity-button\">\n          <Text>Continuer ▶️</Text>\n          <Text>{lastActivity.title}</Text>\n        </TouchableOpacity>\n      );\n    }\n    return (\n      <TouchableOpacity onPress={() => onPress('levelSelection')} testID=\"start-learning-button\">\n        <Text>Commencer &gt;</Text>\n      </TouchableOpacity>\n    );\n  };\n});\n\njest.mock('../../../src/utils/constants', () => ({\n  LANGUAGE_LEVELS: { '1': { title: 'Débutant', color: '#10B981' }, '2': { title: 'Élémentaire', color: '#3B82F6' } },\n  EXERCISES: { vocabulary: { id: 'vocabulary', route: '/tabs/vocabulary' } },\n  CONTAINER_SAFE_EDGES: { NO_BOTTOM: ['top', 'left', 'right'] }\n}));\n\njest.mock('../../../src/components/layout/Container', () => {\n  const { ScrollView, View } = require('react-native');\n  const Container = ({ children }) => <ScrollView>{children}</ScrollView>;\n  Container.CONTAINER_SAFE_EDGES = { NO_BOTTOM: ['top', 'left', 'right'] };\n  return Container;\n});\n\njest.mock('../../../src/screens/VocabularyRevision/RevisionOrchestrator', () => () => null);\n\nconst { router } = require('expo-router');\n\ndescribe('Dashboard - Tests d\\'intégration', () => {\n  const mockThemeContext = { colors: { background: '#F8FAFC', primary: '#3B82F6', surface: '#FFFFFF', text: '#1F2937' } };\n  const mockProgressContext = { progress: {}, isLoading: false };\n  const mockCurrentLevelContext = { setCurrentLevel: jest.fn(), currentLevel: '1' };\n  const mockHandleChangeActiveLevel = jest.fn();\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    mockLastActivity = { type: 'vocabulary', level: '2', title: 'Vocabulaire Famille' };\n    useProgress.mockReturnValue(mockProgressContext);\n    useCurrentLevel.mockReturnValue(mockCurrentLevelContext);\n    useDashboardLevel.mockReturnValue({ \n      currentLevel: '1', \n      handleChangeActiveLevel: mockHandleChangeActiveLevel, \n      levelColor: '#10B981' \n    });\n    AsyncStorage.getItem.mockResolvedValue(null);\n  });\n\n  const renderDashboard = () => render(<ThemeContext.Provider value={mockThemeContext}><Dashboard /></ThemeContext.Provider>);\n\n  it('devrait gérer l\\'absence d\\'activité récente', async () => {\n    mockLastActivity = null;\n    const { findByTestId } = renderDashboard();\n    const startButton = await findByTestId('start-learning-button');\n    fireEvent.press(startButton);\n    expect(router.push).toHaveBeenCalledWith('/(tabs)/levelSelection');\n  });\n\n  it('devrait permettre de changer de niveau et naviguer', async () => {\n    const { findByText, rerender } = renderDashboard();\n\n    // 1. Cliquer sur le cercle du niveau 2\n    const level2Circle = await findByText('2');\n    fireEvent.press(level2Circle);\n\n    // 2. Vérifier que le changement d\\'état a été demandé\n    await waitFor(() => {\n      expect(mockHandleChangeActiveLevel).toHaveBeenCalledWith('2');\n      expect(mockCurrentLevelContext.setCurrentLevel).toHaveBeenCalledWith('2');\n    });\n\n    // 3. Simuler la mise à jour du state en re-rendant avec le hook mocké retournant la nouvelle valeur\n    useDashboardLevel.mockReturnValue({ \n      currentLevel: '2', // <-- Le niveau a changé\n      handleChangeActiveLevel: mockHandleChangeActiveLevel, \n      levelColor: '#3B82F6' \n    });\n    rerender(<ThemeContext.Provider value={mockThemeContext}><Dashboard /></ThemeContext.Provider>);\n\n    // 4. Maintenant, le bouton \"Explorer\" doit être mis à jour\n    const exploreButton = await findByText('Explorer le niveau 2');\n    fireEvent.press(exploreButton);\n\n    // 5. Vérifier la navigation\n    expect(router.push).toHaveBeenCalledWith('/tabs/exerciseSelection?level=2');\n  });\n});\n"],"mappings":"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","ignoreList":[]}